--------------------------------------------------------
--  DDL for Package Body PKG_GF_TITULOS_JUDICIAL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "GENESYS"."PKG_GF_TITULOS_JUDICIAL" as

  --Unidad de programa que registra los Titulos Judiciales Masivos
  function fnc_vl_accion_ttlo(p_id_instncia_fljo in number,
                              p_cdgo_estdo       in varchar2) return varchar2 as
    v_cdgo_estdo varchar2(3);
  begin
    begin
      select a.cdgo_ttlo_jdcial_estdo
        into v_cdgo_estdo
        from gf_g_titulos_judicial a
       where a.id_instncia_fljo = p_id_instncia_fljo
       group by a.cdgo_ttlo_jdcial_estdo;
    exception
      when others then
        return 'S';
    end;
  
    if (v_cdgo_estdo = 'ACN' and
       (p_cdgo_estdo = 'TRO' or p_cdgo_estdo = 'FRC')) then
      return 'N';
    else
      return 'S';
    end if;
  
  end fnc_vl_accion_ttlo;

  procedure prc_rg_titulos_judicial(p_cdgo_clnte             in number,
                                    p_id_usrio               in number,
                                    p_json_ttlos             in clob,
                                    p_id_prcso_crga          in number,
                                    p_id_ttlo_jdcial_area    in number,
                                    p_indcdor_rqre_aprbccion in varchar2,
                                    o_cdgo_rspsta            out number,
                                    o_mnsje_rspsta           out varchar2)
  
   as
  
    v_id_fljo        number;
    v_id_ttlo_jdcial number;
    v_nl             number;
    --v_mnsje_log       varchar2(4000);
    v_cdgo_ttlo_estdo varchar2(5);
    v_error           exception;
    v_nmbre_up        varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulos_judicial';
  
  begin
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando con id_prcsos_crga:' || p_id_prcso_crga,
                          6);
  
    if (p_indcdor_rqre_aprbccion = 'S') then
      v_cdgo_ttlo_estdo := 'RGS';
    else
      v_cdgo_ttlo_estdo := 'APB';
    end if;
  
    --Se obtiene el flujo de Titulos Judiciales que se va instanciar para cada Titulo
    begin
      select a.id_fljo
        into v_id_fljo
        from wf_d_flujos a
       where a.cdgo_fljo = 'TJM'
         and a.cdgo_clnte = p_cdgo_clnte;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'No se encontro flujo de Titulos Judiciales con codigo TJM para este cliente';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al consultar el flujo de Titulos Judiciales';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
    end;
  
    --Se recorre el json de Titulos
    begin
    
      for c_ttlos_jdcial in (select id_ttlo_jdcial_crgdo,
                                    nmro_ttlo,
                                    fcha_cnsttcion,
                                    vlor,
                                    idntfccion_dmndnte,
                                    nmbre_dmndnte,
                                    cdgo_idntfccion_tpo_dmndo,
                                    idntfccion_dmndo,
                                    nmbre_dmndo,
                                    nmro_ttlo_pdre,
                                    cdgo_entdad_cnsgnnte,
                                    vlor_oculto
                               from json_table(p_json_ttlos,
                                               '$[*]'
                                               columns(id_ttlo_jdcial_crgdo
                                                       varchar2 path
                                                       '$.ID_TTLO_JDCIAL_CRGDO',
                                                       nmro_ttlo varchar2 path
                                                       '$.NMRO_TTLO',
                                                       fcha_cnsttcion varchar2 path
                                                       '$.FCHA_CNSTTCION',
                                                       vlor varchar2 path
                                                       '$.VLOR',
                                                       idntfccion_dmndnte
                                                       varchar2 path
                                                       '$.IDNTFCCION_DMNDNTE',
                                                       nmbre_dmndnte varchar2 path
                                                       '$.NMBRE_DMNDNTE',
                                                       cdgo_idntfccion_tpo_dmndo
                                                       varchar2 path
                                                       '$.CDGO_IDNTFCCION_TPO_DMNDO',
                                                       idntfccion_dmndo
                                                       varchar2 path
                                                       '$.IDNTFCCION_DMNDO',
                                                       nmbre_dmndo varchar2 path
                                                       '$.NMBRE_DMNDO',
                                                       nmro_ttlo_pdre varchar2 path
                                                       '$.NMRO_TTLO_PDRE',
                                                       cdgo_entdad_cnsgnnte
                                                       varchar2 path
                                                       '$.CDGO_ENTDAD_CNSGNNTE',
                                                       vlor_oculto varchar2 path
                                                       '$.VLOR_OCULTO'))) loop
      
        --Se consulta si el Titulo se encuentra registrado
        begin
          select a.id_ttlo_jdcial
            into v_id_ttlo_jdcial
            from gf_g_titulos_judicial a
           where a.nmro_ttlo_jdcial = c_ttlos_jdcial.nmro_ttlo;
        
          if v_id_ttlo_jdcial is not null then
            o_cdgo_rspsta  := 3;
            o_mnsje_rspsta := o_cdgo_rspsta || '-' || 'El Titulo Judicial ' ||
                              c_ttlos_jdcial.nmro_ttlo ||
                              'Ya se encuentra registrado';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            return;
          end if;
        
        exception
          when no_data_found then
            begin
              pkg_gf_titulos_judicial.prc_rg_titulos_judicial_pntual(p_cdgo_clnte                 => p_cdgo_clnte,
                                                                     p_id_usrio                   => p_id_usrio,
                                                                     p_id_ttlo_jdcial_crgdo       => c_ttlos_jdcial.id_ttlo_jdcial_crgdo,
                                                                     p_nmro_ttlo_jdcial           => c_ttlos_jdcial.nmro_ttlo,
                                                                     p_fcha_cnsttcion             => c_ttlos_jdcial.fcha_cnsttcion,
                                                                     p_vlor                       => c_ttlos_jdcial.vlor_oculto,
                                                                     p_idntfccion_dmndnte         => c_ttlos_jdcial.idntfccion_dmndnte,
                                                                     p_nmbre_dmndnte              => c_ttlos_jdcial.nmbre_dmndnte,
                                                                     p_id_ttlo_jdcial_area        => p_id_ttlo_jdcial_area,
                                                                     p_cdgo_idntfccion_tpo_dmnddo => c_ttlos_jdcial.cdgo_idntfccion_tpo_dmndo,
                                                                     p_idntfccion_dmnddo          => c_ttlos_jdcial.idntfccion_dmndo,
                                                                     p_nmbre_dmnddo               => c_ttlos_jdcial.nmbre_dmndo,
                                                                     p_nmro_ttlo_pdre             => c_ttlos_jdcial.nmro_ttlo_pdre,
                                                                     p_cdgo_entdad_cnsgnnte       => c_ttlos_jdcial.cdgo_entdad_cnsgnnte,
                                                                     p_cdgo_ttlo_jdcial_estdo     => v_cdgo_ttlo_estdo,
                                                                     p_indcdor_rqre_aprbccion     => p_indcdor_rqre_aprbccion,
                                                                     o_cdgo_rspsta                => o_cdgo_rspsta,
                                                                     p_id_fljo                    => v_id_fljo,
                                                                     o_mnsje_rspsta               => o_mnsje_rspsta);
            
              if (o_cdgo_rspsta != 0) then
                rollback;
              else
                commit;
              end if;
            
            exception
              when others then
                o_cdgo_rspsta  := 4;
                o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                  'Problema al llamar la unidad de programa que registra los Titulos Judiciales';
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      o_mnsje_rspsta || ' , ' || sqlerrm,
                                      6);
                return;
            end;
        end;
      end loop;
    
    end;
  
  end prc_rg_titulos_judicial;

  --Unidad de programa que registra los titulos puntualmente
  procedure prc_rg_titulos_judicial_pntual(p_cdgo_clnte                 in number,
                                           p_id_usrio                   in number,
                                           p_id_ttlo_jdcial_crgdo       in number,
                                           p_nmro_ttlo_jdcial           in varchar2,
                                           p_fcha_cnsttcion             in date,
                                           p_vlor                       in number,
                                           p_idntfccion_dmndnte         in varchar2,
                                           p_nmbre_dmndnte              in varchar2,
                                           p_id_ttlo_jdcial_area        in number,
                                           p_cdgo_idntfccion_tpo_dmnddo in varchar2,
                                           p_idntfccion_dmnddo          in varchar2,
                                           p_nmbre_dmnddo               in varchar2,
                                           p_nmro_ttlo_pdre             in varchar2,
                                           p_cdgo_entdad_cnsgnnte       in number,
                                           p_cdgo_ttlo_jdcial_estdo     in varchar2,
                                           p_indcdor_rqre_aprbccion     in varchar2,
                                           p_id_fljo                    in number,
                                           o_cdgo_rspsta                out number,
                                           o_mnsje_rspsta               out varchar2)
  
   as
  
    v_nl             number;
    v_mnsje_log      varchar2(4000);
    o_id_ttlo_jdcial number;
    v_bnco_cnsgnnte  number;
    v_id_ttlo_pdre   number;
    v_instncia_fljo  number;
    v_fljo_trea      number;
    v_nmbre_up       varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulos_judicial_pntual';
  
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando con p_idntfccion_dmndnte:' ||
                          p_idntfccion_dmndnte || ',' || p_nmbre_dmndnte,
                          6);
    --Si el numero del Titulo padre es mayor a 0 obtener el identificador del titulo padre
    if (p_nmro_ttlo_pdre > 0) then
      begin
        select a.id_ttlo_jdcial
          into v_id_ttlo_pdre
          from gf_g_titulos_judicial a
         where a.nmro_ttlo_jdcial = p_nmro_ttlo_pdre;
      exception
        when no_data_found then
          v_id_ttlo_pdre := null;
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Problema al consultar el titulo padre';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          return;
      end;
    end if;
  
    --Se obtiene el identificador del banco consignante
    begin
      select a.id_bnco
        into v_bnco_cnsgnnte
        from df_c_bancos a
       where a.cdgo_bnco = p_cdgo_entdad_cnsgnnte
         and a.cdgo_clnte = p_cdgo_clnte;
    exception
      when no_data_found then
        v_bnco_cnsgnnte := null;
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al consultar el banco consignante';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
    end;
  
    --Se manda a Instanciar el flujo de Titulos Judiciales
    begin
    
      pkg_pl_workflow_1_0.prc_rg_instancias_flujo(p_id_fljo          => p_id_fljo,
                                                  p_id_usrio         => p_id_usrio,
                                                  p_id_prtcpte       => null,
                                                  p_obsrvcion        => 'Instancia de flujo Titulos Judiciales por cargue de archivo',
                                                  o_id_instncia_fljo => v_instncia_fljo,
                                                  o_id_fljo_trea     => v_fljo_trea,
                                                  o_mnsje            => o_mnsje_rspsta);
    
      if v_instncia_fljo is null then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'No se pudo instanciar el flujo para el Titulo Judicial ' ||
                          p_nmro_ttlo_jdcial;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
      end if;
    
    exception
      when others then
        o_cdgo_rspsta  := 4;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al llamar el procedimiento  pkg_pl_workflow_1_0.prc_rg_instancias_flujo';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
    end;
  
    begin
      insert into gf_g_titulos_judicial
        (cdgo_clnte,
         id_ttlo_jdcial_crgdo,
         nmro_ttlo_jdcial,
         fcha_cnsttcion,
         vlor,
         --idntfccion_dmndnte,
         --nmbre_dmndnte,
         id_ttlo_jdcial_area,
         cdgo_idntfccion_tpo_dmnddo,
         idntfccion_dmnddo,
         nmbre_dmnddo,
         nmro_ttlo_pdre,
         id_ttlo_pdre,
         cdgo_entdad_cnsgnnte,
         id_bnco_cnsgnnte,
         cdgo_ttlo_jdcial_estdo,
         id_instncia_fljo)
      
      values
        (p_cdgo_clnte,
         p_id_ttlo_jdcial_crgdo,
         p_nmro_ttlo_jdcial,
         p_fcha_cnsttcion,
         p_vlor,
         --p_idntfccion_dmndnte,
         --p_nmbre_dmndnte,
         p_id_ttlo_jdcial_area,
         p_cdgo_idntfccion_tpo_dmnddo,
         p_idntfccion_dmnddo,
         p_nmbre_dmnddo,
         p_nmro_ttlo_pdre,
         v_id_ttlo_pdre,
         p_cdgo_entdad_cnsgnnte,
         v_bnco_cnsgnnte,
         p_cdgo_ttlo_jdcial_estdo,
         v_instncia_fljo)
      returning id_ttlo_jdcial into o_id_ttlo_jdcial;
    
    exception
      when others then
        o_cdgo_rspsta  := 5;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al registrar el Titulo Judiciales ' ||
                          p_nmro_ttlo_jdcial;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
    end;
  
    --Actualiza el estado del titulo judicial registrado
    begin
      update gf_g_titulos_judicial_crgdo a
         set a.cdgo_ttlo_jdcial_crgdo_estdo = 'RGS'
       where a.nmro_ttlo = p_nmro_ttlo_jdcial;
    exception
      when others then
        o_cdgo_rspsta  := 6;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al actualizar el estado del Titulo Judicial cargado ' ||
                          p_nmro_ttlo_jdcial;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
    end;
  
    --Se registra la traza de estado de cada uno de los titulos
    begin
      pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                   p_id_ttlo_jdcial         => o_id_ttlo_jdcial,
                                                   p_cdgo_ttlo_jdcial_estdo => p_cdgo_ttlo_jdcial_estdo,
                                                   p_obsrvcion              => 'Registrado',
                                                   p_id_usrio               => p_id_usrio,
                                                   p_indcdor_rqre_aprbccion => p_indcdor_rqre_aprbccion,
                                                   o_cdgo_rspsta            => o_cdgo_rspsta,
                                                   o_mnsje_rspsta           => o_mnsje_rspsta);
    
      if (o_cdgo_rspsta > 0) then
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_cdgo_rspsta || '-' || o_mnsje_rspsta,
                              6);
        return;
      end if;
    
    exception
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al llamar el procedimiento prc_rg_titulos_judicial_pntual';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        return;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo con exito',
                          6);
  
  end prc_rg_titulos_judicial_pntual;

  procedure prc_rg_titulos_traza(p_cdgo_clnte             in number,
                                 p_id_ttlo_jdcial         in number,
                                 p_cdgo_ttlo_jdcial_estdo in varchar2,
                                 p_obsrvcion              in varchar2,
                                 p_id_usrio               in number,
                                 p_indcdor_rqre_aprbccion in varchar2 default null,
                                 p_cdgo_mvmnto_trza       in varchar2 default null,
                                 o_cdgo_rspsta            out number,
                                 o_mnsje_rspsta           out varchar2)
  
   as
    v_error     exception;
    v_nl        number;
    v_mnsje_log varchar2(4000);
  
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulos_traza';
  
  begin
  
    o_cdgo_rspsta := 0;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    if (p_indcdor_rqre_aprbccion = 'N') then
      --Inserta el Titulo Judicial con estado Registrado (RGS)
      begin
        insert into gf_g_titulos_judicial_traza
          (id_ttlo_jdcial,
           cdgo_ttlo_jdcial_estdo,
           obsrvcion,
           id_usrio,
           fcha,
           cdgo_ttlo_jdcial_estdo_nvo,
           cdgo_tpo_mvmnto)
        values
          (p_id_ttlo_jdcial,
           p_cdgo_ttlo_jdcial_estdo,
           p_obsrvcion,
           p_id_usrio,
           sysdate,
           p_cdgo_ttlo_jdcial_estdo,
           p_cdgo_mvmnto_trza);
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al registrar traza del Titulo Registrado';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          return;
      end;
    end if;
  
    begin
      insert into gf_g_titulos_judicial_traza
        (id_ttlo_jdcial,
         cdgo_ttlo_jdcial_estdo,
         obsrvcion,
         id_usrio,
         fcha,
         cdgo_ttlo_jdcial_estdo_nvo,
         cdgo_tpo_mvmnto)
      values
        (p_id_ttlo_jdcial,
         p_cdgo_ttlo_jdcial_estdo,
         p_obsrvcion,
         p_id_usrio,
         sysdate,
         p_cdgo_ttlo_jdcial_estdo,
         p_cdgo_mvmnto_trza);
    exception
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al registrar traza del Titulo';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        return;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo con exito:' || systimestamp,
                          6);
  
  end prc_rg_titulos_traza;

  procedure prc_rg_titulos_judicial_traslado(p_cdgo_clnte       in number,
                                             p_id_instncia_fljo in number,
                                             p_id_usrio         in number,
                                             p_json_ttlos       in clob,
                                             p_id_area          in number,
                                             p_obsrvcion        in varchar2,
                                             p_fcha_trsldo      in date,
                                             o_cdgo_rspsta      out number,
                                             o_mnsje_rspsta     out varchar2)
  
   as
  
    v_id_ttlo_jdcial        number;
    v_nl                    number;
    v_mnsje_log             varchar2(4000);
    v_error                 exception;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulos_judicial_traslado';
    v_id_ttlo_jdcial_trsldo number;
    v_id_area               number;
  
  begin
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --Se recorre el json de Titulos
  
    for c_ttlos_jdcial in (select id_ttlo_jdcial
                             from json_table(p_json_ttlos,
                                             '$[*]'
                                             columns(id_ttlo_jdcial varchar2 path
                                                     '$.id_ttlo_jdcial'))) loop
    
      --Se consulta si el Titulo se encuentra registrado
      begin
        select id_ttlo_jdcial
          into v_id_ttlo_jdcial
          from gf_g_titulos_judicial
         where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al consultar el titulo judicial';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    
      begin
        select id_area
          into v_id_area
          from df_c_areas
         where id_area = p_id_area;
      exception
        when others then
          o_cdgo_rspsta  := 2;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' || p_id_area || '--' ||
                            'Error al validar el area de traslado, ' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    
      if v_id_ttlo_jdcial is not null then
      
        /*o_mnsje_rspsta := 'Parametros: ' || p_id_instncia_fljo || ',' ||
                          v_id_ttlo_jdcial || ',' || p_id_area || ',' ||
                          p_id_usrio || ',' || p_obsrvcion || ',' ||
                          p_fcha_trsldo;
        
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);*/
      
        begin
          insert into gf_g_titulos_judicial_traslado
            (id_instncia_fljo,
             id_ttlo_jdcial,
             id_area,
             id_usrio,
             obsrvcnes,
             fcha_trsldo)
          values
            (p_id_instncia_fljo,
             v_id_ttlo_jdcial,
             p_id_area,
             p_id_usrio,
             p_obsrvcion,
             p_fcha_trsldo)
          returning id_ttlo_jdcial_trsldo into v_id_ttlo_jdcial_trsldo;
        
          if v_id_ttlo_jdcial_trsldo is not null then
          
            /* pkg_sg_log.prc_rg_log(p_cdgo_clnte,
            null,
            v_nmbre_up,
            v_nl,
            'Entro a if con Parametros: ' ||
            p_id_instncia_fljo || ',' || p_cdgo_clnte || ',' ||
            p_id_usrio || ' y ' ||
            v_id_ttlo_jdcial_trsldo,
            6);*/
          
            pkg_gf_titulos_judicial.prc_fnlza_fljo_tsldo(p_id_instncia_fljo => p_id_instncia_fljo,
                                                         p_cdgo_clnte       => p_cdgo_clnte,
                                                         p_id_usrio         => p_id_usrio,
                                                         o_cdgo_rspsta      => o_cdgo_rspsta,
                                                         o_mnsje_rspsta     => o_mnsje_rspsta);
          
            if (o_cdgo_rspsta <> 0) then
              raise v_error;
            end if;
          end if;
        
        exception
          when others then
            o_cdgo_rspsta  := 3;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al insertar en gf_g_titulos_judicial_traslado, ' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
          
        end;
      end if;
    end loop;
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
    
  end prc_rg_titulos_judicial_traslado;

  procedure prc_ac_titulos_judicial(p_cdgo_clnte             in number,
                                    p_id_usrio               in number,
                                    p_json_ttlos_pry         in clob default null,
                                    p_json_ttlos             in clob default null,
                                    p_id_ttlo_jdcial         in number default null,
                                    p_indcdor_mtvo           in varchar2,
                                    p_obsrvcion              in varchar2,
                                    p_indcdor_rqre_aprbccion in varchar2 default null,
                                    p_id_instncia_fljo       in number,
                                    p_id_fljo_trea           in number,
                                    o_url                    out varchar2,
                                    o_cdgo_rspsta            out number,
                                    o_mnsje_rspsta           out varchar2)
  
   as
  
    v_error           exception;
    v_nl              number;
    v_mnsje_log       varchar2(4000);
    v_cdgo_ttlo_estdo varchar2(5);
    v_nmbre_up        varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_titulos_judicial';
  
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_indcdor_mtvo:' || p_indcdor_mtvo,
                          6);
  
    if (p_indcdor_mtvo = 'A') then
      v_cdgo_ttlo_estdo := 'APB';
    elsif (p_indcdor_mtvo = 'T') then
      v_cdgo_ttlo_estdo := 'TRO';
    else
      v_cdgo_ttlo_estdo := 'RCH';
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_cdgo_ttlo_estdo:' || v_cdgo_ttlo_estdo,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_json_ttlos:' || p_json_ttlos,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_id_ttlo_jdcial:' || p_id_ttlo_jdcial,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_json_ttlos_pry:' || p_json_ttlos_pry,
                          6);
    if p_id_ttlo_jdcial is not null then
      --Se actualiza el campo cdgo_ttlo_jdcial_estdo a Aprobado/Rechazado
      begin
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'Actualizando el estado del titulo',
                              6);
      
        update gf_g_titulos_judicial a
           set a.cdgo_ttlo_jdcial_estdo = v_cdgo_ttlo_estdo
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al actualizar el Titulo Judicial a Aprobado';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo con exito de la Actualizacion del estado del titulo',
                            6);
    
      --Se registra la traza de estado de cada uno de los titulos
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'registrara la traza: ' || p_cdgo_clnte || ',' ||
                            p_id_ttlo_jdcial || ',' || v_cdgo_ttlo_estdo || ',' ||
                            p_obsrvcion || ',' || p_id_usrio || ',' ||
                            p_indcdor_rqre_aprbccion,
                            6);
    
      begin
        pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                     p_id_ttlo_jdcial         => p_id_ttlo_jdcial,
                                                     p_cdgo_ttlo_jdcial_estdo => v_cdgo_ttlo_estdo,
                                                     p_obsrvcion              => p_obsrvcion,
                                                     p_id_usrio               => p_id_usrio,
                                                     p_indcdor_rqre_aprbccion => p_indcdor_rqre_aprbccion,
                                                     o_cdgo_rspsta            => o_cdgo_rspsta,
                                                     o_mnsje_rspsta           => o_mnsje_rspsta);
      
        if o_cdgo_rspsta > 0 then
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' - ' || o_cdgo_rspsta || '-' ||
                                sqlerrm,
                                6);
          raise v_error;
        end if;
      exception
        when others then
          o_cdgo_rspsta  := 22;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al llamar el procedimiento prc_rg_titulos_traza';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
      if v_cdgo_ttlo_estdo = 'TRO' then
        o_url := '::NO:RP,245::';
      else
        o_url := '::NO:RP,249::';
      end if;
    elsif p_json_ttlos is not null then
      for c_ttlos_jdcial in (select nmro_ttlo_jdcial,
                                    fcha_cnsttcion,
                                    vlor,
                                    idntfccion_dmndnte,
                                    nmbre_dmndnte,
                                    idntfccion_dmndo,
                                    nmbre_dmndo,
                                    estdo,
                                    clor,
                                    id_ttlo_jdcial,
                                    cdgo_ttlo_jdcial_estdo,
                                    nmro_ttlo_pdre
                               from json_table(p_json_ttlos,
                                               '$[*]'
                                               columns(nmro_ttlo_jdcial
                                                       varchar2 path
                                                       '$.NMRO_TTLO_JDCIAL',
                                                       fcha_cnsttcion varchar2 path
                                                       '$.FCHA_CNSTTCION',
                                                       vlor varchar2 path
                                                       '$.VLOR',
                                                       idntfccion_dmndnte
                                                       varchar2 path
                                                       '$.IDNTFCCION_DMNDNTE',
                                                       nmbre_dmndnte varchar2 path
                                                       '$.NMBRE_DMNDNTE',
                                                       idntfccion_dmndo
                                                       varchar2 path
                                                       '$.IDNTFCCION_DMNDO',
                                                       nmbre_dmndo varchar2 path
                                                       '$.NMBRE_DMNDO',
                                                       estdo varchar2 path
                                                       '$.ESTDO',
                                                       clor varchar2 path
                                                       '$.CLOR',
                                                       id_ttlo_jdcial varchar2 path
                                                       '$.ID_TTLO_JDCIAL',
                                                       cdgo_ttlo_jdcial_estdo
                                                       varchar2 path
                                                       '$.CDGO_TTLO_JDCIAL_ESTDO',
                                                       nmro_ttlo_pdre varchar2 path
                                                       '$.NMRO_TTLO_PDRE'))) loop
      
        --Se actualiza el campo cdgo_ttlo_jdcial_estdo a Aprobado/Rechazado
        begin
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                'Actualizando el estado del titulo',
                                6);
          update gf_g_titulos_judicial a
             set a.cdgo_ttlo_jdcial_estdo = v_cdgo_ttlo_estdo
           where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
        exception
          when others then
            o_cdgo_rspsta  := 1;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al actualizar el Titulo Judicial a Aprobado';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'Saliendo con exito de la Actualizacion del estado del titulo',
                              6);
      
        --Se registra la traza de estado de cada uno de los titulos
        begin
          pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                       p_id_ttlo_jdcial         => c_ttlos_jdcial.id_ttlo_jdcial,
                                                       p_cdgo_ttlo_jdcial_estdo => v_cdgo_ttlo_estdo,
                                                       p_obsrvcion              => p_obsrvcion,
                                                       p_id_usrio               => p_id_usrio,
                                                       p_indcdor_rqre_aprbccion => p_indcdor_rqre_aprbccion,
                                                       o_cdgo_rspsta            => o_cdgo_rspsta,
                                                       o_mnsje_rspsta           => o_mnsje_rspsta);
        
          if o_cdgo_rspsta > 0 then
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_cdgo_rspsta || '-' || sqlerrm,
                                  6);
            raise v_error;
          end if;
        exception
          when others then
            o_cdgo_rspsta  := 22;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al llamar el procedimiento prc_rg_titulos_traza';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      end loop;
    elsif p_json_ttlos_pry is not null then
      for c_ttlos_jdcial in (select id_ttlo_jdcial
                               from json_table(p_json_ttlos_pry,
                                               '$[*]'
                                               columns(id_ttlo_jdcial
                                                       varchar2 path
                                                       '$.id_ttlo_jdcial'))) loop
      
        --Se actualiza el campo cdgo_ttlo_jdcial_estdo a Aprobado/Rechazado
        begin
          update gf_g_titulos_judicial a
             set a.cdgo_ttlo_jdcial_estdo = v_cdgo_ttlo_estdo
           where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
        exception
          when others then
            o_cdgo_rspsta  := 1;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al actualizar el Titulo Judicial a Aprobado';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      
        --Se registra la traza de estado de cada uno de los titulos
        begin
          pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                       p_id_ttlo_jdcial         => c_ttlos_jdcial.id_ttlo_jdcial,
                                                       p_cdgo_ttlo_jdcial_estdo => v_cdgo_ttlo_estdo,
                                                       p_obsrvcion              => p_obsrvcion,
                                                       p_id_usrio               => p_id_usrio,
                                                       p_indcdor_rqre_aprbccion => p_indcdor_rqre_aprbccion,
                                                       o_cdgo_rspsta            => o_cdgo_rspsta,
                                                       o_mnsje_rspsta           => o_mnsje_rspsta);
        
          if o_cdgo_rspsta > 0 then
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_cdgo_rspsta || '-' || sqlerrm,
                                  6);
            raise v_error;
          end if;
        exception
          when others then
            o_cdgo_rspsta  := 22;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al llamar el procedimiento prc_rg_titulos_traza' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      
        if p_indcdor_mtvo != 'T' then
        
          --eliminar vigencias
          begin
            delete gf_g_titulos_jdcial_vgncia a
             where a.id_ttlo_jdcial_impsto in
                   (select b.id_ttlo_jdcial_impsto b
                      from gf_g_titulos_jdcial_impsto b
                     where b.id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial);
          exception
            when others then
              o_cdgo_rspsta  := 1;
              o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                'Error al eliminar las vigencias proyectadas del Titulo Judicial';
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta || ' , ' || sqlerrm,
                                    6);
              raise v_error;
          end;
        
          --eliminar impuestos
          begin
            delete gf_g_titulos_jdcial_impsto b
             where b.id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
          exception
            when others then
              o_cdgo_rspsta  := 1;
              o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                'Error al eliminar el impuesto proyectado del Titulo Judicial';
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta || ' , ' || sqlerrm,
                                    6);
              raise v_error;
          end;
        
          --eliminar transicion
        
          begin
            delete wf_g_instancias_transicion a
             where a.id_instncia_fljo = p_id_instncia_fljo
               and a.id_fljo_trea_orgen = p_id_fljo_trea;
          exception
            when others then
              o_cdgo_rspsta  := 1;
              o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                'Error al eliminar transicion Proyeccion del Titulo Judicial';
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta || ' , ' || sqlerrm,
                                    6);
              raise v_error;
          end;
        
          --actualizar a tarea inicial
          begin
            update wf_g_instancias_transicion a
               set a.fcha_fin_real = null, a.id_estdo_trnscion = 2
             where a.id_instncia_fljo = p_id_instncia_fljo;
          exception
            when others then
              o_cdgo_rspsta  := 1;
              o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                'Error al actualizar tarea inicial del Titulo Judicial';
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta || ' , ' || sqlerrm,
                                    6);
              raise v_error;
          end;
        end if;
      end loop;
    end if;
    o_url := '::NO:RP,240::';
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo con exito:' || systimestamp,
                          6);
    commit;
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      rollback;
  end prc_ac_titulos_judicial;

  procedure prc_rg_titulo_judicial_analisi(p_cdgo_clnte                  in number,
                                           p_id_usrio                    in number,
                                           p_json_ttlo_jdcial            in clob,
                                           p_json_embrgos_rslcion        in clob,
                                           p_cdgo_ttlo_jdcial_slctud_tpo in varchar2,
                                           o_cdgo_rspsta                 out number,
                                           o_mnsje_rspsta                out varchar2) as
  
    v_error                        exception;
    v_nl                           number;
    v_mnsje_log                    varchar2(4000);
    o_id_ttlo_jdcial_anlsis        number;
    o_id_ttlo_jdcial_anlsis_impsto number;
    o_id_ttlo_jdcial               varchar2(200);
    o_id_embrgos_rslcion           varchar2(200);
    o_id_embrgos_crtra             varchar2(200);
    o_cdgo_estdos_crtra            varchar2(200);
    o_id_impsto                    number;
    o_id_impsto_sbmpsto            number;
    o_id_sjto_impsto               number;
    o_id_estdos_crtra              number;
    v_nmbre_up                     varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulo_judicial_analisi';
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    for c_ttlos_jdcial in (select id_ttlo_jdcial
                             from json_table(p_json_ttlo_jdcial,
                                             '$[*]'
                                             columns(id_ttlo_jdcial varchar2 path
                                                     '$.ID_TTLO_JDCIAL'))) loop
    
      o_id_ttlo_jdcial := c_ttlos_jdcial.id_ttlo_jdcial;
    
    end loop;
  
    for c_embrgos_rslcion in (select id_embrgos_crtra,
                                     id_embrgos_rslcion,
                                     id_estdos_crtra
                                from json_table(p_json_embrgos_rslcion,
                                                '$[*]'
                                                columns(id_embrgos_crtra
                                                        varchar2 path
                                                        '$.ID_EMBRGOS_CRTRA',
                                                        id_embrgos_rslcion
                                                        varchar2 path
                                                        '$.ID_EMBRGOS_RSLCION',
                                                        --cdgo_estdos_crtra varchar2 path '$.CDGO_ESTDOS_CRTRA'))) loop
                                                        id_estdos_crtra
                                                        varchar2 path
                                                        '$.ID_ESTDOS_CRTRA'))) loop
    
      o_id_embrgos_rslcion := c_embrgos_rslcion.id_embrgos_rslcion;
      o_id_embrgos_crtra   := c_embrgos_rslcion.id_embrgos_crtra;
      --o_cdgo_estdos_crtra  := c_embrgos_rslcion.cdgo_estdos_crtra;
      o_id_estdos_crtra := c_embrgos_rslcion.id_estdos_crtra;
    end loop;
  
    begin
      o_mnsje_rspsta := 'INSERT A gf_g_titulos_jdcial_anlsis ->' ||
                        'o_id_ttlo_jdcial: ' || o_id_ttlo_jdcial || ' - ' ||
                        'o_id_embrgos_rslcion: ' || o_id_embrgos_rslcion ||
                        ' - ' || 'p_cdgo_ttlo_jdcial_slctud_tpo: ' ||
                        p_cdgo_ttlo_jdcial_slctud_tpo || ' - ' ||
                        'o_id_estdos_crtra: ' || o_id_estdos_crtra;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta || ' , ' || sqlerrm,
                            6);
    
      insert into gf_g_titulos_jdcial_anlsis
        (id_ttlo_jdcial,
         id_embrgo_rslcion, --cdgo_mdda_ctlar_estdo,
         cdgo_ttlo_jdcial_slctud_tpo,
         id_usrio,
         indcdor_aplccion,
         fcha,
         id_estdo_crtra)
      
      values
        (o_id_ttlo_jdcial,
         o_id_embrgos_rslcion, --o_cdgo_estdos_crtra,
         p_cdgo_ttlo_jdcial_slctud_tpo,
         p_id_usrio,
         'C',
         sysdate,
         o_id_estdos_crtra)
      returning id_ttlo_jdcial_anlsis into o_id_ttlo_jdcial_anlsis;
      --null;
    exception
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'No se pudo registrar el analisis del Titulo Judicial';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        raise v_error;
    end;
  
    begin
      select a.id_impsto, a.id_impsto_sbmpsto, a.id_sjto_impsto
        into o_id_impsto, o_id_impsto_sbmpsto, o_id_sjto_impsto
        from v_mc_g_embargos_cartera_v2 a
       where a.id_embrgos_crtra = o_id_embrgos_crtra;
    
    exception
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'No se pudo consultar el Impuesto de la medida cautelar';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        raise v_error;
    end;
    o_mnsje_rspsta := 'INSERT A gf_g_ttlos_jdcl_anlss_impst ->' ||
                      'o_id_ttlo_jdcial_anlsis: ' ||
                      o_id_ttlo_jdcial_anlsis || ' - ' || 'o_id_impsto: ' ||
                      o_id_impsto || ' - ' || 'o_id_impsto_sbmpsto: ' ||
                      o_id_impsto_sbmpsto || ' - ' || 'o_id_sjto_impsto: ' ||
                      o_id_sjto_impsto;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          o_mnsje_rspsta || ' , ' || sqlerrm,
                          6);
  
    begin
      insert into gf_g_ttlos_jdcl_anlss_impst
        (id_ttlo_jdcial_anlsis,
         id_impsto,
         id_impsto_sbmpsto,
         id_sjto_impsto)
      values
        (o_id_ttlo_jdcial_anlsis,
         o_id_impsto,
         o_id_impsto_sbmpsto,
         o_id_sjto_impsto)
      returning id_ttlo_jdcial_anlsis_impsto into o_id_ttlo_jdcial_anlsis_impsto;
    
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'No se pudo registrar el impuesto de la medida cautelar';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        raise v_error;
    end;
  
    for c_embrgo_crtra in (select a.vgncia, a.id_prdo, a.id_cncpto
                             from mc_g_embargos_cartera_detalle a
                            where a.id_embrgos_crtra = o_id_embrgos_crtra) loop
      begin
        insert into gf_g_ttlos_jdcl_anlss_crtr
          (id_ttlo_jdcial_anlsis_impsto, vgncia, id_prdo, id_cncpto)
        values
          (o_id_ttlo_jdcial_anlsis_impsto,
           c_embrgo_crtra.vgncia,
           c_embrgo_crtra.id_prdo,
           c_embrgo_crtra.id_cncpto);
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'No se pudo registrar la cartera de la medida cautelar';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    
    end loop;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo con exito:' || systimestamp,
                          6);
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      rollback;
    
  end prc_rg_titulo_judicial_analisi;

  function fnc_cl_titulos_judicial_estdo(p_cdgo_clnte             in number,
                                         p_cdgo_ttlo_jdcial_estdo in varchar2)
    return boolean as
    v_exist varchar2(1);
  begin
    --Se obtiene el estado con el que se va a registrar el titulo
    select 'S'
      into v_exist
      from gf_d_titulos_judicial_estdo a
     where a.cdgo_ttlo_jdcial_estdo = p_cdgo_ttlo_jdcial_estdo
       and a.cdgo_clnte = p_cdgo_clnte;
  
    return true;
  exception
    when others then
      return false;
  end fnc_cl_titulos_judicial_estdo;

  procedure prc_rg_analisis_dvlcion_ttlos(p_cdgo_clnte         in number,
                                          p_id_embrgos_rslcion in number,
                                          p_id_ttlo_jdcial     in number,
                                          p_id_usrio           in number,
                                          o_cdgo_rspsta        out number,
                                          o_mnsje_rspsta       out varchar2) as
  
    v_error                exception;
    v_nl                   number;
    v_cdgo_estdos_crtra    varchar2(1);
    v_id_instncia_fljo_hjo number;
    v_id_fljo_trea_orgen   number;
    v_type_rspsta          varchar2(1);
    v_error_msg            number;
    v_nmbre_up             varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_analisis_dvlcion_ttlos';
    v_fljo_trea            number;
  
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    -- 1. se obtiene el codigo de estado de la medida cautelar
    begin
      select cdgo_estdos_crtra
        into v_cdgo_estdos_crtra
        from v_gf_g_ttlos_mc_g_embrgs_res
       where id_embrgos_rslcion = p_id_embrgos_rslcion;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' no se encontro medida cautelar' || sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --2. Insertar datos basicos para analisis de solicitud
    begin
      /*insert into gf_g_titulos_jdcial_anlsis (id_ttlo_jdcial, id_embrgo_rslcion, cdgo_mdda_ctlar_estdo, id_usrio, fcha)
      values (p_id_ttlo_jdcial, p_id_embrgos_rslcion, v_cdgo_estdos_crtra, p_id_usrio, sysdate);*/
      null;
    exception
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas en la insersion del analisis de solicitud' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Medida Cautelar Asociada al Titulo Judicial Exitosamente!';
    end if;
  
    -- 3. Cambio de Tarea del flujo
    begin
    
      select a.id_instncia_fljo, b.id_fljo_trea_orgen
        into v_id_instncia_fljo_hjo, v_id_fljo_trea_orgen
        from gf_g_titulos_judicial a
        join wf_g_instancias_transicion b
          on a.id_instncia_fljo = b.id_instncia_fljo
         and b.id_estdo_trnscion in (1, 2)
       where id_ttlo_jdcial = p_id_ttlo_jdcial;
    
      pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                       p_id_fljo_trea     => v_id_fljo_trea_orgen,
                                                       p_json             => '[]',
                                                       o_type             => v_type_rspsta,
                                                       o_mnsje            => o_mnsje_rspsta,
                                                       o_id_fljo_trea     => v_fljo_trea,
                                                       o_error            => v_error_msg);
      if v_type_rspsta = 'S' then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al trasitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 4;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al encontrar el flujo y tarea para trasitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo: ' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
    
  end prc_rg_analisis_dvlcion_ttlos;

  function fnc_cl_detalle_titulos_slctud(p_cdgo_clnte                  in number,
                                         p_json_ttlos                  in clob,
                                         p_cdgo_ttlo_jdcial_slctud_tpo in varchar2)
    return clob as
  
    v_select clob;
    v_error  exception;
  
  begin
  
    v_select := '<table align="center" border="1px"  style="border-collapse: collapse; border-color: black !important;">
          <tr>
            <th style="padding: 10px !important;">N?. Titulo</th>
            <th style="padding: 10px !important;">Valor</th>';
  
    if p_cdgo_ttlo_jdcial_slctud_tpo = 'SDT' then
    
      v_select := v_select ||
                  '<th style="padding: 10px !important;">Identificacion<br>Contribuyente</th>
                   <th style="padding: 10px !important;">Contribuyente</th></tr>';
    
    else
    
      v_select := v_select || '</tr>';
    
    end if;
  
    for c_titulos_judicial in (select nmro_ttlo_jdcial,
                                      vlor,
                                      idntfccion_dmnddo,
                                      nmbre_dmnddo
                                 from gf_g_titulos_judicial a
                                 join (select id_ttlo_jdcial
                                        from json_table(p_json_ttlos,
                                                        '$[*]' columns
                                                        id_ttlo_jdcial PATH
                                                        '$.ID_TTLO_JDCIAL')) b
                                   on a.id_ttlo_jdcial = b.id_ttlo_jdcial) loop
    
      if p_cdgo_ttlo_jdcial_slctud_tpo = 'SDT' then
      
        v_select := v_select || '<tr><td style="text-align:center;">' ||
                    c_titulos_judicial.nmro_ttlo_jdcial ||
                    '</td>
                      <td style="text-align:center;">' ||
                    to_char(c_titulos_judicial.vlor,
                            'FM$999G999G999G999G999G999G990') ||
                    '</td>
                      <td style="text-align:center;">' ||
                    c_titulos_judicial.idntfccion_dmnddo ||
                    '</td>
                      <td style="text-align:center;">' ||
                    c_titulos_judicial.nmbre_dmnddo ||
                    '</td>
                    </tr>';
      
      else
        v_select := v_select || '<tr><td style="text-align:center;">' ||
                    c_titulos_judicial.nmro_ttlo_jdcial ||
                    '</td>
                      <td style="text-align:center;">' ||
                    to_char(c_titulos_judicial.vlor,
                            'FM$999G999G999G999G999G999G990') ||
                    '</td>
                    </tr>';
      end if;
    
    end loop;
  
    v_select := v_select || '</table>';
  
    return v_select;
  
  end fnc_cl_detalle_titulos_slctud;

  procedure prc_rg_solicitud_dvlcion_ttlo(p_cdgo_clnte                  in number,
                                          p_json_ttlos                  in clob,
                                          p_id_usrio                    in number,
                                          p_cdgo_ttlo_jdcial_slctud_tpo in varchar2,
                                          p_id_ttlo_jdcial              in number,
                                          o_id_ttlo_jdcial_slctud       out number,
                                          o_cdgo_rspsta                 out number,
                                          o_mnsje_rspsta                out varchar2) as
  
    --------------------------------------------------------------
    ---&Procedimiento para registrar solicitud titulo judicial&---
    --------------------------------------------------------------
  
    v_error    exception;
    v_nl       number;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_solicitud_dvlcion_ttlo';
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    -- 1. insercion de solicitud de devolucion
    begin
    
      insert into gf_g_titulos_jdcial_slctud
        (cdgo_ttlo_jdcial_slctud_tpo, fcha_slctud, id_usrio)
      values
        (p_cdgo_ttlo_jdcial_slctud_tpo, sysdate, p_id_usrio)
      returning id_ttlo_jdcial_slctud into o_id_ttlo_jdcial_slctud;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'o_id_ttlo_jdcial_slctud: ' ||
                            o_id_ttlo_jdcial_slctud,
                            6);
    
    exception
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' al registrar la solicitud de devolucion' ||
                          SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --2. insercion detalle de titulo asociados a una solicitud
    for c_titulos_judicial in (select a.id_ttlo_jdcial
                                 from gf_g_titulos_judicial a
                                 join (select id_ttlo_jdcial
                                        from json_table(p_json_ttlos,
                                                        '$[*]' columns
                                                        id_ttlo_jdcial PATH
                                                        '$.id_ttlo_jdcial')) b
                                   on a.id_ttlo_jdcial = b.id_ttlo_jdcial) loop
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'entro en el for: ' ||
                            c_titulos_judicial.id_ttlo_jdcial,
                            6);
      begin
        insert into gf_g_ttlos_jdcl_slctd_dtll
          (id_ttlo_jdcial_slctud, id_ttlo_jdcial)
        values
          (o_id_ttlo_jdcial_slctud, c_titulos_judicial.id_ttlo_jdcial);
      exception
        when others then
          o_cdgo_rspsta  := 2;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' al registrar el detalle de la solicitud de devolucion' ||
                            SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
          rollback;
      end;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'registro exitoso gf_g_ttlos_jdcl_slctd_dtll: ' ||
                            o_id_ttlo_jdcial_slctud,
                            6);
    
    end loop;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Solicitud de Devolucion Registrada Satisfactoriamente!';
      commit;
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20001, o_mnsje_rspsta);
  end prc_rg_solicitud_dvlcion_ttlo;

  /*procedure prc_rg_documento_ttlo_jdcial(p_cdgo_clnte                   in number,
                                           p_json_slctud_ttlos            in clob,
                                           p_cdgo_ttlo_jdcial_slctud_tpo  in varchar2 default null,
                                           p_id_plntlla                   in number,
                                           p_dcmnto                       in clob,
                                           p_request                      in varchar2,
                                           p_id_usrio                 in number,
                                           p_id_ttlo_jdcial                 in number,
                                           o_id_ttlo_jdcial_dcmnto          out number,
                                           o_cdgo_rspsta                out number,
                                           o_mnsje_rspsta               out varchar2)as
  --------------------------------------------------------------------
    ---&Procedimiento para gestionar el documento de plantilla actos&---
    --------------------------------------------------------------------
  
    v_id_rprte            number;
    v_error               exception;
  v_nl            number;
    v_id_ttlo_jdcial_dcmnto     number;
    v_nmbre_up                  varchar2(100)   :=  'pkg_gf_titulos_judicial.prc_rg_documento_ttlo_jdcial';
    v_id_ttlo_jdcial_slctud     number;
  
    begin
  
        o_cdgo_rspsta := 0;
    v_nl := pkg_sg_log.fnc_ca_nivel_log( p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'Entrando:' || systimestamp, 6);
  
        --1. Se consulta el reporte asociado al oficio de solicitud de devolucion
            begin
               select a.id_rprte
                 into v_id_rprte
                 from gn_d_plantillas a
                where a.cdgo_clnte = p_cdgo_clnte
                  and a.id_plntlla = p_id_plntlla;
            exception
                when no_data_found then
                    o_cdgo_rspsta := 1;
                    o_mnsje_rspsta:= 'No se enontro el reporte asociado a la plantilla, Codigo Error'|| o_cdgo_rspsta;
                    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
          raise v_error;
                    return;
            end;
  
            if p_request = 'CREATE' then
                begin
                    insert into gf_g_titulos_jdcial_dcmnto(id_plntlla, id_rprte, dcmnto, id_ttlo_jdcial)
                                                    values(p_id_plntlla, v_id_rprte, p_dcmnto, p_id_ttlo_jdcial)
                    returning id_ttlo_jdcial_dcmnto into o_id_ttlo_jdcial_dcmnto;
  
  
                exception
                    when others then
                        o_cdgo_rspsta  := 3;
                        o_mnsje_rspsta := 'Error, hace falta parametros para la insercion, Codigo Error'|| o_cdgo_rspsta||SQLERRM;
                        pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                        raise v_error;
                end;
            end if;
  
      */ /*for c_ttlos_jdcial_slctud in (select a.id_ttlo_jdcial_slctud
                      from gf_g_titulos_jdcial_slctud a
                      join (select id_ttlo_jdcial_slctud
                                                  from json_table(p_json_slctud_ttlos, '$[*]' columns (id_ttlo_jdcial_slctud varchar2 path '$.ID_TTLO_JDCIAL_SLCTUD'))
                                                ) b on a.id_ttlo_jdcial_slctud = b.id_ttlo_jdcial_slctud)
      loop */ /*

        --2. Validacion de peticion en el proceso de crear y atualizar
        begin

                    select a.id_ttlo_jdcial_dcmnto, c.id_ttlo_jdcial_slctud
                      into v_id_ttlo_jdcial_dcmnto, v_id_ttlo_jdcial_slctud
                      from gf_g_ttlos_jdcl_dcmnt_slctd a
                      join gf_g_titulos_jdcial_dcmnto b on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
                      join gf_g_titulos_jdcial_slctud c on a.id_ttlo_jdcial_slctud = c.id_ttlo_jdcial_slctud
                     where a.id_ttlo_jdcial_slctud = (select id_ttlo_jdcial_slctud
                                                      from json_table(p_json_slctud_ttlos, '$[*]'
                                                              columns (id_ttlo_jdcial_slctud varchar2 path '$.ID_TTLO_JDCIAL_SLCTUD')))--c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud
                       and b.id_plntlla = p_id_plntlla
                       and c.cdgo_ttlo_jdcial_slctud_tpo = p_cdgo_ttlo_jdcial_slctud_tpo;
        exception
          when no_data_found then
             v_id_ttlo_jdcial_dcmnto := null;
        end;

                if p_request = 'CREATE' and p_cdgo_ttlo_jdcial_slctud_tpo = 'SDT' then

                    --4. Insercion Detalle Documento
                    begin
                        insert into gf_g_ttlos_jdcl_dcmnt_slctd(id_ttlo_jdcial_slctud, id_ttlo_jdcial_dcmnto)
                                                        values(v_id_ttlo_jdcial_slctud*/ /*c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud*/ /*, o_id_ttlo_jdcial_dcmnto);


                    exception
                        when others then
                            o_cdgo_rspsta  := 4;
                            o_mnsje_rspsta := 'Error, hace falta parametros para la insercion del detalle de documento, Codigo Error'|| o_cdgo_rspsta||SQLERRM;
                            pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                            raise v_error;
                    end;
                elsif p_request = 'DELETE' then
                    --6. Eliminacion del Documento
                    begin
                        delete gf_g_titulos_jdcial_dcmnto
                         where id_ttlo_jdcial_dcmnto = v_id_ttlo_jdcial_dcmnto;
                    exception
                        when others then
                            o_cdgo_rspsta  := 7;
                            o_mnsje_rspsta := 'Error, No se pudo eliminar registro, Codigo Error'|| o_cdgo_rspsta;
                            pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                            raise v_error;
                    end;

                    if p_cdgo_ttlo_jdcial_slctud_tpo = 'SDT' then
                        -- 7. Eliminacion del Detalle del Documento
                        begin
                            delete gf_g_ttlos_jdcl_dcmnt_slctd
                             where id_ttlo_jdcial_dcmnto = v_id_ttlo_jdcial_dcmnto;
                        exception
                            when others then
                                o_cdgo_rspsta  := 6;
                                o_mnsje_rspsta := 'Error, No se pudo eliminar registro, Codigo Error'|| o_cdgo_rspsta;
                                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                                raise v_error;
                        end;

                        --8. Eliminacion del Solicitud Detalle
                        begin
                            delete gf_g_ttlos_jdcl_slctd_dtll
                             where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud;--c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud;
                        exception
                            when others then
                                o_cdgo_rspsta  := 8;
                                o_mnsje_rspsta := 'Error, No se pudo eliminar detalle solicitud, Codigo Error'|| o_cdgo_rspsta;
                                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                                raise v_error;
                        end;

                         --9. Eliminacion del Solicitud
                        begin
                            delete gf_g_titulos_jdcial_slctud
                             where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud;--c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud;
                        exception
                            when others then
                                o_cdgo_rspsta  := 8;
                                o_mnsje_rspsta := 'Error, No se pudo eliminar solicitud, Codigo Error'|| o_cdgo_rspsta;
                                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                                raise v_error;
                        end;
                    end if;
                end if;
    --end loop;

        if p_request = 'SAVE' then
            --5. Modificacion del Documento
            begin
                update gf_g_titulos_jdcial_dcmnto
                   set dcmnto = p_dcmnto
                 where id_ttlo_jdcial_dcmnto = v_id_ttlo_jdcial_dcmnto;

            exception
                when others then
                    o_cdgo_rspsta  := 5;
                    o_mnsje_rspsta := 'Error, no se pudo realizar la actualizacion, Codigo Error'|| o_cdgo_rspsta;
                    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta , 6);
                    raise v_error;
            end;
    end if;

        if o_cdgo_rspsta = 0 then
            o_mnsje_rspsta := '!Peticion Procesada!';
            commit;
        end if;

    exception
        when v_error then
                raise_application_error(-20000, o_mnsje_rspsta);
    end prc_rg_documento_ttlo_jdcial;*/

  procedure prc_ac_solicitud_dvlcion_ttlo(p_cdgo_clnte            in number,
                                          p_id_ttlo_jdcial_slctud in number,
                                          p_id_ttlo_jdcial_dcmnto in number,
                                          p_json_ttlos            in clob,
                                          p_id_usrio              in number,
                                          p_id_plntlla            in number,
                                          o_id_acto               out number,
                                          o_cdgo_rspsta           out number,
                                          o_mnsje_rspsta          out varchar2) as
  
    --------------------------------------------------------------
    --&procedimiento para actualizar la solicitud de devolucion&--
    --------------------------------------------------------------
  
    v_error         exception;
    v_nl            number;
    v_id_acto_tpo   number;
    v_cdgo_acto_tpo gn_d_actos_tipo.cdgo_acto_tpo%type;
    v_nmbre_up      varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_solicitud_dvlcion_ttlo';
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. Consultamos el tipo de acto
    begin
      select b.id_acto_tpo, b.cdgo_acto_tpo
        into v_id_acto_tpo, v_cdgo_acto_tpo
        from gn_d_plantillas a
        join gn_d_actos_tipo b
          on a.id_acto_tpo = b.id_acto_tpo
       where b.cdgo_clnte = p_cdgo_clnte
         and a.id_plntlla = p_id_plntlla;
    
    exception
      when others then
        begin
          select b.id_acto_tpo, b.cdgo_acto_tpo
            into v_id_acto_tpo, v_cdgo_acto_tpo
            from gf_g_titulos_jdcial_dcmnto a
            join gn_d_actos_tipo b
              on a.id_acto_tpo = b.id_acto_tpo
           where a.id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
        exception
          when no_data_found then
            o_cdgo_rspsta  := 1;
            o_mnsje_rspsta := 'Error al encontrar el tipo de acto. Error No. ' ||
                              o_cdgo_rspsta || SQLCODE || ' - ' || SQLERRM;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_cdgo_clnte: ' || p_cdgo_clnte ||
                          ' ,p_json_ttlos: ' || p_json_ttlos ||
                          ', v_cdgo_acto_tpo: ' || v_cdgo_acto_tpo ||
                          ', p_id_usrio: ' || p_id_usrio,
                          6);
  
    --2. Registra el oficio de solicitud de devolucion
    begin
    
      pkg_gf_titulos_judicial.prc_gn_acto_ttlo_jdcial_slctud(p_cdgo_clnte    => p_cdgo_clnte,
                                                             p_json_ttlos    => p_json_ttlos,
                                                             p_cdgo_acto_tpo => v_cdgo_acto_tpo,
                                                             p_cdgo_cnsctvo  => v_cdgo_acto_tpo, --'TJP',
                                                             p_id_usrio      => p_id_usrio,
                                                             o_id_acto       => o_id_acto,
                                                             o_cdgo_rspsta   => o_cdgo_rspsta,
                                                             o_mnsje_rspsta  => o_mnsje_rspsta);
    
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error Generar el oficio de solicitud de devolucion. Error: ' ||
                          o_cdgo_rspsta || o_mnsje_rspsta || ' - ' ||
                          SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
  
    -- valida si el acto fue registrado
  
    if o_id_acto is not null then
    
      --3. actualizacion tabla documentos de titulos
      begin
        update gf_g_titulos_jdcial_dcmnto
           set id_acto = o_id_acto
        --,id_acto_tpo = v_id_acto_tpo
         where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
      
        /*delete from muerto; commit;
        insert into muerto (numero) values(o_id_acto);*/
      exception
        when others then
          o_cdgo_rspsta  := 3;
          o_mnsje_rspsta := 'Error al actualizar el documento del acto de la solicitud. Error:' ||
                            SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'p_cdgo_clnte: ' || p_cdgo_clnte ||
                            ' ,p_id_ttlo_jdcial_dcmnto: ' ||
                            p_id_ttlo_jdcial_dcmnto ||
                            ', p_cdgo_acto_tpo: ' || v_cdgo_acto_tpo ||
                            ', p_id_plntlla: ' || p_id_plntlla ||
                            ', o_id_acto: ' || o_id_acto,
                            6);
      --4. Generacion de reporte y actualizacion de acto
      begin
        pkg_gf_titulos_judicial.prc_gn_rprte_ttlo_jdcial_slctd(p_cdgo_clnte            => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_dcmnto => p_id_ttlo_jdcial_dcmnto,
                                                               p_cdgo_acto_tpo         => v_cdgo_acto_tpo,
                                                               p_id_plntlla            => p_id_plntlla,
                                                               p_id_acto               => o_id_acto,
                                                               o_cdgo_rspsta           => o_cdgo_rspsta,
                                                               o_mnsje_rspsta          => o_mnsje_rspsta);
        if o_cdgo_rspsta != 0 then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error al registrar el blob. Error No. ' ||
                            o_cdgo_rspsta || o_mnsje_rspsta || SQLCODE ||
                            ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
        end if;
      
      end;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'p_id_ttlo_jdcial_slctud: ' ||
                            p_id_ttlo_jdcial_slctud,
                            6);
      -- recorre el detalle de la solicitud para identificar los titulos judiciales
      for c_ttlo_jdcial in (select id_ttlo_jdcial
                              from gf_g_ttlos_jdcl_slctd_dtll
                             where id_ttlo_jdcial_slctud =
                                   p_id_ttlo_jdcial_slctud) loop
      
        --5. actualizacion estado del titulo
        /*delete from muerto;commit;
        insert into muerto (numero) values (c_ttlo_jdcial.id_ttlo_jdcial);*/
      
        begin
        
          update gf_g_titulos_judicial
             set cdgo_ttlo_jdcial_estdo = 'SDT'
           where cdgo_clnte = p_cdgo_clnte
             and id_ttlo_jdcial = c_ttlo_jdcial.id_ttlo_jdcial;
        
        exception
          when others then
            o_cdgo_rspsta  := 5;
            o_mnsje_rspsta := 'Error al actualizar el estado del titulo judicial. Error:' ||
                              SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      
        --6. Registro de traza de titulos judiciales
        begin
          pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                       p_id_ttlo_jdcial         => c_ttlo_jdcial.id_ttlo_jdcial,
                                                       p_cdgo_ttlo_jdcial_estdo => 'SDT',
                                                       p_obsrvcion              => 'Solicitud Devolucion',
                                                       p_id_usrio               => p_id_usrio,
                                                       p_indcdor_rqre_aprbccion => 'N',
                                                       o_cdgo_rspsta            => o_cdgo_rspsta,
                                                       o_mnsje_rspsta           => o_mnsje_rspsta);
          if o_cdgo_rspsta != 0 then
            o_cdgo_rspsta  := 6;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al registrar traza de titulo judicial' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
          end if;
        
        end;
      
      end loop;
    
    end if;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Oficio Solicitud de Devolucion Generado Satisfactoriamente!';
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo ' || systimestamp,
                            6);
  end prc_ac_solicitud_dvlcion_ttlo;

  procedure prc_gn_acto_ttlo_jdcial_slctud(p_cdgo_clnte    in number,
                                           p_json_ttlos    in clob,
                                           p_cdgo_acto_tpo in varchar2,
                                           p_cdgo_cnsctvo  in varchar2,
                                           p_id_usrio      in number,
                                           o_id_acto       out number,
                                           o_cdgo_rspsta   out number,
                                           o_mnsje_rspsta  out varchar2) as
  
    ------------------------------------------------------------------
    ---&Procedimiento para generar el acto de solicitud de titulos&---
    ------------------------------------------------------------------
  
    v_error                 exception;
    v_nl                    number;
    v_slct_sjto_impsto      clob;
    v_slct_vngcias          clob;
    v_slct_rspnsble         clob;
    v_id_acto_tpo           number;
    v_json_acto             clob;
    v_vlor                  number := 0;
    v_id_ttlo_jdcial_slctud number;
    v_json                  clob;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_gn_acto_ttlo_jdcial_slctud';
  
  begin
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando ' || systimestamp,
                          6);
  
    v_json := '''' || p_json_ttlos ||
              ''',''$[*]'' columns (id_ttlo_jdcial varchar2 path ''$.id_ttlo_jdcial'')';
  
    -- select para obtener los datos del sujeto impuesto
    v_slct_sjto_impsto := 'select c.id_impsto_sbmpsto
                                       ,c.id_sjto_impsto
                                from gf_g_ttlos_jdcl_slctd_dtll b
                                join gf_g_titulos_jdcial_impsto c on b.id_ttlo_jdcial = c.id_ttlo_jdcial
                          join (select id_ttlo_jdcial
                                  from json_table(' ||
                          v_json ||
                          ')) d on d.id_ttlo_jdcial = b.id_ttlo_jdcial';
  
    -- select para obtener las vigencias y los periodos
    v_slct_vngcias := ' select c.id_sjto_impsto,
                  d.vgncia,
                  d.id_prdo,
                                    0 as vlor_cptal,
                                    0 as vlor_intres
                from gf_g_titulos_jdcial_slctud a
                join gf_g_ttlos_jdcl_slctd_dtll b on a.id_ttlo_jdcial_slctud = b.id_ttlo_jdcial_slctud
                join gf_g_titulos_jdcial_impsto c on b.id_ttlo_jdcial = c.id_ttlo_jdcial
                join gf_g_titulos_jdcial_vgncia d on c.id_ttlo_jdcial_impsto = d.id_ttlo_jdcial_impsto
                join (select id_ttlo_jdcial
                                        from json_table(' ||
                      v_json ||
                      ')) e on e.id_ttlo_jdcial = b.id_ttlo_jdcial';
  
    -- select para obtener los responsables de un acto
    v_slct_rspnsble := 'select d.cdgo_idntfccion_tpo,
                   d.nmro_idntfccion  idntfccion,
                   d.prmer_nmbre,
                   d.sgndo_nmbre,
                   d.prmer_aplldo,
                   d.sgndo_aplldo,
                   d.drccion          drccion_ntfccion,
                   d.id_pais          id_pais_ntfccion,
                   d.id_dprtmnto      id_dprtmnto_ntfccion,
                   d.id_mncpio        id_mncpio_ntfccion,
                   null email,
                   null tlfno
                from gf_g_ttlos_jdcl_slctd_dtll b
                join gf_g_titulos_jdcial_impsto c on b.id_ttlo_jdcial = c.id_ttlo_jdcial
                join v_si_i_sujetos_responsable d on c.id_sjto_rspnsble = d.id_sjto_rspnsble
                join (select id_ttlo_jdcial
                                        from json_table(' ||
                       v_json ||
                       ')) e on e.id_ttlo_jdcial = b.id_ttlo_jdcial';
  
    -- 1. Se consulta el total de la solicitud
    begin
    
      select sum(a.vlor)
        into v_vlor
        from gf_g_titulos_judicial a
        join gf_g_ttlos_jdcl_slctd_dtll b
          on a.id_ttlo_jdcial = b.id_ttlo_jdcial
        join (select id_ttlo_jdcial
                from json_table(p_json_ttlos,
                                '$[*]' columns(id_ttlo_jdcial varchar2 path
                                        '$.id_ttlo_jdcial'))) c
          on c.id_ttlo_jdcial = b.id_ttlo_jdcial;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No.' || o_cdgo_rspsta ||
                          'No se encontro el valor del acto.' || SQLCODE ||
                          ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_vlor: ' || v_vlor,
                          6);
    -- 2. Consulta el id del tipo del acto
    begin
      select id_acto_tpo
        into v_id_acto_tpo
        from gn_d_actos_tipo
       where cdgo_clnte = p_cdgo_clnte
         and cdgo_acto_tpo = p_cdgo_acto_tpo;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No.' || o_cdgo_rspsta ||
                          'al encontrar el tipo de acto' || SQLCODE ||
                          ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_id_acto_tpo: ' || v_id_acto_tpo,
                          6);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_cdgo_clnte: ' || p_cdgo_clnte || ', titulo: ' ||
                          JSON_VALUE(p_json_ttlos, '$.id_ttlo_jdcial') ||
                          ', v_id_acto_tpo: ' || v_id_acto_tpo ||
                          ', v_vlor: ' || v_vlor || ', p_cdgo_cnsctvo: ' ||
                          p_cdgo_cnsctvo || ', p_id_usrio:' || p_id_usrio,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_slct_sjto_impsto: ' || v_slct_sjto_impsto,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_slct_vngcias: ' || v_slct_vngcias,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_slct_rspnsble: ' || v_slct_rspnsble,
                          6);
    -- 3. Generacion del json para el Acto
    begin
    
      v_json_acto := pkg_gn_generalidades.fnc_cl_json_acto(p_cdgo_clnte       => p_cdgo_clnte,
                                                           p_cdgo_acto_orgen  => 'TJP',
                                                           p_id_orgen         => JSON_VALUE(p_json_ttlos,
                                                                                            '$.id_ttlo_jdcial'),
                                                           p_id_undad_prdctra => JSON_VALUE(p_json_ttlos,
                                                                                            '$.id_ttlo_jdcial'),
                                                           p_id_acto_tpo      => v_id_acto_tpo,
                                                           p_acto_vlor_ttal   => nvl(v_vlor,
                                                                                     0),
                                                           p_cdgo_cnsctvo     => p_cdgo_cnsctvo,
                                                           --p_id_acto_rqrdo_hjo => null,
                                                           --p_id_acto_rqrdo_pdre  => null,
                                                           p_fcha_incio_ntfccion => sysdate,
                                                           p_id_usrio            => p_id_usrio /*,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           p_slct_sjto_impsto  => v_slct_sjto_impsto,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           p_slct_vgncias    => v_slct_vngcias,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           p_slct_rspnsble   => v_slct_rspnsble*/);
    
      --insert into muerto(c_001,t_001) values (v_json_acto, systimestamp); commit;
      if v_json_acto is null then
        --insert into muerto(c_001,t_001) values (v_json_acto, systimestamp); commit;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'v_json_acto esta vacio.',
                              6);
        raise v_error;
      end if;
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No.' || o_cdgo_rspsta ||
                          ' al Generar el json para el acto. Error: ' ||
                          SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
    if v_json_acto is null then
      --insert into muerto(c_001,t_001) values (v_json_acto, systimestamp); commit;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'v_json_acto esta vacio.',
                            6);
      raise v_error;
    end if;
    -- 4. Generacion del Acto
    begin
      pkg_gn_generalidades.prc_rg_acto(p_cdgo_clnte   => p_cdgo_clnte,
                                       p_json_acto    => v_json_acto,
                                       o_id_acto      => o_id_acto,
                                       o_cdgo_rspsta  => o_cdgo_rspsta,
                                       o_mnsje_rspsta => o_mnsje_rspsta);
    
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 4;
        o_mnsje_rspsta := 'Error: ' || o_cdgo_rspsta || ' - ' ||
                          o_mnsje_rspsta || SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'o_id_acto: ' || o_id_acto,
                          6);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo ' || systimestamp,
                          6);
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo ' || systimestamp,
                            6);
  end prc_gn_acto_ttlo_jdcial_slctud;

  procedure prc_gn_rprte_ttlo_jdcial_slctd(p_cdgo_clnte            in number,
                                           p_id_ttlo_jdcial_dcmnto in number default null,
                                           p_cdgo_acto_tpo         in gn_d_actos_tipo.cdgo_acto_tpo%type,
                                           p_json_ttlos            in clob default null,
                                           p_id_plntlla            in number,
                                           p_id_acto               in number,
                                           o_cdgo_rspsta           out number,
                                           o_mnsje_rspsta          out varchar2) as
  
    --------------------------------------------------------------
    --&Procedimiento para generar y actualizar el blob del acto&--
    --------------------------------------------------------------
  
    v_error          exception;
    v_nl             number;
    v_gn_d_reportes  gn_d_reportes%rowtype;
    v_blob           blob;
    v_app_page_id    number := v('APP_PAGE_ID');
    v_app_id         number := v('APP_ID');
    v_json           clob;
    v_id_ttlo_jdcial number := null;
    v_nmbre_up       varchar2(100) := 'pkg_gf_titulos_judicial.prc_gn_rprte_ttlo_jdcial_slctd';
    v_instnc_fljo    number;
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando ' || systimestamp,
                          6);
  
    --1. Se consultan datos del reporte
    begin
      select b.*
        into v_gn_d_reportes
        from gn_d_plantillas a
        join gn_d_reportes b
          on a.id_rprte = b.id_rprte
       where a.cdgo_clnte = p_cdgo_clnte
         and a.id_plntlla = p_id_plntlla;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error al encontrar datos del reporte asociado al acto de solicitud. Error No. ' ||
                          o_cdgo_rspsta || SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --1.1. Se consultan las instancia del flujo
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Paso 00 Entrando: ',
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Paso 02 p_id_ttlo_jdcial_dcmnto: ' ||
                          p_id_ttlo_jdcial_dcmnto,
                          6);
  
    begin
      select distinct c.id_instncia_fljo --, c.id_ttlo_jdcial
        into v_instnc_fljo --, v_id_ttlo_jdcial
        from gf_g_ttls_jdcl_dcmnt_asccn b
        join gf_g_titulos_judicial c
          on b.id_ttlo_jdcial = c.id_ttlo_jdcial
       where b.Id_Ttlo_Jdcial_Dcmnto = p_id_ttlo_jdcial_dcmnto;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'No se pudo obtener la instancia del flujo. Error No. ' ||
                          o_cdgo_rspsta || SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Paso 01 v_instnc_fljo: ' || v_instnc_fljo,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Paso 02 p_id_ttlo_jdcial_dcmnto: ' ||
                          p_id_ttlo_jdcial_dcmnto,
                          6);
  
    --Si existe la Sesion
    apex_session.attach(p_app_id     => 66000,
                        p_page_id    => 2,
                        p_session_id => v('APP_SESSION'));
  
    declare
      v_json        JSON_OBJECT_T := JSON_OBJECT_T();
      v_id_ttl_jdcl JSON_ARRAY_T := JSON_ARRAY_T();
    begin
      v_json.put('id_plntlla', p_id_plntlla);
      v_json.put('id_ttlo_jdcial_dcmnto', p_id_ttlo_jdcial_dcmnto);
      v_json.put('cdgo_acto_tpo', p_cdgo_acto_tpo);
      -- nuevo 17/11/2023
      v_json.put('id_instncia_fljo', v_instnc_fljo);
      -- fin nuevo
      v_json.put('id_ttlo_jdcial', v_id_ttl_jdcl);
    
      for c_ttlo in (select a.id_ttlo_jdcial
                       from gf_g_ttls_jdcl_dcmnt_asccn a
                       join gf_g_titulos_jdcial_dcmnto b
                         on b.id_ttlo_jdcial_dcmnto =
                            a.id_ttlo_jdcial_dcmnto
                      where b.id_ttlo_jdcial_dcmnto =
                            p_id_ttlo_jdcial_dcmnto) loop
        v_id_ttl_jdcl.append(c_ttlo.id_ttlo_jdcial);
      end loop;
      v_json.put('id_ttlo_jdcial', v_id_ttl_jdcl);
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'v_json: ' || v_json.to_string(),
                            6);
    end;
    -- nuevo 17/11/2023
    apex_util.set_session_state('P2_XML',
                                '<data>
                                    <id_plntlla>' ||
                                p_id_plntlla ||
                                '</id_plntlla>
                                    <id_ttlo_jdcial_dcmnto>' ||
                                p_id_ttlo_jdcial_dcmnto ||
                                '</id_ttlo_jdcial_dcmnto>
                                    <cdgo_acto_tpo>' ||
                                p_cdgo_acto_tpo ||
                                '</cdgo_acto_tpo>
                                    <id_instncia_fljo>' ||
                                v_instnc_fljo ||
                                '</id_instncia_fljo>
                                    <id_ttlo_jdcial>' ||
                                v_id_ttlo_jdcial ||
                                '</id_ttlo_jdcial>
                                  </data>');
    -- NOTA: VALIDAR ESTA VARIABLE A ENVIAR COMO XML: v_id_ttl_jdcl
    -- fin nuevo
  
    --Seteamos en session los items necesarios para generar el archivo
    apex_util.set_session_state('F_CDGO_CLNTE', p_cdgo_clnte);
    apex_util.set_session_state('P2_ID_RPRTE', v_gn_d_reportes.id_rprte);
  
    --3. construccion del blob del acto
    begin
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Entrando a generar el blob',
                            6);
    
      v_blob := apex_util.get_print_document(p_application_id     => 66000,
                                             p_report_query_name  => v_gn_d_reportes.nmbre_cnslta,
                                             p_report_layout_name => v_gn_d_reportes.nmbre_plntlla,
                                             p_report_layout_type => v_gn_d_reportes.cdgo_frmto_plntlla,
                                             p_document_format    => v_gn_d_reportes.cdgo_frmto_tpo);
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error al encontrar datos del reporte asociado al acto de solicitud. Error No. ' ||
                          o_cdgo_rspsta || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    if v_blob is not null then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'blob generado',
                            6);
      --4. actualizacion del acto
      begin
        pkg_gn_generalidades.prc_ac_acto(p_file_blob       => v_blob,
                                         p_id_acto         => p_id_acto,
                                         p_ntfccion_atmtca => 'N');
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error al encontrar datos del reporte asociado al acto de solicitud. Error No. ' ||
                            o_cdgo_rspsta || SQLCODE || ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
    else
      o_cdgo_rspsta  := 19;
      o_mnsje_rspsta := 'Error ' || o_cdgo_rspsta ||
                        ' - Problemas al generar el blob';
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      raise v_error;
    end if;
  
    -- retorna a la aplicacion actual
    apex_session.attach(p_app_id     => v_app_id,
                        p_page_id    => v_app_page_id,
                        p_session_id => v('APP_SESSION'));
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      /* raise_application_error(-20001, o_mnsje_rspsta);*/
  end prc_gn_rprte_ttlo_jdcial_slctd;

  procedure prc_rg_titulo_medida_cautelar(p_cdgo_clnte        in number,
                                          p_id_embrgo_rslcion in number,
                                          p_id_ttlo_jdcial    in number,
                                          p_id_usrio          in number,
                                          o_cdgo_rspsta       out number,
                                          o_mnsje_rspsta      out varchar2) as
  
    --------------------------------------------------------------------
    ---&Procedimiento para asociar medida cautelar a titulo judicial&---
    --------------------------------------------------------------------
  
    v_nl                    number;
    v_id_sjto_rspnsble      number;
    v_idntfccion_dmnddo     gf_g_titulos_judicial.idntfccion_dmnddo%type;
    v_id_instncia_fljo_hjo  number;
    v_id_fljo_trea_orgen    number;
    v_type_rspsta           varchar2(1);
    v_error_msg             varchar2(4000);
    v_mnsje_rspsta          varchar2(4000);
    v_id_ttlo_jdcial_impsto number;
    v_error                 exception;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulo_medida_cautelar';
    v_nmro_ttlo_jdcial      gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_fljo_trea             number;
  
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. se valida la identificacion del demandado
    begin
      select idntfccion_dmnddo
        into v_idntfccion_dmnddo
        from gf_g_titulos_judicial
       where cdgo_clnte = p_cdgo_clnte
         and id_ttlo_jdcial = p_id_ttlo_jdcial;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas consultar la identificacion del demandado' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'v_idntfccion_dmnddo:' || v_idntfccion_dmnddo,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_id_embrgo_rslcion:' || p_id_embrgo_rslcion,
                          6);
  
    --2. se actualiza la medida cautelar generadora del titulo
    begin
      update gf_g_titulos_judicial
         set id_embrgo_rslcion = p_id_embrgo_rslcion
       where cdgo_clnte = p_cdgo_clnte
         and id_ttlo_jdcial = p_id_ttlo_jdcial;
    exception
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al asociar la medida cautelar generadora del titulo ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'p_id_embrgo_rslcion:' || p_id_embrgo_rslcion,
                          6);
  
    --se recorre el detalle de la cartera de la medida cautelar
    for c_mdda_ctlar_impstos in (select distinct c.id_impsto,
                                                 c.id_impsto_sbmpsto,
                                                 b.id_sjto_impsto
                                   from mc_g_embargos_resolucion a
                                   join mc_g_embargos_cartera_detalle b
                                     on a.id_embrgos_crtra =
                                        b.id_embrgos_crtra
                                   join gf_g_movimientos_financiero c
                                     on b.id_sjto_impsto = c.id_sjto_impsto
                                    and b.vgncia = c.vgncia
                                    and b.id_prdo = c.id_prdo
                                  where a.id_embrgos_rslcion =
                                        p_id_embrgo_rslcion) loop
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'dentro del loop c_mdda_ctlar_impstos.',
                            6);
    
      --3. se consulta el sujeto responsable de la medida cautelar para guardarlo
      begin
        select id_sjto_rspnsble
          into v_id_sjto_rspnsble
          from si_i_sujetos_responsable
         where id_sjto_impsto = c_mdda_ctlar_impstos.id_sjto_impsto
           and trim(idntfccion) = v_idntfccion_dmnddo;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'v_id_sjto_rspnsble:' || v_id_sjto_rspnsble,
                              6);
      
        --4. se insertan los impuestos generadores de la medida cautelar
        begin
          insert into gf_g_titulos_jdcial_impsto
            (id_ttlo_jdcial,
             id_impsto,
             id_impsto_sbmpsto,
             id_sjto_impsto,
             id_sjto_rspnsble)
          values
            (p_id_ttlo_jdcial,
             c_mdda_ctlar_impstos.id_impsto,
             c_mdda_ctlar_impstos.id_impsto_sbmpsto,
             c_mdda_ctlar_impstos.id_sjto_impsto,
             v_id_sjto_rspnsble)
          returning id_ttlo_jdcial_impsto into v_id_ttlo_jdcial_impsto;
        exception
          when others then
            o_cdgo_rspsta  := 4;
            o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                              ' problemas insertar impuesto de la medida cautelar generadora del titulo ' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'v_id_ttlo_jdcial_impsto:' ||
                              v_id_ttlo_jdcial_impsto,
                              6);
      
      exception
        when no_data_found then
          o_cdgo_rspsta  := 3;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' problemas al encontrar el el sujeto responsable' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      -- se recorre la cartera asociada a la medida cautelar
      for c_mdda_ctlar_crtra in (select a.vgncia,
                                        a.id_prdo,
                                        a.id_cncpto,
                                        z.vlor_sldo_cptal as vlor_cptal,
                                        z.vlor_intres,
                                        (z.vlor_sldo_cptal + z.vlor_intres) as vlor_ttal
                                   from mc_g_embargos_cartera_detalle a
                                   join v_gf_g_cartera_x_concepto z
                                     on z.id_mvmnto_fncro =
                                        a.id_mvmnto_fncro
                                    and z.id_impsto = a.id_impsto
                                    and z.id_impsto_sbmpsto =
                                        a.id_impsto_sbmpsto
                                    and z.vgncia = a.vgncia
                                    and z.id_prdo = a.id_prdo
                                    and z.id_cncpto = a.id_cncpto
                                   join df_i_periodos b
                                     on a.id_prdo = b.id_prdo
                                   join df_i_conceptos c
                                     on a.id_cncpto = c.id_cncpto
                                 --join si_i_sujetos_impuesto           d on a.id_sjto_impsto = d.id_sjto_impsto
                                   join df_c_impuestos e
                                     on a.id_impsto = e.id_impsto
                                   join v_gf_g_ttlos_mc_g_embrgs_res f
                                     on f.id_embrgos_crtra =
                                        a.id_embrgos_crtra
                                  where f.id_embrgos_rslcion =
                                        p_id_embrgo_rslcion
                                    and a.id_sjto_impsto =
                                        c_mdda_ctlar_impstos.id_sjto_impsto
                                    and a.id_impsto =
                                        c_mdda_ctlar_impstos.id_impsto
                                    and a.id_impsto_sbmpsto =
                                        c_mdda_ctlar_impstos.id_impsto_sbmpsto
                                 /*select b.vgncia--distinct b.vgncia
                                                          ,b.id_prdo
                                    ,b.id_cncpto
                                    ,b.vlor_cptal
                                    ,b.vlor_intres
                                                          ,(b.vlor_cptal+b.vlor_intres) as vlor_ttal
                                  from mc_g_embargos_resolucion         a
                                  join mc_g_embargos_cartera_detalle    b on a.id_embrgos_crtra =  b.id_embrgos_crtra
                                  join gf_g_movimientos_financiero      c on b.id_sjto_impsto   = c.id_sjto_impsto
                                   and b.vgncia = c.vgncia
                                   and b.id_prdo = c.id_prdo
                                 where a.id_embrgos_rslcion = p_id_embrgo_rslcion
                                   and c.id_sjto_impsto = c_mdda_ctlar_impstos.id_sjto_impsto
                                   and c.id_impsto = c_mdda_ctlar_impstos.id_impsto
                                   and c.id_impsto_sbmpsto = c_mdda_ctlar_impstos.id_impsto_sbmpsto*/
                                 ) loop
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'dentro del loop c_mdda_ctlar_crtra.',
                              6);
      
        --5. se inserta la cartera asociada a la medida cautelar
        begin
          insert into gf_g_titulos_jdcial_vgncia
            (id_ttlo_jdcial_impsto, vgncia, id_prdo)
          values
            (v_id_ttlo_jdcial_impsto,
             c_mdda_ctlar_crtra.vgncia,
             c_mdda_ctlar_crtra.id_prdo);
        exception
          when others then
            o_cdgo_rspsta  := 5;
            o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                              ' problemas insertar la cartera asociada a la medida cautelar' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      
      end loop;
    
    end loop;
  
    -- se recorre la cartera asociada a la medida cautelar
    for c_mdda_ctlar_otrs_crtra in (select c.vgncia,
                                           c.id_prdo,
                                           c.id_cncpto,
                                           c.vlor_sldo_cptal vlor_cptal,
                                           c.vlor_intres vlor_intres,
                                           (c.vlor_sldo_cptal +
                                           c.vlor_intres) vlor_ttal
                                      from (select a.id_embrgos_crtra,
                                                   a.id_sjto_impsto
                                              from mc_g_embargos_cartera_detalle a
                                             group by a.id_embrgos_crtra,
                                                      a.id_sjto_impsto) b
                                      join v_gf_g_cartera_x_concepto c
                                        on c.id_sjto_impsto =
                                           b.id_sjto_impsto
                                       and c.vgncia not in
                                           (select z.vgncia
                                              from mc_g_embargos_cartera_detalle z
                                             where z.id_sjto_impsto =
                                                   b.id_sjto_impsto)
                                      join v_si_i_sujetos_impuesto d
                                        on c.id_sjto_impsto =
                                           d.id_sjto_impsto
                                     where c.vlor_sldo_cptal > 0
                                       and d.idntfccion_sjto =
                                           v_idntfccion_dmnddo) loop
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'dentro del loop c_mdda_ctlar_otrs_crtra.',
                            6);
    
      --5. se inserta la cartera asociada a la medida cautelar
      begin
        insert into gf_g_ttlos_jdcl_otras_crtra
          (id_ttlo_jdcial_impsto,
           vgncia,
           id_prdo,
           id_cncpto /*,vlor_cptal, vlor_intres,vlor_ttal*/)
        values
          (v_id_ttlo_jdcial_impsto,
           c_mdda_ctlar_otrs_crtra.vgncia,
           c_mdda_ctlar_otrs_crtra.id_prdo,
           c_mdda_ctlar_otrs_crtra.id_cncpto /*, c_mdda_ctlar_otrs_crtra.vlor_cptal, c_mdda_ctlar_otrs_crtra.vlor_intres,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              c_mdda_ctlar_otrs_crtra.vlor_ttal*/);
      exception
        when others then
          o_cdgo_rspsta  := 5;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' problemas al insertar otras carteras' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
    end loop;
    commit;
  
    /*--se consulta el flujo y la tarea para cambio de etapa
        begin
    
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'p_id_ttlo_jdcial: '||p_id_ttlo_jdcial, 6);
            select a.id_instncia_fljo_hjo,
                   b.id_fljo_trea_orgen,
                   a.nmro_ttlo_jdcial
              into v_id_instncia_fljo_hjo,
                   v_id_fljo_trea_orgen,
                   v_nmro_ttlo_jdcial
              from gf_g_titulos_judicial a
              join wf_g_instancias_transicion b on a.id_instncia_fljo_hjo = b.id_instncia_fljo
                                                and b.id_estdo_trnscion in (1,2)
              where id_ttlo_jdcial = p_id_ttlo_jdcial;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'v_id_instncia_fljo_hjo: '||v_id_instncia_fljo_hjo||
                                                                ', v_id_fljo_trea_orgen: '||v_id_fljo_trea_orgen||
                                                                ', v_nmro_ttlo_jdcial: '||v_nmro_ttlo_jdcial, 6);
    
                pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                                 p_id_fljo_trea   => v_id_fljo_trea_orgen,
                                                                 p_json       => '[]' ,
                                                                 o_type       => v_type_rspsta,
                                                                 o_mnsje      => v_mnsje_rspsta,
                                                                 o_id_fljo_trea   => v_fljo_trea,
                                                                 o_error      => v_error_msg);
                 if v_type_rspsta = 'S' then
                    o_cdgo_rspsta := 7;
                    o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al transitar a la etapa siguiente. '||v_mnsje_rspsta||' - '||sqlerrm;
                    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                    raise v_error;
                 end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'v_type_rspsta: '||v_type_rspsta||
                                                                ', v_mnsje_rspsta: '||v_mnsje_rspsta||
                                                                ', v_fljo_trea: '||v_fljo_trea||
                                                                ', v_error_msg: '||v_error_msg, 6);
    
        exception
            when no_data_found then
                o_cdgo_rspsta := 6;
                o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al encontrar el flujo y tarea para trasitar a la etapa siguiente'||sqlerrm;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                raise v_error;
        end;*/
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Medida Cautelar Asociada al Titulo Judicial Exitosamente!';
      commit;
    end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'o_mnsje_rspsta: ' || o_mnsje_rspsta,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo: ' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  end prc_rg_titulo_medida_cautelar;

  procedure prc_rg_anlisis_devolucion_ttlo(p_cdgo_clnte        in number,
                                           p_id_embrgo_rslcion in number,
                                           p_id_ttlo_jdcial    in number,
                                           p_id_usrio          in number,
                                           o_cdgo_rspsta       out number,
                                           o_mnsje_rspsta      out varchar2) as
  
    --------------------------------------------------------------
    --&procedimiento analisis de devolucion del titulo judicial&--
    --------------------------------------------------------------
  
    v_error                  exception;
    v_nl                     number;
    v_id_instncia_fljo_hjo   number;
    v_id_fljo_trea_orgen     number;
    v_type_rspsta            varchar2(1);
    v_error_msg              number;
    v_exste_crtra            varchar2(1);
    v_exste_mdda_ctlar       varchar2(1);
    v_idntfccion_dmnddo      gf_g_titulos_judicial.idntfccion_dmnddo%type;
    v_nmro_ttlo_jdcial       gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_cdgo_ttlo_jdcial_estdo varchar2(5);
    v_nmbre_up               varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_anlisis_devolucion_ttlo';
    v_fljo_trea              number;
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. Se consulta si esta vigente la medida cautelar
    v_exste_mdda_ctlar := pkg_gf_titulos_judicial.fnc_co_existe_medida_cautelar(p_cdgo_clnte        => p_cdgo_clnte,
                                                                                p_id_embrgo_rslcion => p_id_embrgo_rslcion);
  
    --2. consultamos la identificacion del demandado
    begin
      select idntfccion_dmnddo
        into v_idntfccion_dmnddo
        from gf_g_titulos_judicial
       where cdgo_clnte = p_cdgo_clnte
         and id_ttlo_jdcial = p_id_ttlo_jdcial;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          'no se encontro medida cautelar';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --3. guardamos informacion relacionada a movimientos con saldo > 0
    begin
    
      execute immediate 'truncate table gf_t_titulos_jdcial_mvmnto';
    
      insert into gf_t_titulos_jdcial_mvmnto
        (id_ttlo_jdcial, id_sjto_impsto, cntdad)
        select id_ttlo_jdcial, id_sjto_impsto, cntdad
          from (select b.id_ttlo_jdcial, b.id_sjto_impsto, count(*) cntdad
                  from v_gf_g_cartera_x_vigencia a
                  join (select a.id_sjto_impsto, b.id_ttlo_jdcial
                         from si_i_sujetos_responsable a
                         left join gf_g_titulos_jdcial_impsto b
                           on a.id_sjto_impsto = b.id_sjto_impsto
                          and b.id_ttlo_jdcial = p_id_ttlo_jdcial
                        where trim(idntfccion) = v_idntfccion_dmnddo
                        group by b.id_ttlo_jdcial, a.id_sjto_impsto) b
                    on a.id_sjto_impsto = b.id_sjto_impsto
                 where a.cdgo_clnte = p_cdgo_clnte
                   and a.vlor_sldo_cptal > 0
                 group by b.id_sjto_impsto, b.id_ttlo_jdcial)
         where cntdad > 0;
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' al guardar informacion de cartera';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --buscamos dentro de la temporal si existe minimo una cartera
    begin
    
      select 'S'
        into v_exste_crtra
        from gf_t_titulos_jdcial_mvmnto
       where id_ttlo_jdcial = p_id_ttlo_jdcial
         and rownum = 1;
    
    exception
      when no_data_found then
        v_exste_crtra := 'N';
    end;
  
    -- se evaluan los criterios para devolver el titulo judicial
    if v_exste_mdda_ctlar = 'N' and v_exste_crtra = 'N' then
    
      --4. se actualiza el estado del titulo para proceder a solicitud de devolucion
      begin
      
        update gf_g_titulos_judicial
           set cdgo_ttlo_jdcial_estdo = 'ASL'
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            'no se actualizo el titulo judicial';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      --5. Registro de traza de titulos judiciales
      begin
      
        begin
          select cdgo_ttlo_jdcial_estdo, nmro_ttlo_jdcial
            into v_cdgo_ttlo_jdcial_estdo, v_nmro_ttlo_jdcial
            from gf_g_titulos_judicial
           where cdgo_clnte = p_cdgo_clnte
             and id_ttlo_jdcial = p_id_ttlo_jdcial;
        end;
      
        pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                     p_id_ttlo_jdcial         => p_id_ttlo_jdcial,
                                                     p_cdgo_ttlo_jdcial_estdo => v_cdgo_ttlo_jdcial_estdo,
                                                     p_obsrvcion              => 'Titulo Judicial No. ' ||
                                                                                 v_nmro_ttlo_jdcial ||
                                                                                 ' Apto para Solicitud',
                                                     p_id_usrio               => p_id_usrio,
                                                     p_indcdor_rqre_aprbccion => 'N',
                                                     o_cdgo_rspsta            => o_cdgo_rspsta,
                                                     o_mnsje_rspsta           => o_mnsje_rspsta);
      
        if o_cdgo_rspsta != 0 then
          o_cdgo_rspsta  := 5;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al registrar traza de titulo judicial. ' ||
                            o_mnsje_rspsta || sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
        end if;
      
      end;
    
    end if;
  
    --6. se consulta el flujo y la tarea para cambio de etapa
    begin
    
      select a.id_instncia_fljo, b.id_fljo_trea_orgen, a.nmro_ttlo_jdcial
        into v_id_instncia_fljo_hjo,
             v_id_fljo_trea_orgen,
             v_nmro_ttlo_jdcial
        from gf_g_titulos_judicial a
        join wf_g_instancias_transicion b
          on a.id_instncia_fljo = b.id_instncia_fljo
         and b.id_estdo_trnscion in (1, 2)
       where id_ttlo_jdcial = p_id_ttlo_jdcial;
    
      pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                       p_id_fljo_trea     => v_id_fljo_trea_orgen,
                                                       p_json             => '[]',
                                                       o_type             => v_type_rspsta,
                                                       o_mnsje            => o_mnsje_rspsta,
                                                       o_id_fljo_trea     => v_fljo_trea,
                                                       o_error            => v_error_msg);
      if v_type_rspsta = 'S' then
        o_cdgo_rspsta  := 7;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al trasitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 6;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al encontrar el flujo y tarea para trasitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := 'Titulo Judicial N? ' || v_nmro_ttlo_jdcial ||
                        ' Apto para Solicitud de Devolucion';
    elsif o_cdgo_rspsta is null then
      o_mnsje_rspsta := '!Contribuyente Con Cartera Pendiente!';
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20001, o_mnsje_rspsta);
  end prc_rg_anlisis_devolucion_ttlo;

  procedure prc_rg_acto_dvlcion_ttlo_jdcial(p_cdgo_clnte            in number,
                                            p_json_ttlos            in clob,
                                            p_id_ttlo_jdcial_dcmnto in number,
                                            p_id_usrio              in number,
                                            p_id_plntlla            in number,
                                            o_id_acto               out number,
                                            o_cdgo_rspsta           out number,
                                            o_mnsje_rspsta          out varchar2) as
  
    ------------------------------------------------------------------
    --&procedimiento registro de acto de devolucion titulo judicial&--
    ------------------------------------------------------------------
  
    v_error                 exception;
    v_nl                    number;
    v_id_instncia_fljo_hjo  number;
    v_id_fljo_trea_orgen    number;
    v_type_rspsta           varchar2(1);
    v_error_msg             number;
    v_id_ttlo_jdcial_slctud number;
    v_id_acto_tpo           number;
    v_cdgo_acto_tpo         gn_d_actos_tipo.cdgo_acto_tpo%type;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_acto_dvlcion_ttlo_jdcial';
    v_fljo_trea             number;
  
  begin
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. Consultamos el tipo de acto
    begin
      select b.id_acto_tpo, b.cdgo_acto_tpo
        into v_id_acto_tpo, v_cdgo_acto_tpo
        from gn_d_plantillas a
        join gn_d_actos_tipo b
          on a.id_acto_tpo = b.id_acto_tpo
       where b.cdgo_clnte = p_cdgo_clnte
         and a.id_plntlla = p_id_plntlla;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error al encontrar el tipo de acto. Error No. ' ||
                          o_cdgo_rspsta || SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --2. generan acto de devolucion de titulo judicial
    begin
    
      pkg_gf_titulos_judicial.prc_gn_acto_ttlo_jdcial_slctud(p_cdgo_clnte    => p_cdgo_clnte,
                                                             p_json_ttlos    => p_json_ttlos,
                                                             p_cdgo_acto_tpo => v_cdgo_acto_tpo,
                                                             p_cdgo_cnsctvo  => v_cdgo_acto_tpo, --'TJP',
                                                             p_id_usrio      => p_id_usrio,
                                                             o_id_acto       => o_id_acto,
                                                             o_cdgo_rspsta   => o_cdgo_rspsta,
                                                             o_mnsje_rspsta  => o_mnsje_rspsta);
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error Generar el oficio de solicitud de devolucion. Error: ' ||
                          o_cdgo_rspsta || o_mnsje_rspsta || ' - ' ||
                          SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
  
    -- valida si el acto fue registrado
    if o_id_acto is not null then
    
      --3. Generacion de reporte y actualizacion de acto
      begin
        pkg_gf_titulos_judicial.prc_gn_rprte_ttlo_jdcial_slctd(p_cdgo_clnte            => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_dcmnto => p_id_ttlo_jdcial_dcmnto,
                                                               p_cdgo_acto_tpo         => v_cdgo_acto_tpo,
                                                               p_id_plntlla            => p_id_plntlla,
                                                               p_id_acto               => o_id_acto,
                                                               o_cdgo_rspsta           => o_cdgo_rspsta,
                                                               o_mnsje_rspsta          => o_mnsje_rspsta);
        if o_cdgo_rspsta != 0 then
          o_cdgo_rspsta  := 3;
          o_mnsje_rspsta := 'Error al registrar el blob. Error No. ' ||
                            o_cdgo_rspsta || o_mnsje_rspsta || SQLCODE ||
                            ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
        end if;
      
      end;
    
      --4. actualizacion tabla documentos de titulos
      begin
        update gf_g_titulos_jdcial_dcmnto
           set id_acto = o_id_acto,
               --,id_acto_tpo = v_id_acto_tpo
               indcdor_acto_cnfrmcion = 'S'
         where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
      
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error al actualizar el documento del acto de la solicitud. Error:' ||
                            SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      --Se recorren las solicitudes asociadas al documento
      for c_ttlo_jdcial_slctud in (select id_ttlo_jdcial_slctud
                                     from gf_g_ttlos_jdcl_dcmnt_slctd
                                    where id_ttlo_jdcial_dcmnto =
                                          p_id_ttlo_jdcial_dcmnto) loop
      
        --5. actualizacion confirmacion solicitud
        begin
          update gf_g_titulos_jdcial_slctud
             set indcdor_slctud_cnfrmcion = 'S', fcha_rspsta = sysdate
           where id_ttlo_jdcial_slctud =
                 c_ttlo_jdcial_slctud.id_ttlo_jdcial_slctud;
        
        exception
          when others then
            o_cdgo_rspsta  := 5;
            o_mnsje_rspsta := 'Error al actualizar el documento del acto de la solicitud. Error:' ||
                              SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      
      end loop;
    
      --Se recorren los titulos judiciales para actualizacion y finalizacion de flujo
      for c_ttlo_jdcial in (select a.id_ttlo_jdcial
                              from gf_g_titulos_judicial a
                              join (select id_ttlo_jdcial
                                     from json_table(p_json_ttlos,
                                                     '$[*]'
                                                     columns(id_ttlo_jdcial
                                                             varchar2 path
                                                             '$.id_ttlo_jdcial'))) b
                                on a.id_ttlo_jdcial = b.id_ttlo_jdcial) loop
      
        --7. actualizacion estado del titulo
        begin
          update gf_g_titulos_judicial
             set cdgo_ttlo_jdcial_estdo = 'CDT'
           where cdgo_clnte = p_cdgo_clnte
             and id_ttlo_jdcial = c_ttlo_jdcial.id_ttlo_jdcial;
        
        exception
          when others then
            o_cdgo_rspsta  := 7;
            o_mnsje_rspsta := 'Error al actualizar el estado del titulo judicial. Error:' ||
                              SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      
        --8. Registro de traza de titulos judiciales
        begin
          pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                       p_id_ttlo_jdcial         => c_ttlo_jdcial.id_ttlo_jdcial,
                                                       p_cdgo_ttlo_jdcial_estdo => 'CDT',
                                                       p_obsrvcion              => 'Confirmacion Devolucion',
                                                       p_id_usrio               => p_id_usrio,
                                                       p_indcdor_rqre_aprbccion => 'N',
                                                       o_cdgo_rspsta            => o_cdgo_rspsta,
                                                       o_mnsje_rspsta           => o_mnsje_rspsta);
        
          if o_cdgo_rspsta != 0 then
            o_cdgo_rspsta  := 8;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al registrar traza de titulo judicial' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
          end if;
        
        end;
      
      /*begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      select a.id_instncia_fljo,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.id_fljo_trea_orgen
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          into v_id_instncia_fljo_hjo,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               v_id_fljo_trea_orgen
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          from gf_g_titulos_judicial a
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          join wf_g_instancias_transicion b on a.id_instncia_fljo = b.id_instncia_fljo
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            and b.id_estdo_trnscion in (1,2)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          where id_ttlo_jdcial = c_ttlo_jdcial.id_ttlo_jdcial;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               p_id_fljo_trea   => v_id_fljo_trea_orgen,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               p_json       => '[]' ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_type       => v_type_rspsta,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_mnsje      => o_mnsje_rspsta,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_id_fljo_trea   => v_fljo_trea,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_error      => v_error_msg);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           if v_type_rspsta = 'S' then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              o_cdgo_rspsta := 3;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al trasitar a la etapa siguiente'||sqlerrm;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              raise v_error;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           end if;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  end;*/
      
      end loop;
    
    end if;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Acto de Devolucion Generado Satisfactoriamente!';
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20001, o_mnsje_rspsta);
  end prc_rg_acto_dvlcion_ttlo_jdcial;

  procedure prc_tr_fnlzar_fljo_ttlo_jdcial(p_cdgo_clnte   in number,
                                           p_json_ttlos   in clob,
                                           p_id_usrio     in number,
                                           p_id_acto      in number,
                                           p_indcdr_act   in varchar2 default 'N', --2023-11-14x|
                                           o_cdgo_rspsta  out number,
                                           o_mnsje_rspsta out varchar2) is
    -----------------------------------------------------------
    ---&procedimiento finalizacion de flujo titulo judicial&---
    -----------------------------------------------------------
    v_nl               number;
    v_error            exception;
    v_id_instncia_fljo number;
    v_id_slctud        number;
    v_id_mtvo          number;
    v_id_fljo_trea     number;
    v_indcdor          varchar2(1);
    v_cdgo_rspsta      varchar2(3);
    v_nmbre_up         varchar2(100) := 'pkg_gf_titulos_judicial.prc_tr_fnlzar_fljo_ttlo_jdcial';
  begin
  
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'OK';
  
    insert into muerto
      (n_001, v_001, c_001, t_001)
    values
      (55, 'prc_tr_fnlzar_fljo_ttlo_jdcial', p_json_ttlos, systimestamp);
    commit;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando-->' || p_cdgo_clnte,
                          1);
  
    /***    for c_ttlos_jdcial in (select a.id_ttlo_jdcial
    from gf_g_titulos_judicial a
    join (select id_ttlo_jdcial
           from json_table(p_json_ttlos,
                           '$[*]'
                           columns(id_ttlo_jdcial
                                   varchar2 path
                                   '$.ID_TTLO_JDCIAL'))) b
      on a.id_ttlo_jdcial = b.id_ttlo_jdcial
      where a.id_ttlo_jdcial = 145 ) loop ***/
    for c_ttlos_jdcial in (select a.id_ttlo_jdcial, b.Observaciones
                             from gf_g_titulos_judicial a
                             join (select id_ttlo_jdcial, Observaciones
                                    from json_table(p_json_ttlos,
                                                    '$[*]'
                                                    columns(id_ttlo_jdcial
                                                            varchar2 path
                                                            '$.ID_TTLO_JDCIAL',
                                                            Observaciones
                                                            varchar2 path
                                                            '$.Observaciones'))
                                   where Observaciones is not null) b
                               on a.id_ttlo_jdcial = b.id_ttlo_jdcial) loop
      begin
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'En el FOR',
                              1);
        select a.id_instncia_fljo, b.id_fljo_trea_orgen
          into v_id_instncia_fljo, v_id_fljo_trea
          from gf_g_titulos_judicial a
          join wf_g_instancias_transicion b
            on a.id_instncia_fljo = b.id_instncia_fljo
           and b.id_estdo_trnscion in (1, 2)
         where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
      
        begin
        
          pkg_pl_workflow_1_0.prc_rg_finalizar_instancia(p_id_instncia_fljo => v_id_instncia_fljo,
                                                         p_id_fljo_trea     => v_id_fljo_trea,
                                                         p_id_usrio         => p_id_usrio,
                                                         o_error            => v_indcdor,
                                                         o_msg              => o_mnsje_rspsta);
        
          if v_indcdor = 'N' then
            o_cdgo_rspsta  := 2;
            o_mnsje_rspsta := 'Error etapa finalizacion flujo modificacion. Error: ' ||
                              o_cdgo_rspsta || ' - ' || o_mnsje_rspsta;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
          else
          
            -- Se actualiza el estado del titulo a REGISTRADO  cuando se finaliza el flujo o proceso por el usuario 2023-11-14
            -- Se Guarda la traza del registro actualizado 2023-11-15
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  'Paso 01 c_ttlos_jdcial.id_ttlo_jdcial: ' ||
                                  c_ttlos_jdcial.id_ttlo_jdcial,
                                  1);
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  'p_id_usrio: ' || p_id_usrio,
                                  1);
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  'Observaciones: ' ||
                                  c_ttlos_jdcial.Observaciones,
                                  1);
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  'v_id_fljo_trea: ' || v_id_fljo_trea,
                                  1);
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  'p_indcdr_act: ' || p_indcdr_act,
                                  1);
          
            if p_indcdr_act = 'S' then
            
              -- Se inserta la traza del titulo
              begin
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      'Llamado ala UP de traza',
                                      6);
              
                /* pkg_gf_titulos_judicial.prc_rg_titulo_finaliza_traza (  p_cdgo_clnte        => p_cdgo_clnte,
                                                                         p_id_ttlo_jdcial    => c_ttlos_jdcial.id_ttlo_jdcial,
                                                                         p_id_usrio          => p_id_usrio,
                                                                         p_cdgo_ttlo_nvo   => 'RGS',
                                                                         p_obsrvcion         => c_ttlos_jdcial.cdgo_csal_fnliza,
                                                                         p_id_fljo_trea    => v_id_fljo_trea,
                                                                         o_cdgo_rspsta       => o_cdgo_rspsta,
                                                                         o_mnsje_rspsta      => o_mnsje_rspsta );
                */
              
                begin
                  insert into gf_g_titulos_judicial_traza
                    (id_ttlo_jdcial,
                     cdgo_ttlo_jdcial_estdo,
                     obsrvcion,
                     id_usrio,
                     fcha)
                  values
                    (c_ttlos_jdcial.id_ttlo_jdcial,
                     'RGS',
                     c_ttlos_jdcial.Observaciones,
                     p_id_usrio,
                     sysdate);
                exception
                  when others then
                    o_cdgo_rspsta  := 1;
                    o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                      'Error al registrar traza del Titulo Registrado';
                    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                          null,
                                          v_nmbre_up,
                                          v_nl,
                                          o_mnsje_rspsta || ' , ' ||
                                          sqlerrm,
                                          6);
                    return;
                end;
              
                if o_cdgo_rspsta != 0 then
                  o_cdgo_rspsta  := 4;
                  o_mnsje_rspsta := 'No. ' || o_cdgo_rspsta ||
                                    o_mnsje_rspsta;
                  pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                        null,
                                        v_nmbre_up,
                                        v_nl,
                                        o_mnsje_rspsta,
                                        1);
                  rollback;
                  return;
                end if;
              exception
                when others then
                  o_cdgo_rspsta  := 5;
                  o_mnsje_rspsta := 'No. ' || o_cdgo_rspsta ||
                                    ' Error al insertar la traza. ' ||
                                    sqlerrm;
                  pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                        null,
                                        v_nmbre_up,
                                        v_nl,
                                        o_mnsje_rspsta,
                                        1);
                  rollback;
                  return;
              end; -- Fin Se inserta la traza del titulo
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    'Saliendo de la UP de traza',
                                    1);
            
              -- Eliminamos las vigencias comprometidas con Cartera
              delete from gf_g_titulos_jdcial_vgncia a
               where a.id_ttlo_jdcial_impsto in
                     (select b.id_ttlo_jdcial_impsto b
                        from gf_g_titulos_jdcial_impsto b
                       where b.id_ttlo_jdcial =
                             c_ttlos_jdcial.id_ttlo_jdcial);
            
              --eliminar impuestos
              delete from gf_g_titulos_jdcial_impsto b
               where b.id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
            
              --Eliminar los documentos generados de la tabla de asociacion de los documentos a los titulos judiciales
              delete from gf_g_ttls_jdcl_dcmnt_asccn
               where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
            
              delete from gf_g_ttls_jdcl_dcmnt_asccn
               where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial
                 and id_ttlo_jdcial_dcmnto in
                     (select id_ttlo_jdcial_dcmnto
                        from gf_g_titulos_jdcial_dcmnto);
            
              delete from gf_g_titulos_jdcial_dcmnto
               where id_ttlo_jdcial_dcmnto in
                     (select id_ttlo_jdcial_dcmnto
                        from gf_g_ttls_jdcl_dcmnt_asccn
                       where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial
                         and id_ttlo_jdcial_dcmnto in
                             (select id_ttlo_jdcial_dcmnto
                                from gf_g_titulos_jdcial_dcmnto));
            
              delete from gf_g_ttls_jdcl_impsto_dcmnt
               where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
            
              --eliminar las instancias de transicion
              delete wf_g_instancias_transicion a
               where a.id_instncia_fljo = v_id_instncia_fljo;
            
              --Se actualiza el estado del Titulo a estado inicial o registrado
              update gf_g_titulos_judicial
                 set Id_Instncia_Fljo              = null,
                     cdgo_ttlo_jdcial_estdo_incial = null,
                     cdgo_ttlo_jdcial_estdo        = 'RGS'
               where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
            end if;
          
            o_cdgo_rspsta  := 0;
            o_mnsje_rspsta := o_mnsje_rspsta ||
                              'Se finalizo el proceso exitosamente';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  1);
          end if;
        
        end;
      
      exception
        when no_data_found then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := 'Error al encontrar datos de solicitud de modificacion. Error: ' ||
                            o_cdgo_rspsta || ' - ' || o_mnsje_rspsta;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
    end loop;
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
    
  end prc_tr_fnlzar_fljo_ttlo_jdcial;

  procedure prc_fnlza_fljo_tsldo(p_id_instncia_fljo in number,
                                 p_cdgo_clnte       in number,
                                 p_id_usrio         in number,
                                 o_cdgo_rspsta      out number,
                                 o_mnsje_rspsta     out varchar2) as
  
    v_count        number;
    v_error        exception;
    v_nmbre_up     varchar2(200) := 'pkg_gf_titulos_judicial.prc_fnlza_fljo_tsldo';
    v_nl           number;
    v_id_fljo_trea wf_d_flujos_tarea.id_fljo_trea%type;
  
  begin
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entro a ' || v_nmbre_up || ' , ' || systimestamp,
                          6);
  
    begin
      select count(*)
        into v_count
        from gf_g_titulos_judicial a
       where a.id_instncia_fljo = p_id_instncia_fljo
         and a.cdgo_ttlo_jdcial_estdo = 'TRO';
    exception
      when others then
        v_count        := 0;
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error - ' || o_cdgo_rspsta ||
                          ' No se encontraron titulos para traslado';
        raise v_error;
    end;
  
    for ttlos_trea in (select b.id_instncia_trnscion,
                              a.id_instncia_fljo,
                              b.id_fljo_trea_orgen
                         from gf_g_titulos_judicial a
                         join wf_g_instancias_transicion b
                           on a.id_instncia_fljo = b.id_instncia_fljo
                          and b.id_estdo_trnscion in (1, 2)
                        where a.id_instncia_fljo = p_id_instncia_fljo) loop
      begin
        update wf_g_instancias_transicion t
           set t.id_estdo_trnscion = 3
         where t.id_instncia_trnscion = ttlos_trea.id_instncia_trnscion
           and t.id_instncia_fljo = p_id_instncia_fljo;
      
      exception
        when others then
          o_cdgo_rspsta  := 2;
          o_mnsje_rspsta := 'Error - ' || o_cdgo_rspsta ||
                            ' No fue posible actualizar el estado de la instancia';
          raise v_error;
      end;
    end loop;
  
    begin
      select a.id_fljo_trea
        into v_id_fljo_trea
        from v_wf_d_flujos_tarea a
        join wf_g_instancias_flujo b
          on b.id_fljo = a.id_fljo
       where b.id_instncia_fljo = p_id_instncia_fljo
         and upper(a.nmbre_trea) = upper('Finalizacin');
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error - ' || o_cdgo_rspsta ||
                          ' No se encontr el id_fljo_trea_orgen. ' ||
                          sqlcode || ' ' || sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' - ' || sqlerrm,
                              6);
        raise v_error;
    end;
  
    if v_count > 0 then
      begin
        insert into wf_g_instancias_transicion
          (id_instncia_fljo,
           id_fljo_trea_orgen,
           fcha_incio,
           fcha_fin_plnda,
           fcha_fin_optma,
           fcha_fin_real,
           id_usrio,
           id_estdo_trnscion)
        values
          (p_id_instncia_fljo,
           v_id_fljo_trea,
           systimestamp,
           systimestamp,
           systimestamp,
           systimestamp,
           p_id_usrio,
           3);
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error - ' || o_cdgo_rspsta ||
                            ' Al insertar la instancia transicion';
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' - ' || sqlerrm,
                                6);
      end;
      o_cdgo_rspsta  := 0;
      o_mnsje_rspsta := 'Flujo Finalizado con exito';
      commit;
    end if;
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta || ' - ' || sqlerrm,
                            6);
      rollback;
    
  end prc_fnlza_fljo_tsldo;

  function fnc_ca_saldo_medida_cautelar(p_cdgo_clnte        in number,
                                        p_id_embrgo_rslcion in number,
                                        p_vlor_ttlo         in number)
    return number as
  
    ----------------------------------------------------------------------------
    --&Funcion calcula saldo de medida cautelar consumida por titulo judicial&--
    ----------------------------------------------------------------------------
  
    v_ttal_ttlo       number;
    v_vlor_mdda_ctlar number;
    v_vlor_sldo       number := 0;
  
  begin
  
    --1. valor de la medida cautelar
    begin
    
      select vlor_mdda_ctlar
        into v_vlor_mdda_ctlar
        from mc_g_embargos_cartera a
        join mc_g_embargos_resolucion b
          on a.id_embrgos_crtra = b.id_embrgos_crtra
       where cdgo_clnte = p_cdgo_clnte
         and id_embrgos_rslcion = p_id_embrgo_rslcion;
    
    exception
      when no_data_found then
        v_vlor_mdda_ctlar := 0;
    end;
  
    --2. valor total de titulos
    begin
    
      select sum(vlor)
        into v_ttal_ttlo
        from gf_g_titulos_judicial
       where cdgo_clnte = p_cdgo_clnte
         and id_embrgo_rslcion = p_id_embrgo_rslcion
       group by id_embrgo_rslcion;
    
    exception
      when no_data_found then
        v_ttal_ttlo := 0;
    end;
  
    --v_vlor_sldo := (v_vlor_mdda_ctlar - v_ttal_ttlo - p_vlor_ttlo);
    v_vlor_sldo := (p_vlor_ttlo - v_vlor_mdda_ctlar);
  
    return v_vlor_sldo;
  
  end fnc_ca_saldo_medida_cautelar;

  function fnc_co_existe_medida_cautelar(p_cdgo_clnte        in number,
                                         p_id_embrgo_rslcion in number)
    return varchar2 as
  
    -------------------------------------------------------
    --&Funcion consulta la medida cautelar sigue vigente&--
    -------------------------------------------------------
  
    v_exste varchar2(1);
  
  begin
  
    begin
      select 'S'
        into v_exste
        from v_mc_g_embargos_resolucion
       where cdgo_clnte = p_cdgo_clnte
         and id_embrgos_rslcion = p_id_embrgo_rslcion
         and cdgo_estdos_crtra = 'E';
    
    exception
      when no_data_found then
        v_exste := 'N';
    end;
  
    return v_exste;
  
  end fnc_co_existe_medida_cautelar;

  function fnc_co_existe_crtra_impsto_mc(p_xml in clob) return varchar2 as
  
    -------------------------------------------------------------------------------------
    --&Funcion consulta si existe cartera con tributo(s) generador(es) titulo judicial&--
    -------------------------------------------------------------------------------------
  
    v_cntdad number;
    v_exste  varchar2(1);
  
  begin
  
    select count(*) cntdad
      into v_cntdad
      from v_gf_g_cartera_x_vigencia a
      join (select a.id_impsto, b.id_embrgo_rslcion, a.id_sjto_impsto
              from gf_g_titulos_jdcial_impsto a
              join gf_g_titulos_judicial b
                on a.id_ttlo_jdcial = b.id_ttlo_jdcial
             where b.cdgo_clnte = json_value(p_xml, '$.cdgo_clnte')
               and b.id_embrgo_rslcion =
                   json_value(p_xml, '$.id_embrgo_rslcion')
             group by a.id_impsto, b.id_embrgo_rslcion, a.id_sjto_impsto) b
        on a.id_sjto_impsto = b.id_sjto_impsto
     where a.cdgo_clnte = json_value(p_xml, '$.cdgo_clnte')
       and a.cdgo_mvnt_fncro_estdo = 'NO'
       and a.vlor_sldo_cptal > 0;
  
    if v_cntdad = 0 then
      v_exste := 'N';
    else
      v_exste := 'S';
    end if;
  
    return v_exste;
  
  end fnc_co_existe_crtra_impsto_mc;

  function fnc_co_existe_cartera(p_xml in clob) return varchar2 as
  
    ----------------------------------------
    --&Funcion consulta si existe cartera&--
    ----------------------------------------
  
    v_exste             varchar2(1);
    v_idntfccion_dmnddo gf_g_titulos_judicial.idntfccion_dmnddo%type;
  
  begin
    --1. se consulta la identificacion del contribuyente
    begin
      select idntfccion_dmnddo
        into v_idntfccion_dmnddo
        from gf_g_titulos_judicial
       where cdgo_clnte = json_value(p_xml, '$.cdgo_clnte')
         and id_ttlo_jdcial = json_value(p_xml, '$.id_ttlo_jdcial');
    exception
      when no_data_found then
        null;
    end;
  
    --2. Valida la existencia de la cartera
    begin
      select 'S'
        into v_exste
        from (select b.id_sjto_impsto, count(*) cntdad
                from v_gf_g_cartera_x_vigencia a
                join (select a.id_sjto_impsto
                       from si_i_sujetos_responsable a
                       left join gf_g_titulos_jdcial_impsto b
                         on a.id_sjto_rspnsble = b.id_sjto_rspnsble
                      where trim(idntfccion) = v_idntfccion_dmnddo
                      group by b.id_sjto_rspnsble, a.id_sjto_impsto) b
                  on a.id_sjto_impsto = b.id_sjto_impsto
               where a.cdgo_clnte = json_value(p_xml, '$.cdgo_clnte')
                 and a.vlor_sldo_cptal > 0
                 and a.cdgo_mvnt_fncro_estdo = 'NO'
               group by b.id_sjto_impsto)
       where cntdad > 0;
    exception
      when no_data_found then
        v_exste := 'N';
    end;
  
    return v_exste;
  
  end fnc_co_existe_cartera;

  /*function fnc_co_existe_medida_cautelar(p_xml  in clob) return varchar2 as
  
  v_exste         varchar2(1);
  
  begin
  
    v_exste:= pkg_gf_titulos_judicial.fnc_co_existe_medida_cautelar(p_cdgo_clnte    =>  json_value(p_xml,'$.cdgo_clnte'),
                                    p_id_embrgo_rslcion =>  json_value(p_xml,'$.id_embrgo_rslcion')
                                    );
  
    return v_exste;
  
  end fnc_co_existe_medida_cautelar;*/

  PROCEDURE prc_rg_documento_ttlo_jdcial(p_cdgo_clnte                  IN NUMBER,
                                         p_json_slctud_ttlos           IN CLOB,
                                         p_cdgo_ttlo_jdcial_slctud_tpo IN VARCHAR2 DEFAULT NULL,
                                         p_id_plntlla                  IN NUMBER,
                                         p_dcmnto                      IN CLOB,
                                         --p_request                   IN VARCHAR2,
                                         p_id_usrio              IN NUMBER,
                                         p_id_ttlo_jdcial        IN NUMBER default null,
                                         p_json_ttlos            in clob default null,
                                         o_id_ttlo_jdcial_dcmnto OUT NUMBER,
                                         o_cdgo_rspsta           OUT NUMBER,
                                         o_mnsje_rspsta          OUT VARCHAR2) AS
    --------------------------------------------------------------------
    ---&Procedimiento para gestionar el documento de plantilla actos&---
    --------------------------------------------------------------------
  
    v_id_rprte              number;
    v_error                 exception;
    v_nl                    number;
    v_id_ttlo_jdcial_dcmnto number;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_documento_ttlo_jdcial';
    v_id_ttlo_jdcial_slctud number;
    v_id_acto_tpo           number;
  
  BEGIN
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. Se consulta el reporte asociado al oficio de solicitud de devolucion
    begin
      select a.id_rprte, a.id_acto_tpo
        into v_id_rprte, v_id_acto_tpo
        from gn_d_plantillas a
       where a.cdgo_clnte = p_cdgo_clnte
         and a.id_plntlla = p_id_plntlla;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'No se enontro el reporte asociado a la plantilla, Codigo Error' ||
                          o_cdgo_rspsta;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
        return;
    end;
  
    --if p_request = 'CREATE' then
    begin
      insert into gf_g_titulos_jdcial_dcmnto
        (id_plntlla, id_acto_tpo, id_rprte, dcmnto)
      values
        (p_id_plntlla, v_id_acto_tpo, v_id_rprte, p_dcmnto)
      returning id_ttlo_jdcial_dcmnto into o_id_ttlo_jdcial_dcmnto;
    
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error, hace falta parametros para la insercion, Codigo Error' ||
                          o_cdgo_rspsta || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    --end if;
  
    /*for c_ttlos_jdcial_slctud in (select a.id_ttlo_jdcial_slctud
      from gf_g_titulos_jdcial_slctud a
      join (select id_ttlo_jdcial_slctud
      from json_table(p_json_slctud_ttlos, '$[*]' columns (id_ttlo_jdcial_slctud varchar2 path '$.ID_TTLO_JDCIAL_SLCTUD'))
      ) b on a.id_ttlo_jdcial_slctud = b.id_ttlo_jdcial_slctud)
    loop */
  
    --2. Validacion de peticion en el proceso de crear y atualizar
    begin
    
      /*select a.id_ttlo_jdcial_dcmnto, c.id_ttlo_jdcial_slctud
       into v_id_ttlo_jdcial_dcmnto, v_id_ttlo_jdcial_slctud
       from gf_g_ttlos_jdcl_dcmnt_slctd a
       join gf_g_titulos_jdcial_dcmnto b on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
       join gf_g_titulos_jdcial_slctud c on a.id_ttlo_jdcial_slctud = c.id_ttlo_jdcial_slctud
      where a.id_ttlo_jdcial_slctud = (select id_ttlo_jdcial_slctud
                       from json_table(p_json_slctud_ttlos, '$[*]'
                           columns (id_ttlo_jdcial_slctud varchar2 path '$.ID_TTLO_JDCIAL_SLCTUD')))--c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud
        and b.id_plntlla = p_id_plntlla
        and c.cdgo_ttlo_jdcial_slctud_tpo = p_cdgo_ttlo_jdcial_slctud_tpo;*/
      select a.id_ttlo_jdcial_dcmnto, a.id_ttlo_jdcial_slctud
        into v_id_ttlo_jdcial_dcmnto, v_id_ttlo_jdcial_slctud
        from gf_g_ttlos_jdcl_dcmnt_slctd a
        join gf_g_titulos_jdcial_dcmnto b
          on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
        join gf_g_titulos_jdcial_slctud c
          on a.id_ttlo_jdcial_slctud = c.id_ttlo_jdcial_slctud
       where c.id_ttlo_jdcial_slctud =
             (select id_ttlo_jdcial_slctud
                from json_table(p_json_slctud_ttlos,
                                '$[*]' columns(id_ttlo_jdcial_slctud varchar2 path
                                        '$.ID_TTLO_JDCIAL_SLCTUD'))) --c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud
         and c.cdgo_ttlo_jdcial_slctud_tpo = p_cdgo_ttlo_jdcial_slctud_tpo;
    exception
      when no_data_found then
        v_id_ttlo_jdcial_dcmnto := null;
        v_id_ttlo_jdcial_slctud := null;
    end;
  
    if p_cdgo_ttlo_jdcial_slctud_tpo in ('ASL', 'SDT') then
      --4. Insercion Detalle Documento
      begin
        insert into gf_g_ttlos_jdcl_dcmnt_slctd
          (id_ttlo_jdcial_slctud, id_ttlo_jdcial_dcmnto)
        values
          (json_value(p_json_slctud_ttlos, '$.ID_TTLO_JDCIAL_SLCTUD'), /*v_id_ttlo_jdcial_slctud*/
           o_id_ttlo_jdcial_dcmnto);
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error, hace falta parametros para la insercion del detalle de documento, Codigo Error' ||
                            o_cdgo_rspsta || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    end if;
    if p_json_ttlos is not null then
      for c_ttlos in (select id_ttlo_jdcial
                        from json_table(p_json_ttlos,
                                        '$[*]'
                                        columns(id_ttlo_jdcial varchar2 path
                                                '$.id_ttlo_jdcial'))) loop
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'id_ttlo_jdcial: ' || c_ttlos.id_ttlo_jdcial,
                              6);
        begin
          insert into gf_g_ttls_jdcl_dcmnt_asccn
            (id_ttlo_jdcial_dcmnto, id_ttlo_jdcial)
          values
            (o_id_ttlo_jdcial_dcmnto, c_ttlos.id_ttlo_jdcial);
        exception
          when others then
            o_cdgo_rspsta  := 4;
            o_mnsje_rspsta := 'Error, hace falta parametros para la insercion del detalle de documento, Codigo Error' ||
                              o_cdgo_rspsta || SQLERRM;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      end loop;
    end if;
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Documento Registrado!';
      commit;
    end if;
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
    
  END prc_rg_documento_ttlo_jdcial;

  PROCEDURE prc_ac_documento_ttlo_jdcial(p_cdgo_clnte                  IN NUMBER,
                                         p_json_slctud_ttlos           IN CLOB,
                                         p_cdgo_ttlo_jdcial_slctud_tpo IN VARCHAR2 DEFAULT NULL,
                                         --p_id_plntlla                IN NUMBER,
                                         p_dcmnto IN CLOB,
                                         --p_request                   IN VARCHAR2,
                                         p_id_usrio              IN NUMBER,
                                         p_id_ttlo_jdcial        IN NUMBER,
                                         p_id_ttlo_jdcial_dcmnto IN NUMBER,
                                         o_cdgo_rspsta           OUT NUMBER,
                                         o_mnsje_rspsta          OUT VARCHAR2) AS
    v_error                 exception;
    v_nl                    number;
    v_id_ttlo_jdcial_dcmnto number;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_documento_ttlo_jdcial';
    v_id_ttlo_jdcial_slctud number;
    -- Resto del codigo de actualizacion (UPDATE)
  BEGIN
  
    /*begin
    
      select a.id_ttlo_jdcial_dcmnto, c.id_ttlo_jdcial_slctud
        into v_id_ttlo_jdcial_dcmnto, v_id_ttlo_jdcial_slctud
        from gf_g_ttlos_jdcl_dcmnt_slctd a
        join gf_g_titulos_jdcial_dcmnto b on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
        join gf_g_titulos_jdcial_slctud c on a.id_ttlo_jdcial_slctud = c.id_ttlo_jdcial_slctud
       where a.id_ttlo_jdcial_slctud = (select id_ttlo_jdcial_slctud
                        from json_table(p_json_slctud_ttlos, '$[*]'
                            columns (id_ttlo_jdcial_slctud varchar2 path '$.ID_TTLO_JDCIAL_SLCTUD')))--c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud
         and b.id_plntlla = p_id_plntlla
         and c.cdgo_ttlo_jdcial_slctud_tpo = p_cdgo_ttlo_jdcial_slctud_tpo;
    exception
      when no_data_found then
        v_id_ttlo_jdcial_dcmnto := null;
        v_id_ttlo_jdcial_slctud := null;
    end;*/
  
    --if p_request = 'SAVE' then
    --5. Modificacion del Documento
    begin
      update gf_g_titulos_jdcial_dcmnto
         set dcmnto = p_dcmnto
       where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
    
    exception
      when others then
        o_cdgo_rspsta  := 5;
        o_mnsje_rspsta := 'Error, no se pudo realizar la actualizacion, Codigo Error' ||
                          o_cdgo_rspsta;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    --end if;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Documento Actualizado!';
      commit;
    end if;
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo ' || systimestamp,
                            6);
  END prc_ac_documento_ttlo_jdcial;

  PROCEDURE prc_el_documento_ttlo_jdcial(p_cdgo_clnte                  IN NUMBER,
                                         p_json_slctud_ttlos           IN CLOB,
                                         p_cdgo_ttlo_jdcial_slctud_tpo IN VARCHAR2 DEFAULT NULL,
                                         --p_id_plntlla                IN NUMBER,
                                         --p_dcmnto                    IN CLOB,
                                         --p_request                   IN VARCHAR2,
                                         p_id_usrio              IN NUMBER,
                                         p_id_ttlo_jdcial        IN NUMBER,
                                         p_id_ttlo_jdcial_dcmnto IN NUMBER,
                                         o_cdgo_rspsta           OUT NUMBER,
                                         o_mnsje_rspsta          OUT VARCHAR2) AS
    v_error                 exception;
    v_nl                    number;
    v_id_ttlo_jdcial_dcmnto number;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_el_documento_ttlo_jdcial';
    v_id_ttlo_jdcial_slctud number;
    -- Resto del codigo de eliminacion (DELETE)
  BEGIN
  
    begin
      select --a.id_ttlo_jdcial_dcmnto,
       c.id_ttlo_jdcial_slctud
        into --v_id_ttlo_jdcial_dcmnto,
             v_id_ttlo_jdcial_slctud
        from gf_g_ttlos_jdcl_dcmnt_slctd a
        join gf_g_titulos_jdcial_dcmnto b
          on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
        join gf_g_titulos_jdcial_slctud c
          on a.id_ttlo_jdcial_slctud = c.id_ttlo_jdcial_slctud
       where a.id_ttlo_jdcial_slctud =
             (select id_ttlo_jdcial_slctud
                from json_table(p_json_slctud_ttlos,
                                '$[*]' columns(id_ttlo_jdcial_slctud varchar2 path
                                        '$.ID_TTLO_JDCIAL_SLCTUD'))) --c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud
            --and b.id_plntlla = p_id_plntlla
         and c.cdgo_ttlo_jdcial_slctud_tpo = p_cdgo_ttlo_jdcial_slctud_tpo;
    exception
      when no_data_found then
        v_id_ttlo_jdcial_dcmnto := null;
        v_id_ttlo_jdcial_slctud := null;
    end;
  
    --if p_request = 'DELETE' then
    begin
      delete gf_g_ttls_jdcl_dcmnt_asccn
       where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
    exception
      when others then
        o_cdgo_rspsta  := 6;
        o_mnsje_rspsta := 'Error, No se pudo eliminar registro, Codigo Error' ||
                          o_cdgo_rspsta;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
    if p_cdgo_ttlo_jdcial_slctud_tpo = 'SDT' then
      -- 7. Eliminacion del Detalle del Documento
      begin
        delete gf_g_ttlos_jdcl_dcmnt_slctd
         where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
      exception
        when others then
          o_cdgo_rspsta  := 6;
          o_mnsje_rspsta := 'Error, No se pudo eliminar registro, Codigo Error' ||
                            o_cdgo_rspsta;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      --8. Eliminacion del Solicitud Detalle
      begin
        delete gf_g_ttlos_jdcl_slctd_dtll
         where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud; --c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud;
      exception
        when others then
          o_cdgo_rspsta  := 8;
          o_mnsje_rspsta := 'Error, No se pudo eliminar detalle solicitud, Codigo Error' ||
                            o_cdgo_rspsta;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      --9. Eliminacion del Solicitud
      begin
        delete gf_g_titulos_jdcial_slctud
         where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud; --c_ttlos_jdcial_slctud.id_ttlo_jdcial_slctud;
      exception
        when others then
          o_cdgo_rspsta  := 8;
          o_mnsje_rspsta := 'Error, No se pudo eliminar solicitud, Codigo Error' ||
                            o_cdgo_rspsta;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    end if;
    --6. Eliminacion del Documento
    begin
      delete gf_g_titulos_jdcial_dcmnto
       where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
    exception
      when others then
        o_cdgo_rspsta  := 7;
        o_mnsje_rspsta := 'Error, No se pudo eliminar registro, Codigo Error' ||
                          o_cdgo_rspsta;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --end if;
    --end loop;
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Documento Eliminado!';
      commit;
    end if;
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  END prc_el_documento_ttlo_jdcial;

  procedure prc_rg_acto_ttlo_jdcial(p_cdgo_clnte             in number,
                                    p_id_ttlo_jdcial         in number,
                                    p_id_ttlo_jdcial_dcmnto  in number,
                                    p_id_usrio               in number,
                                    p_id_plntlla             in number,
                                    p_cdgo_ttlo_jdcial_estdo in varchar2 default null,
                                    p_obsrvcion_estdo        in varchar2 default null,
                                    p_json_ttlos             in clob default null,
                                    o_id_acto                out number,
                                    o_cdgo_rspsta            out number,
                                    o_mnsje_rspsta           out varchar2) as
  
    ------------------------------------------------------------------
    --&procedimiento registro de acto titulo judicial&--
    ------------------------------------------------------------------
  
    v_error                 exception;
    v_nl                    number;
    v_id_instncia_fljo_hjo  number;
    v_id_fljo_trea_orgen    number;
    v_type_rspsta           varchar2(1);
    v_error_msg             number;
    v_id_ttlo_jdcial_slctud number;
    v_id_acto_tpo           number;
    v_cdgo_acto_tpo         gn_d_actos_tipo.cdgo_acto_tpo%type;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_acto_ttlo_jdcial';
  
  begin
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. Consultamos el tipo de acto
    begin
      select b.id_acto_tpo, b.cdgo_acto_tpo
        into v_id_acto_tpo, v_cdgo_acto_tpo
        from gn_d_plantillas a
        join gn_d_actos_tipo b
          on a.id_acto_tpo = b.id_acto_tpo
       where b.cdgo_clnte = p_cdgo_clnte
         and a.id_plntlla = p_id_plntlla;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error al encontrar el tipo de acto. Error No. ' ||
                          o_cdgo_rspsta || SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --2. generan acto de devolucion de titulo judicial
    begin
    
      pkg_gf_titulos_judicial.prc_gn_acto_ttlo_jdcial(p_cdgo_clnte     => p_cdgo_clnte,
                                                      p_id_ttlo_jdcial => p_id_ttlo_jdcial,
                                                      p_cdgo_acto_tpo  => v_cdgo_acto_tpo,
                                                      p_cdgo_cnsctvo   => v_cdgo_acto_tpo, --'TJP',
                                                      p_id_usrio       => p_id_usrio,
                                                      o_id_acto        => o_id_acto,
                                                      o_cdgo_rspsta    => o_cdgo_rspsta,
                                                      o_mnsje_rspsta   => o_mnsje_rspsta);
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error Generar el oficio de solicitud de devolucion. Error: ' ||
                          o_cdgo_rspsta || o_mnsje_rspsta || ' - ' ||
                          SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
  
    -- valida si el acto fue registrado
    if o_id_acto is not null then
    
      --3. actualizacion tabla documentos de titulos
      begin
        update gf_g_titulos_jdcial_dcmnto
           set id_acto = o_id_acto
        --,id_acto_tpo = v_id_acto_tpo
        --,indcdor_acto_cnfrmcion = 'S'
         where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto;
      
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error al actualizar el documento del acto de la solicitud. Error:' ||
                            SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      --4. Generacion de reporte y actualizacion de acto
      begin
        pkg_gf_titulos_judicial.prc_gn_rprte_ttlo_jdcial_slctd(p_cdgo_clnte            => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_dcmnto => p_id_ttlo_jdcial_dcmnto,
                                                               p_cdgo_acto_tpo         => v_cdgo_acto_tpo,
                                                               p_id_plntlla            => p_id_plntlla,
                                                               p_id_acto               => o_id_acto,
                                                               o_cdgo_rspsta           => o_cdgo_rspsta,
                                                               o_mnsje_rspsta          => o_mnsje_rspsta);
        if o_cdgo_rspsta != 0 then
          o_cdgo_rspsta  := 3;
          o_mnsje_rspsta := 'Error al registrar el blob. Error No. ' ||
                            o_cdgo_rspsta || o_mnsje_rspsta || SQLCODE ||
                            ' - ' || SQLERRM;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
        end if;
      
      end;
    
      --Se recorren las solicitudes asociadas al documento
      /*for c_ttlo_jdcial_slctud in (select id_ttlo_jdcial_slctud
                                     from gf_g_ttlos_jdcl_dcmnt_slctd
                                    where id_ttlo_jdcial_dcmnto = p_id_ttlo_jdcial_dcmnto
                                   )loop
      
              --5. actualizacion confirmacion solicitud
              begin
                  update gf_g_titulos_jdcial_slctud
                     set indcdor_slctud_cnfrmcion = 'S', fcha_rspsta = sysdate
                   where id_ttlo_jdcial_slctud = c_ttlo_jdcial_slctud.id_ttlo_jdcial_slctud;
      
              exception
                  when others then
                      o_cdgo_rspsta := 5;
                      o_mnsje_rspsta := 'Error al actualizar el documento del acto de la solicitud. Error:' || SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
                      pkg_sg_log.prc_rg_log( p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                      raise v_error;
              end;
      
      end loop;*/
    
      --Se recorren los titulos judiciales para actualizacion y finalizacion de flujo
      for c_ttlo_jdcial in (select a.id_ttlo_jdcial,
                                   a.cdgo_ttlo_jdcial_estdo
                              from gf_g_titulos_judicial a
                             where a.id_ttlo_jdcial = p_id_ttlo_jdcial) loop
        if c_ttlo_jdcial.cdgo_ttlo_jdcial_estdo <> 'CNS' then
          --7. actualizacion estado del titulo
          begin
            update gf_g_titulos_judicial
               set cdgo_ttlo_jdcial_estdo = p_cdgo_ttlo_jdcial_estdo
             where cdgo_clnte = p_cdgo_clnte
               and id_ttlo_jdcial = c_ttlo_jdcial.id_ttlo_jdcial;
          
          exception
            when others then
              o_cdgo_rspsta  := 7;
              o_mnsje_rspsta := 'Error al actualizar el estado del titulo judicial. Error:' ||
                                SQLCODE || o_cdgo_rspsta || ' - ' ||
                                SQLERRM;
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta,
                                    6);
              raise v_error;
          end;
        end if;
        --8. Registro de traza de titulos judiciales
        begin
          pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                       p_id_ttlo_jdcial         => c_ttlo_jdcial.id_ttlo_jdcial,
                                                       p_cdgo_ttlo_jdcial_estdo => p_cdgo_ttlo_jdcial_estdo,
                                                       p_obsrvcion              => p_obsrvcion_estdo,
                                                       p_id_usrio               => p_id_usrio,
                                                       p_indcdor_rqre_aprbccion => 'N',
                                                       o_cdgo_rspsta            => o_cdgo_rspsta,
                                                       o_mnsje_rspsta           => o_mnsje_rspsta);
          if o_cdgo_rspsta != 0 then
            o_cdgo_rspsta  := 8;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al registrar traza de titulo judicial' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
          end if;
        end;
      
      /*begin
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      select a.id_instncia_fljo_hjo,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b.id_fljo_trea_orgen
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          into v_id_instncia_fljo_hjo,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               v_id_fljo_trea_orgen
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          from gf_g_titulos_judicial a
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          join wf_g_instancias_transicion b on a.id_instncia_fljo_hjo = b.id_instncia_fljo
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            and b.id_estdo_trnscion in (1,2)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          where id_ttlo_jdcial = c_ttlo_jdcial.id_ttlo_jdcial;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               p_id_fljo_trea   => v_id_fljo_trea_orgen,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               p_json       => '[]' ,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_type       => v_type_rspsta,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_mnsje      => o_mnsje_rspsta,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_id_fljo_trea   => v_fljo_trea,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               o_error      => v_error_msg);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           if v_type_rspsta = 'S' then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              o_cdgo_rspsta := 3;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al trasitar a la etapa siguiente'||sqlerrm;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              raise v_error;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           end if;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  end;*/
      
      end loop;
      if p_cdgo_ttlo_jdcial_estdo = 'CYD' then
        for c_ttlos_cyd in (select id_ttlo_jdcial, cdgo_ttlo_jdcial_estdo
                              from json_table(p_json_ttlos,
                                              '$[*]'
                                              columns(id_ttlo_jdcial varchar2 path
                                                      '$.id_ttlo_jdcial',
                                                      cdgo_ttlo_jdcial_estdo
                                                      varchar2 path
                                                      '$.cdgo_ttlo_jdcial_estdo'))) loop
          if c_ttlos_cyd.cdgo_ttlo_jdcial_estdo = 'ASL' then
            begin
              update gf_g_titulos_judicial
                 set cdgo_ttlo_jdcial_estdo = 'SDT'
               where id_ttlo_jdcial = c_ttlos_cyd.id_ttlo_jdcial;
            
            exception
              when others then
                o_cdgo_rspsta  := 7;
                o_mnsje_rspsta := 'Error al actualizar el estado del titulo judicial. Error:' ||
                                  SQLCODE || o_cdgo_rspsta || ' - ' ||
                                  SQLERRM;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      o_mnsje_rspsta,
                                      6);
                raise v_error;
            end;
            --8. Registro de traza de titulos judiciales
            begin
              pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                           p_id_ttlo_jdcial         => c_ttlos_cyd.id_ttlo_jdcial,
                                                           p_cdgo_ttlo_jdcial_estdo => 'SDT',
                                                           p_obsrvcion              => 'Solicitud de Devolucion',
                                                           p_id_usrio               => p_id_usrio,
                                                           p_indcdor_rqre_aprbccion => 'N',
                                                           o_cdgo_rspsta            => o_cdgo_rspsta,
                                                           o_mnsje_rspsta           => o_mnsje_rspsta);
              if o_cdgo_rspsta != 0 then
                o_cdgo_rspsta  := 8;
                o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                  'Error al registrar traza de titulo judicial' ||
                                  sqlerrm;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      o_mnsje_rspsta || ' , ' || sqlerrm,
                                      6);
                raise v_error;
              end if;
            end;
          elsif c_ttlos_cyd.cdgo_ttlo_jdcial_estdo = 'ACN' then
            begin
              update gf_g_titulos_judicial
                 set cdgo_ttlo_jdcial_estdo = 'CNS'
               where id_ttlo_jdcial = c_ttlos_cyd.id_ttlo_jdcial;
            
            exception
              when others then
                o_cdgo_rspsta  := 7;
                o_mnsje_rspsta := 'Error al actualizar el estado del titulo judicial. Error:' ||
                                  SQLCODE || o_cdgo_rspsta || ' - ' ||
                                  SQLERRM;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      o_mnsje_rspsta,
                                      6);
                raise v_error;
            end;
            --8. Registro de traza de titulos judiciales
            begin
              pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                           p_id_ttlo_jdcial         => c_ttlos_cyd.id_ttlo_jdcial,
                                                           p_cdgo_ttlo_jdcial_estdo => 'CNS',
                                                           p_obsrvcion              => 'Enviado a Consignar',
                                                           p_id_usrio               => p_id_usrio,
                                                           p_indcdor_rqre_aprbccion => 'N',
                                                           o_cdgo_rspsta            => o_cdgo_rspsta,
                                                           o_mnsje_rspsta           => o_mnsje_rspsta);
              if o_cdgo_rspsta != 0 then
                o_cdgo_rspsta  := 8;
                o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                  'Error al registrar traza de titulo judicial' ||
                                  sqlerrm;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      o_mnsje_rspsta || ' , ' || sqlerrm,
                                      6);
                raise v_error;
              end if;
            end;
          end if;
        end loop;
      end if;
    end if;
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Acto Generado Satisfactoriamente!';
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20001, o_mnsje_rspsta);
  end prc_rg_acto_ttlo_jdcial;

  procedure prc_gn_acto_ttlo_jdcial(p_cdgo_clnte     in number,
                                    p_id_ttlo_jdcial in number,
                                    p_cdgo_acto_tpo  in varchar2,
                                    p_cdgo_cnsctvo   in varchar2,
                                    p_id_usrio       in number,
                                    o_id_acto        out number,
                                    o_cdgo_rspsta    out number,
                                    o_mnsje_rspsta   out varchar2) as
  
    ------------------------------------------------------------------
    ---&Procedimiento para generar el acto de solicitud de titulos&---
    ------------------------------------------------------------------
  
    v_error                 exception;
    v_nl                    number;
    v_slct_sjto_impsto      clob;
    v_slct_vngcias          clob;
    v_slct_rspnsble         clob;
    v_id_acto_tpo           number;
    v_json_acto             clob;
    v_vlor                  number;
    v_id_ttlo_jdcial_slctud number;
    v_json                  clob;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_gn_acto_ttlo_jdcial';
  
  begin
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando ' || systimestamp,
                          6);
    --v_json := ''''||p_json_ttlos || ''',''$[*]'' columns (id_ttlo_jdcial varchar2 path ''$.ID_TTLO_JDCIAL'')';
  
    -- select para obtener los datos del sujeto impuesto
    v_slct_sjto_impsto := 'select c.id_impsto_sbmpsto
                                       ,c.id_sjto_impsto
                                from gf_g_titulos_jdcial_impsto c
                                where c.id_ttlo_jdcial = ' ||
                          p_id_ttlo_jdcial;
  
    -- select para obtener las vigencias y los periodos
    v_slct_vngcias := ' select c.id_sjto_impsto,
                  d.vgncia,
                  d.id_prdo,
                                    0 as vlor_cptal,
                                    0 as vlor_intres
                from gf_g_titulos_jdcial_impsto c
                join gf_g_titulos_jdcial_vgncia d on c.id_ttlo_jdcial_impsto = d.id_ttlo_jdcial_impsto
                where c.id_ttlo_jdcial = ' ||
                      p_id_ttlo_jdcial;
  
    -- select para obtener los responsables de un acto
    v_slct_rspnsble := 'select d.cdgo_idntfccion_tpo,
                   d.nmro_idntfccion  idntfccion,
                   d.prmer_nmbre,
                   d.sgndo_nmbre,
                   d.prmer_aplldo,
                   d.sgndo_aplldo,
                   d.drccion          drccion_ntfccion,
                   d.id_pais          id_pais_ntfccion,
                   d.id_dprtmnto      id_dprtmnto_ntfccion,
                   d.id_mncpio        id_mncpio_ntfccion,
                   null email,
                   null tlfno
                from gf_g_titulos_jdcial_impsto c
                join v_si_i_sujetos_responsable d on c.id_sjto_rspnsble = d.id_sjto_rspnsble
                where c.id_ttlo_jdcial = ' ||
                       p_id_ttlo_jdcial;
  
    -- 1. Se consulta el total de la solicitud
    begin
    
      select sum(a.vlor)
        into v_vlor
        from gf_g_titulos_judicial a
       where a.id_ttlo_jdcial = p_id_ttlo_jdcial;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No.' || o_cdgo_rspsta ||
                          'No se encontro el valor del acto.' || SQLCODE ||
                          ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    -- 2. Consulta el id del tipo del acto
    begin
      select id_acto_tpo
        into v_id_acto_tpo
        from gn_d_actos_tipo
       where cdgo_clnte = p_cdgo_clnte
         and cdgo_acto_tpo = p_cdgo_acto_tpo;
    
    exception
      when no_data_found then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No.' || o_cdgo_rspsta ||
                          'al encontrar el tipo de acto' || SQLCODE ||
                          ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    -- 3. Generacion del json para el Acto
    begin
    
      v_json_acto := pkg_gn_generalidades.fnc_cl_json_acto(p_cdgo_clnte          => p_cdgo_clnte,
                                                           p_cdgo_acto_orgen     => 'TJP',
                                                           p_id_orgen            => p_id_ttlo_jdcial,
                                                           p_id_undad_prdctra    => p_id_ttlo_jdcial,
                                                           p_id_acto_tpo         => v_id_acto_tpo,
                                                           p_acto_vlor_ttal      => nvl(v_vlor,
                                                                                        0),
                                                           p_cdgo_cnsctvo        => p_cdgo_cnsctvo,
                                                           p_id_acto_rqrdo_hjo   => null,
                                                           p_id_acto_rqrdo_pdre  => null,
                                                           p_fcha_incio_ntfccion => sysdate,
                                                           p_id_usrio            => p_id_usrio /*,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           p_slct_sjto_impsto  => v_slct_sjto_impsto,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           p_slct_vgncias    => v_slct_vngcias,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           p_slct_rspnsble   => v_slct_rspnsble*/);
    
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No.' || o_cdgo_rspsta ||
                          ' al Generar el json para el acto. Error: ' ||
                          SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
  
    -- 4. Generacion del Acto
    begin
      pkg_gn_generalidades.prc_rg_acto(p_cdgo_clnte   => p_cdgo_clnte,
                                       p_json_acto    => v_json_acto,
                                       o_id_acto      => o_id_acto,
                                       o_cdgo_rspsta  => o_cdgo_rspsta,
                                       o_mnsje_rspsta => o_mnsje_rspsta);
    
      if o_cdgo_rspsta != 0 then
        o_cdgo_rspsta  := 4;
        o_mnsje_rspsta := 'Error: ' || o_cdgo_rspsta || ' - ' ||
                          o_mnsje_rspsta || SQLCODE || ' - ' || SQLERRM;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo ' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  end prc_gn_acto_ttlo_jdcial;

  procedure prc_ac_instncia_titulo(p_cdgo_clnte       in number,
                                   p_id_usrio         in number,
                                   p_json_ttlos       in clob,
                                   p_id_instncia_fljo in number,
                                   o_cdgo_rspsta      out number,
                                   o_mnsje_rspsta     out varchar2) as
  
    v_nl               number;
    v_nmbre_up         varchar2(200) := 'pkg_gf_titulos_judicial.prc_ac_instncia_titulo';
    v_error            exception;
    v_nmro_ttlo_jdcial gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_obsrvcion        varchar2(100);
    v_idntfccion       varchar2(100);
    v_estdo_ttlo       varchar2(100);
    v_idntfccion_json  number;
  
    v_fra        number := 0;
    v_otras      number := 0;
    v_trs        number := 0;
    v_rch        number := 0;
    v_cdgo_error number := 0;
    v_msje_error varchar2(500);
  
  begin
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    --consulta identificacion existe en el flujo
    begin
      select a.idntfccion_dmnddo --, a.cdgo_ttlo_jdcial_estdo
        into v_idntfccion --, v_estdo_ttlo
        from gf_g_titulos_judicial a
       where a.id_instncia_fljo = p_id_instncia_fljo
         and rownum = 1;
    exception
      when no_data_found then
        v_idntfccion := null;
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Problemas al consultar identificacion.';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        --raise v_error;
    end;
    begin
      select --id_ttlo_jdcial,
      --cdgo_ttlo_jdcial_estdo,
       idntfccion
        into v_idntfccion_json
        from json_table(p_json_ttlos,
                        '$[*]' columns(id_ttlo_jdcial varchar2 path
                                '$.ID_TTLO_JDCIAL',
                                cdgo_ttlo_jdcial_estdo varchar2 path
                                '$.ACCION',
                                idntfccion varchar2 path
                                '$.IDNTFCCION_DMNDDO'))
       where rownum = 1;
    exception
      when no_data_found then
        v_idntfccion_json := null;
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Problemas al consultar identificacion del JSON.';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        --raise v_error;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'json lleno:' || p_json_ttlos,
                          6);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'antes de loop v_idntfccion: ' || v_idntfccion,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'antes de loop v_idntfccion_json: ' ||
                          v_idntfccion_json,
                          6);
  
    -- validacion de las combinaciones de accion
    for c_ttlos in (select distinct (cdgo_ttlo_jdcial_estdo) as cdgo_ttlo_jdcial_estdo
                      from json_table(p_json_ttlos,
                                      '$[*]' columns(id_ttlo_jdcial varchar2 path
                                              '$.ID_TTLO_JDCIAL',
                                              cdgo_ttlo_jdcial_estdo
                                              varchar2 path '$.ACCION',
                                              idntfccion varchar2 path
                                              '$.IDNTFCCION_DMNDDO'))) loop
    
      if (fnc_vl_accion_ttlo(p_id_instncia_fljo,
                             c_ttlos.cdgo_ttlo_jdcial_estdo) = 'N') then
        o_cdgo_rspsta  := 10;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Estas acciones no se pueden combinar';
        raise v_error;
      
      end if;
    
      if c_ttlos.cdgo_ttlo_jdcial_estdo is not null then
        if c_ttlos.cdgo_ttlo_jdcial_estdo = 'FRC' then
          v_fra := v_fra + 1;
        elsif c_ttlos.cdgo_ttlo_jdcial_estdo = 'TRO' then
          v_trs := v_trs + 1;
        elsif c_ttlos.cdgo_ttlo_jdcial_estdo = 'RCH' then
          v_rch := v_rch + 1;
        else
          v_otras := v_otras + 1;
        end if;
      end if;
    
    end loop;
  
    if v_otras > 0 and ((v_rch > 0) or (v_trs > 0) or (v_fra > 0)) then
      o_cdgo_rspsta  := 9;
      o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                        ' Estas acciones no se pueden combinar';
      raise v_error;
    else
      v_cdgo_error := 0;
    end if;
  
    -- fin validacion de las combinaciones de accion             
  
    if v_idntfccion = v_idntfccion_json or v_idntfccion is null then
      for c_ttlos_jdcial in (select id_ttlo_jdcial,
                                    cdgo_ttlo_jdcial_estdo,
                                    idntfccion
                               from json_table(p_json_ttlos,
                                               '$[*]'
                                               columns(id_ttlo_jdcial
                                                       varchar2 path
                                                       '$.ID_TTLO_JDCIAL',
                                                       cdgo_ttlo_jdcial_estdo
                                                       varchar2 path
                                                       '$.ACCION',
                                                       idntfccion varchar2 path
                                                       '$.IDNTFCCION_DMNDDO'))) loop
        if c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo is null then
          o_cdgo_rspsta  := 2;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Escoger una accion para el Titulo seleccionado, por favor verifique y seleccione el titulo nuevamente.';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
        end if;
      
        --Se actualiza el campo cdgo_ttlo_jdcial_estdo
        begin
          update gf_g_titulos_judicial a
             set a.id_instncia_fljo              = p_id_instncia_fljo,
                 a.cdgo_ttlo_jdcial_estdo        = c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo,
                 a.cdgo_ttlo_jdcial_estdo_incial = c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo
           where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
        exception
          when others then
            o_cdgo_rspsta  := 3;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al actualizar el Titulo Judicial';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'Saliendo con exito de la Actualizacion del estado del titulo',
                              6);
      
        --Se registra la traza de estado de cada uno de los titulos
        begin
          begin
            select nmro_ttlo_jdcial
              into v_nmro_ttlo_jdcial
              from gf_g_titulos_judicial
             where cdgo_clnte = p_cdgo_clnte
               and id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
          end;
          if c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'CNS' then
            v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                           ' Apto para Consignacion';
          elsif c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'FRC' then
            v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                           ' Fraccionado';
          elsif c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'ASL' then
            v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                           ' Apto para Devolucion';
          elsif c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'RCH' then
            v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                           ' Rechazado';
          end if;
        
          pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                       p_id_ttlo_jdcial         => c_ttlos_jdcial.id_ttlo_jdcial,
                                                       p_cdgo_ttlo_jdcial_estdo => c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo,
                                                       p_obsrvcion              => v_obsrvcion,
                                                       p_id_usrio               => p_id_usrio,
                                                       o_cdgo_rspsta            => o_cdgo_rspsta,
                                                       o_mnsje_rspsta           => o_mnsje_rspsta);
        
          if o_cdgo_rspsta > 0 then
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_cdgo_rspsta || '-' || sqlerrm,
                                  6);
            raise v_error;
          end if;
        exception
          when others then
            o_cdgo_rspsta  := 4;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al llamar el procedimiento prc_rg_titulos_traza';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
        /*begin
            select a.idntfccion_dmnddo
            into v_idntfccion
            from gf_g_titulos_judicial a
            where a.id_instncia_fljo = p_id_instncia_fljo;
        exception
            when others then
                o_cdgo_rspsta := 5;
                o_mnsje_rspsta := o_cdgo_rspsta||' - '||'Problemas al consultar identificacion.';
                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                raise v_error;
        end;*/
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'dentro de loop v_idntfccion: ' ||
                              v_idntfccion,
                              6);
      end loop;
    else
      o_cdgo_rspsta  := 6;
      o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                        'Esta instancia ya tiene una identificacion asociada, para asociar una identificacion diferente debe instanciar un nuevo flujo.';
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      raise v_error;
    end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'fuera de loop v_idntfccion: ' || v_idntfccion,
                          6);
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := 'Titulo(s) actualizado(s) de manera exitosa';
      --raise v_error;
    end if;
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      rollback;
      -- raise_application_error(-20000, o_mnsje_rspsta);
  end prc_ac_instncia_titulo;

  procedure prc_ac_estdo_titulo(p_cdgo_clnte in number,
                                --p_id_ttlo_jdcial      in number,
                                --p_estdo                 in varchar2,
                                p_json_ttlos   in clob,
                                p_id_usrio     in number,
                                o_cdgo_rspsta  out number,
                                o_mnsje_rspsta out varchar2) as
  
    --------------------------------------------------------------
    --&procedimiento para actualizar la solicitud de devolucion&--
    --------------------------------------------------------------
    v_error                  exception;
    v_nl                     number;
    v_id_acto_tpo            number;
    v_cdgo_acto_tpo          gn_d_actos_tipo.cdgo_acto_tpo%type;
    v_fljo_trea              number;
    v_nmbre_up               varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_estdo_titulo';
    v_id_instncia_fljo_hjo   number;
    v_id_fljo_trea_orgen     number;
    v_type_rspsta            varchar2(1);
    v_error_msg              number;
    v_nmro_ttlo_jdcial       gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_cdgo_ttlo_jdcial_estdo varchar2(5);
    v_obsrvcion              varchar2(100);
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --1. actualizacion estado del titulo
    /*begin
    
        update gf_g_titulos_judicial
           set cdgo_ttlo_jdcial_estdo = p_estdo
         where cdgo_clnte = p_cdgo_clnte
           and id_ttlo_jdcial = p_id_ttlo_jdcial;
    
    exception
        when others then
            o_cdgo_rspsta :=5;
            o_mnsje_rspsta := 'Error al actualizar el estado del titulo judicial. Error:' || SQLCODE || o_cdgo_rspsta || ' - ' || SQLERRM;
            pkg_sg_log.prc_rg_log( p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
            raise v_error;
            rollback;
    end;
    
    commit;*/
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'JSON:' || p_json_ttlos,
                          6);
  
    for c_ttlos_jdcial in (select id_ttlo_jdcial, cdgo_ttlo_jdcial_estdo
                             from json_table(p_json_ttlos,
                                             '$[*]'
                                             columns(id_ttlo_jdcial varchar2 path
                                                     '$.ID_TTLO_JDCIAL',
                                                     cdgo_ttlo_jdcial_estdo
                                                     varchar2 path
                                                     '$.ACCION.v'))) loop
    
      --Se actualiza el campo cdgo_ttlo_jdcial_estdo
      begin
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'Actualizando el estado del titulo',
                              6);
        update gf_g_titulos_judicial a
           set a.cdgo_ttlo_jdcial_estdo = c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo
         where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al actualizar el Titulo Judicial';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo con exito de la Actualizacion del estado del titulo',
                            6);
    
      --Se registra la traza de estado de cada uno de los titulos
      begin
        begin
          select nmro_ttlo_jdcial
            into v_nmro_ttlo_jdcial
            from gf_g_titulos_judicial
           where cdgo_clnte = p_cdgo_clnte
             and id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial;
        end;
        if c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'CNS' then
          v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                         ' Apto para Consignacion';
        elsif c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'FRC' then
          v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                         ' Fraccionado';
        elsif c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'ASL' then
          v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                         ' Apto para Devolucion';
        elsif c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo = 'RCH' then
          v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                         ' Rechazado';
        end if;
      
        pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                     p_id_ttlo_jdcial         => c_ttlos_jdcial.id_ttlo_jdcial,
                                                     p_cdgo_ttlo_jdcial_estdo => c_ttlos_jdcial.cdgo_ttlo_jdcial_estdo,
                                                     p_obsrvcion              => v_obsrvcion,
                                                     p_id_usrio               => p_id_usrio,
                                                     o_cdgo_rspsta            => o_cdgo_rspsta,
                                                     o_mnsje_rspsta           => o_mnsje_rspsta);
      
        if o_cdgo_rspsta > 0 then
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_cdgo_rspsta || '-' || sqlerrm,
                                6);
          raise v_error;
        end if;
      exception
        when others then
          o_cdgo_rspsta  := 22;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al llamar el procedimiento prc_rg_titulos_traza';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    end loop;
  
    --2. Registro de traza de titulos judiciales
    /*begin
    
        begin
            select cdgo_ttlo_jdcial_estdo, nmro_ttlo_jdcial
              into v_cdgo_ttlo_jdcial_estdo, v_nmro_ttlo_jdcial
              from gf_g_titulos_judicial
             where cdgo_clnte = p_cdgo_clnte
               and id_ttlo_jdcial = p_id_ttlo_jdcial;
        end;
        if p_estdo = 'CNS' then
            v_obsrvcion := 'Titulo Consignado';
        elsif p_estdo = 'FRC' then
            v_obsrvcion := 'Titulo Fraccionado';
        elsif p_estdo = 'ASL' then
            v_obsrvcion := 'Titulo Apto para Devolucion';
        end if;
    
        pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte               => p_cdgo_clnte,
                                                     p_id_ttlo_jdcial           => p_id_ttlo_jdcial,
                                                     p_cdgo_ttlo_jdcial_estdo   => v_cdgo_ttlo_jdcial_estdo,
                                                     p_obsrvcion                => v_obsrvcion,
                                                     p_id_usrio                 => p_id_usrio,
                                                     p_indcdor_rqre_aprbccion   => 'N',
                                                     o_cdgo_rspsta              => o_cdgo_rspsta,
                                                     o_mnsje_rspsta             => o_mnsje_rspsta);
    
        if o_cdgo_rspsta != 0 then
            o_cdgo_rspsta := 5;
            o_mnsje_rspsta := o_cdgo_rspsta||' - '||'Error al registrar traza de titulo judicial. '||o_mnsje_rspsta||sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta||' , '||sqlerrm, 6);
            raise v_error;
        end if;
    
    end;*/
  
    --3. se consulta el flujo y la tarea para cambio de etapa
    /*begin
    
        select a.id_instncia_fljo,
               b.id_fljo_trea_orgen
          into v_id_instncia_fljo_hjo,
               v_id_fljo_trea_orgen
          from gf_g_titulos_judicial a
          join wf_g_instancias_transicion b on a.id_instncia_fljo = b.id_instncia_fljo
                                            and b.id_estdo_trnscion in (1,2)
          where id_ttlo_jdcial = p_id_ttlo_jdcial;
    
            pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                             p_id_fljo_trea   => v_id_fljo_trea_orgen,
                                                             p_json       => '[]' ,
                                                             o_type       => v_type_rspsta,
                                                             o_mnsje      => o_mnsje_rspsta,
                                                             o_id_fljo_trea   => v_fljo_trea,
                                                             o_error      => v_error_msg);
             if v_type_rspsta = 'S' then
                o_cdgo_rspsta := 7;
                o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al transitar a la etapa siguiente'||sqlerrm;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                raise v_error;
             end if;
    
    exception
        when no_data_found then
            o_cdgo_rspsta := 6;
            o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al encontrar el flujo y tarea para transitar a la etapa siguiente'||sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
            raise v_error;
    end; */
  
    /*if o_cdgo_rspsta = 0 then
        o_mnsje_rspsta := 'Titulo Judicial N? '||v_nmro_ttlo_jdcial||' cambio de estado satisfactorio';
    elsif o_cdgo_rspsta is null then
        o_mnsje_rspsta := 'Problemas para consignar o fraccionar.';
    end if;*/
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  end prc_ac_estdo_titulo;

  procedure prc_rg_titulo_vigencias(p_cdgo_clnte    in number,
                                    p_json_ttlos    in clob,
                                    p_json_crtra    in clob,
                                    p_id_usrio      in number,
                                    p_fcha_pryccion in date,
                                    o_cdgo_rspsta   out number,
                                    o_mnsje_rspsta  out varchar2) as
  
    v_nl                    number;
    v_id_instncia_fljo_hjo  number;
    v_id_fljo_trea_orgen    number;
    v_type_rspsta           varchar2(1);
    v_error_msg             varchar2(4000);
    v_mnsje_rspsta          varchar2(4000);
    v_id_ttlo_jdcial_impsto number;
    v_error                 exception;
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulo_vigencias';
    v_fljo_trea             number;
    v_id_impsto             number;
    v_id_impsto_sbmpsto     number;
    v_id_sjto_impsto        number;
    v_id_sjto_rspnsble      number;
    v_id_ttlo_jdcial        number;
    v_id_instncia_fljo      number;
    v_vlor_ttal_aplcar      number := 0;
    v_vlor_ttal_ttlo        number := 0;
    v_impsto                number := 0;
    v_crtra_slccnda         number := 0;
    v_vlor_saf              number := 0;
  begin
  
    insert into muerto3_tmp
      (v_001, c_001, t_001)
    values
      ('p_json_ttlos', p_json_ttlos, systimestamp);
    insert into muerto3_tmp
      (v_001, c_001, t_001)
    values
      ('p_json_crtra', p_json_crtra, systimestamp);
    commit;
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    if p_json_crtra is null then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'JSON VACIO',
                            6);
    else
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'JSON LLENO',
                            6);
    end if;
  
    for c_ttlo_jdcial in (select id_ttlo_jdcial, id_instncia_fljo
                            from json_table(p_json_ttlos,
                                            '$[*]'
                                            columns(id_ttlo_jdcial varchar2 path
                                                    '$.ID_TTLO_JDCIAL',
                                                    id_instncia_fljo varchar2 path
                                                    '$.ID_INSTNCIA_FLJO'))) loop
    
      v_id_ttlo_jdcial   := c_ttlo_jdcial.id_ttlo_jdcial;
      v_id_instncia_fljo := c_ttlo_jdcial.id_instncia_fljo;
      --Se busca el valor del titulo a consignar
      begin
        select sum(vlor)
          into v_vlor_ttal_ttlo
          from gf_g_titulos_judicial
         where id_instncia_fljo = v_id_instncia_fljo --id_ttlo_jdcial = v_id_ttlo_jdcial
           and cdgo_ttlo_jdcial_estdo = 'ACN';
      exception
        when no_data_found then
          null;
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta ||
                            ' - Problemas al consultar el valor del titulo ' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
      ----
      for impuesto in (select id_impsto
                       -- into v_impsto
                         from json_table(p_json_crtra,
                                         '$[*]'
                                         columns(id_impsto varchar2 path
                                                 '$.ID_IMPSTO',
                                                 id_impsto_sbmpsto varchar2 path
                                                 '$.ID_IMPSTO_SBMPSTO',
                                                 id_sjto_impsto varchar2 path
                                                 '$.ID_SJTO_IMPSTO',
                                                 id_sjto_rspnsble varchar2 path
                                                 '$.ID_SJTO_RSPNSBLE'))
                        group by id_impsto,
                                 id_impsto_sbmpsto,
                                 id_sjto_impsto,
                                 id_sjto_rspnsble) loop
      
        v_impsto := impuesto.id_impsto;
        /*exception
          when others then
            v_impsto := 0;
          
        end;*/
      end loop;
    
      if v_impsto = 0 then
        o_cdgo_rspsta  := 15;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - No se selecciono cartera ';
        raise v_error;
      end if;
      -----
    
      for c_impsto_jdcial in (select id_impsto,
                                     id_impsto_sbmpsto,
                                     id_sjto_impsto,
                                     id_sjto_rspnsble
                                from json_table(p_json_crtra,
                                                '$[*]'
                                                columns(id_impsto varchar2 path
                                                        '$.ID_IMPSTO',
                                                        id_impsto_sbmpsto
                                                        varchar2 path
                                                        '$.ID_IMPSTO_SBMPSTO',
                                                        id_sjto_impsto
                                                        varchar2 path
                                                        '$.ID_SJTO_IMPSTO',
                                                        id_sjto_rspnsble
                                                        varchar2 path
                                                        '$.ID_SJTO_RSPNSBLE'))
                               group by id_impsto,
                                        id_impsto_sbmpsto,
                                        id_sjto_impsto,
                                        id_sjto_rspnsble) loop
        --1. se insertan los impuestos
        begin
          insert into gf_g_titulos_jdcial_impsto
            (id_ttlo_jdcial,
             id_impsto,
             id_impsto_sbmpsto,
             id_sjto_impsto,
             id_sjto_rspnsble)
          values
            (c_ttlo_jdcial.id_ttlo_jdcial,
             c_impsto_jdcial.id_impsto,
             c_impsto_jdcial.id_impsto_sbmpsto,
             c_impsto_jdcial.id_sjto_impsto,
             c_impsto_jdcial.id_sjto_rspnsble)
          returning id_ttlo_jdcial_impsto into v_id_ttlo_jdcial_impsto;
        exception
          when others then
            o_cdgo_rspsta  := 1;
            o_mnsje_rspsta := o_cdgo_rspsta ||
                              ' - problemas insertar impuesto de la cartera del titulo ' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              'v_id_ttlo_jdcial_impsto:' ||
                              v_id_ttlo_jdcial_impsto,
                              6);
      
        begin
          select a.id_sjto_impsto
            into v_id_sjto_impsto
            from gf_g_titulos_jdcial_impsto a
           where a.id_ttlo_jdcial_impsto = v_id_ttlo_jdcial_impsto;
        exception
          when others then
            o_mnsje_rspsta := 'problemas al consultar sujeto ' || sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      
        /*  begin
          select nvl(sum(vlor_ttal_aplcar), 0)
            into v_vlor_ttal_aplcar
            from json_table(p_json_crtra,
                            '$[*]' columns(vlor_ttal_aplcar varchar2 path
                                    '$.VLOR_TTAL_APLCAR',
                                    id_sjto_impsto varchar2 path
                                    '$.ID_SJTO_IMPSTO'))
           where id_sjto_impsto = v_id_sjto_impsto;
        
        exception
          when others then
            o_cdgo_rspsta  := 10;
            o_mnsje_rspsta := o_cdgo_rspsta ||
                              ' - Problemas al consultar el valor a aplicar ' ||
                              sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
        
         if v_vlor_ttal_aplcar != v_vlor_ttal_ttlo then
          o_cdgo_rspsta  := 5;
          o_mnsje_rspsta := '' || o_cdgo_rspsta ||
                            ' El valor a consignar (' || v_vlor_ttal_aplcar ||
                            ') no es igual al valor del titulo (' ||
                            v_vlor_ttal_ttlo || ').';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          rollback;
          return;
        end if;*/
      
        for c_crtra_jdcial in (select vgncia,
                                      prdo,
                                      id_prdo,
                                      -- id_cncpto,
                                      id_sjto_impsto,
                                      vlor_cptal,
                                      vlor_intres,
                                      vlor_dscto,
                                      vlor_ttal,
                                      vlor_ttal_aplcar,
                                      vlor_ttal_aplccion,
                                      vlor_dscnto_aplccion,
                                      tpo_dcmnto,
                                      cdgo_mvmnto_orgn,
                                      id_orgen
                                 from json_table(p_json_crtra,
                                                 '$[*]'
                                                 columns(vgncia varchar2 path
                                                         '$.VGNCIA',
                                                         prdo varchar2 path
                                                         '$.PRDO',
                                                         id_prdo varchar2 path
                                                         '$.ID_PRDO',
                                                         /* id_cncpto varchar2 path
                                                         '$.ID_CNCPTO',*/
                                                         id_sjto_impsto
                                                         varchar2 path
                                                         '$.ID_SJTO_IMPSTO',
                                                         vlor_cptal varchar2 path
                                                         '$.VLOR_SLDO_CPTAL',
                                                         vlor_intres varchar2 path
                                                         '$.VLOR_SLDO_INTRES',
                                                         vlor_dscto varchar2 path
                                                         '$.VLOR_DSCNTO',
                                                         vlor_ttal varchar2 path
                                                         '$.VLOR_TTAL',
                                                         vlor_ttal_aplcar
                                                         varchar2 path
                                                         '$.VLOR_TTAL_APLCAR',
                                                         vlor_ttal_aplccion
                                                         varchar2 path
                                                         '$.VLOR_TTAL_APLCCION',
                                                         vlor_dscnto_aplccion
                                                         varchar2 path
                                                         '$.VLOR_DSCNTO_APLCCION',
                                                         tpo_dcmnto varchar2 path
                                                         '$.TPO_DCMNTO',
                                                         cdgo_mvmnto_orgn
                                                         varchar2 path
                                                         '$.CDGO_MVMNTO_ORGN',
                                                         id_orgen varchar2 path
                                                         '$.ID_ORGEN'))
                                where id_sjto_impsto = v_id_sjto_impsto) loop
          --2. se inserta la cartera asociada a la medida cautelar
          if c_crtra_jdcial.vlor_ttal_aplcar > 0 then
          
            begin
              insert into gf_g_titulos_jdcial_vgncia
                (id_ttlo_jdcial_impsto,
                 vgncia,
                 prdo,
                 id_prdo,
                 vlor_cptal,
                 vlor_intres,
                 vlor_dscto,
                 vlor_ttal,
                 vlor_ttal_ttlo,
                 vlor_ttal_aplcar,
                 vlor_ttal_aplccion,
                 vlor_dscnto_aplccion,
                 tpo_dcmnto,
                 cdgo_mvmnto_orgn,
                 id_orgen,
                 fcha_pryccion)
              values
                (v_id_ttlo_jdcial_impsto,
                 c_crtra_jdcial.vgncia,
                 c_crtra_jdcial.prdo,
                 c_crtra_jdcial.id_prdo,
                 c_crtra_jdcial.vlor_cptal,
                 c_crtra_jdcial.vlor_intres,
                 c_crtra_jdcial.vlor_dscto,
                 c_crtra_jdcial.vlor_ttal,
                 v_vlor_ttal_ttlo,
                 c_crtra_jdcial.vlor_ttal_aplcar,
                 c_crtra_jdcial.vlor_ttal_aplccion,
                 c_crtra_jdcial.vlor_dscnto_aplccion,
                 c_crtra_jdcial.tpo_dcmnto,
                 c_crtra_jdcial.cdgo_mvmnto_orgn,
                 c_crtra_jdcial.id_orgen,
                 p_fcha_pryccion);
            
            exception
              when others then
                o_cdgo_rspsta  := 2;
                o_mnsje_rspsta := o_cdgo_rspsta ||
                                  ' - problemas insertar las vigencias' ||
                                  sqlerrm;
              
                pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                      null,
                                      v_nmbre_up,
                                      v_nl,
                                      o_mnsje_rspsta,
                                      6);
                raise v_error;
            end;
          else
            o_cdgo_rspsta  := 22;
            o_mnsje_rspsta := o_cdgo_rspsta ||
                              ' - No hay cartera seleccionada';
            raise v_error;
          end if;
        end loop;
      end loop;
    end loop;
  
    begin
      select sum(vlor_ttal_aplcar)
        into v_crtra_slccnda
        from json_table(p_json_crtra,
                        '$[*]' columns(vlor_ttal_aplcar varchar2 path
                                '$.VLOR_TTAL_APLCAR'))
       where vlor_ttal_aplcar > 0;
    exception
      when others then
        v_crtra_slccnda := 0;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Valor seleccion: ' || v_crtra_slccnda,
                          6);
    --validamos si existe registro de saldo para vigencias futuras
    begin
      select sum(f.vlor_sldo_fvor)
        into v_vlor_saf
        from gf_g_titulos_judicial_saldo_favor f
       where f.id_instncia_fljo = v_id_instncia_fljo;
    exception
      when others then
        v_vlor_saf := 0;
    end;
  
    v_crtra_slccnda := v_crtra_slccnda + v_vlor_saf;
  
    if v_crtra_slccnda <> v_vlor_ttal_ttlo then
      o_cdgo_rspsta  := 5;
      o_mnsje_rspsta := '' || o_cdgo_rspsta ||
                        ' El valor a consignar no es igual al valor del titulo.';
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      rollback;
      return;
    end if;
  
    /*--se consulta el flujo y la tarea para cambio de etapa
        begin
    
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'p_id_ttlo_jdcial: '||p_id_ttlo_jdcial, 6);
            select a.id_instncia_fljo_hjo,
                   b.id_fljo_trea_orgen,
                   a.nmro_ttlo_jdcial
              into v_id_instncia_fljo_hjo,
                   v_id_fljo_trea_orgen,
                   v_nmro_ttlo_jdcial
              from gf_g_titulos_judicial a
              join wf_g_instancias_transicion b on a.id_instncia_fljo_hjo = b.id_instncia_fljo
                                                and b.id_estdo_trnscion in (1,2)
              where id_ttlo_jdcial = p_id_ttlo_jdcial;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'v_id_instncia_fljo_hjo: '||v_id_instncia_fljo_hjo||
                                                                ', v_id_fljo_trea_orgen: '||v_id_fljo_trea_orgen||
                                                                ', v_nmro_ttlo_jdcial: '||v_nmro_ttlo_jdcial, 6);
    
                pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                                 p_id_fljo_trea   => v_id_fljo_trea_orgen,
                                                                 p_json       => '[]' ,
                                                                 o_type       => v_type_rspsta,
                                                                 o_mnsje      => v_mnsje_rspsta,
                                                                 o_id_fljo_trea   => v_fljo_trea,
                                                                 o_error      => v_error_msg);
                 if v_type_rspsta = 'S' then
                    o_cdgo_rspsta := 7;
                    o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al transitar a la etapa siguiente. '||v_mnsje_rspsta||' - '||sqlerrm;
                    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                    raise v_error;
                 end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'v_type_rspsta: '||v_type_rspsta||
                                                                ', v_mnsje_rspsta: '||v_mnsje_rspsta||
                                                                ', v_fljo_trea: '||v_fljo_trea||
                                                                ', v_error_msg: '||v_error_msg, 6);
    
        exception
            when no_data_found then
                o_cdgo_rspsta := 6;
                o_mnsje_rspsta := 'Error No. '||o_cdgo_rspsta||' problemas al encontrar el flujo y tarea para trasitar a la etapa siguiente'||sqlerrm;
                pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta, 6);
                raise v_error;
        end;*/
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Vigencias registradas al Titulo Judicial Exitosamente!';
      commit;
    end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'o_mnsje_rspsta: ' || o_mnsje_rspsta,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo: ' || systimestamp,
                          6);
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo: ' || systimestamp,
                            6);
      -- raise_application_error(-20000, o_mnsje_rspsta);
  end prc_rg_titulo_vigencias;

  procedure prc_rg_titulo_vigencias_temp(p_cdgo_clnte    in number,
                                         p_json_ttlos    in clob,
                                         p_json_crtra    in clob,
                                         p_fcha_pryccion in date,
                                         o_cdgo_rspsta   out number,
                                         o_mnsje_rspsta  out varchar2) as
  
    v_nl number;
    --v_id_instncia_fljo_hjo  number;
    --v_id_fljo_trea_orgen    number;
    -- v_type_rspsta           varchar2(1);
    --v_error_msg             varchar2(4000);
    -- v_mnsje_rspsta          varchar2(4000);
    --v_id_ttlo_jdcial_impsto number;
    v_error    exception;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulo_vigencias';
    --v_fljo_trea             number;
    --v_id_impsto             number;
    --  v_id_impsto_sbmpsto     number;
    -- v_id_sjto_impsto        number;
    --  v_id_sjto_rspnsble      number;
    v_id_ttlo_jdcial   number;
    v_id_instncia_fljo number;
    --  v_vlor_ttal_aplcar      number := 0;
    v_vlor_ttal_ttlo number := 0;
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    if p_json_crtra is null then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'JSON VACIO',
                            6);
    else
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'JSON LLENO',
                            6);
    end if;
  
    for c_ttlo_jdcial in (select id_ttlo_jdcial, id_instncia_fljo
                            from json_table(p_json_ttlos,
                                            '$[*]'
                                            columns(id_ttlo_jdcial varchar2 path
                                                    '$.ID_TTLO_JDCIAL',
                                                    id_instncia_fljo varchar2 path
                                                    '$.ID_INSTNCIA_FLJO',
                                                    TTLO_JDCIAL_ESTDO varchar2 path
                                                    '$.TTLO_JDCIAL_ESTDO'))
                           where TTLO_JDCIAL_ESTDO = 'ACN') loop
      v_id_ttlo_jdcial   := c_ttlo_jdcial.id_ttlo_jdcial;
      v_id_instncia_fljo := c_ttlo_jdcial.id_instncia_fljo;
      --Se busca el valor del titulo a consignar
      begin
        select sum(vlor)
          into v_vlor_ttal_ttlo
          from gf_g_titulos_judicial
         where id_instncia_fljo = v_id_instncia_fljo --id_ttlo_jdcial = v_id_ttlo_jdcial
           and cdgo_ttlo_jdcial_estdo = 'ACN';
      exception
        when no_data_found then
          null;
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta ||
                            ' - Problemas al consultar el valor del titulo ' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
    end loop;
    for c_crtra_jdcial in (select id_impsto,
                                  id_impsto_sbmpsto,
                                  id_sjto_rspnsble,
                                  vgncia,
                                  prdo,
                                  id_prdo,
                                  id_cncpto,
                                  id_sjto_impsto,
                                  vlor_cptal,
                                  vlor_intres,
                                  vlor_dscto,
                                  vlor_ttal,
                                  vlor_ttal_aplcar,
                                  vlor_ttal_aplccion,
                                  vlor_dscnto_aplccion,
                                  tpo_dcmnto,
                                  cdgo_mvmnto_orgn,
                                  id_orgen
                             from json_table(p_json_crtra,
                                             '$[*]'
                                             columns(id_impsto varchar2 path
                                                     '$.ID_IMPSTO',
                                                     id_impsto_sbmpsto
                                                     varchar2 path
                                                     '$.ID_IMPSTO_SBMPSTO',
                                                     id_sjto_rspnsble varchar2 path
                                                     '$.ID_SJTO_RSPNSBLE',
                                                     vgncia varchar2 path
                                                     '$.VGNCIA',
                                                     prdo varchar2 path
                                                     '$.PRDO',
                                                     id_prdo varchar2 path
                                                     '$.ID_PRDO',
                                                     id_cncpto varchar2 path
                                                     '$.ID_CNCPTO',
                                                     id_sjto_impsto varchar2 path
                                                     '$.ID_SJTO_IMPSTO',
                                                     vlor_cptal varchar2 path
                                                     '$.VLOR_SLDO_CPTAL',
                                                     vlor_intres varchar2 path
                                                     '$.VLOR_SLDO_INTRES',
                                                     vlor_dscto varchar2 path
                                                     '$.VLOR_DSCNTO',
                                                     vlor_ttal varchar2 path
                                                     '$.VLOR_TTAL',
                                                     vlor_ttal_aplcar varchar2 path
                                                     '$.VLOR_TTAL_APLCAR',
                                                     vlor_ttal_aplccion
                                                     varchar2 path
                                                     '$.VLOR_TTAL_APLCCION',
                                                     vlor_dscnto_aplccion
                                                     varchar2 path
                                                     '$.VLOR_DSCNTO_APLCCION',
                                                     tpo_dcmnto varchar2 path
                                                     '$.TPO_DCMNTO',
                                                     cdgo_mvmnto_orgn varchar2 path
                                                     '$.CDGO_MVMNTO_ORGN',
                                                     id_orgen varchar2 path
                                                     '$.ID_ORGEN'))) loop
      --2. se inserta la cartera asociada a la medida cautelar
      begin
        insert into gf_g_titulos_jdcial_vgncia_temp
          (id_instncia_fljo,
           id_impsto,
           id_impsto_sbmpsto,
           id_sjto_impsto,
           id_sjto_rspnsble,
           vgncia,
           id_prdo,
           prdo,
           vlor_cptal,
           vlor_intres,
           vlor_dscto,
           vlor_ttal,
           vlor_ttal_ttlo,
           id_orgen,
           vlor_ttal_aplcar,
           vlor_ttal_aplccion,
           vlor_dscnto_aplccion,
           tpo_dcmnto,
           cdgo_mvmnto_orgn,
           fcha_pryccion)
        values
          (v_id_instncia_fljo,
           c_crtra_jdcial.id_impsto,
           c_crtra_jdcial.id_impsto_sbmpsto,
           c_crtra_jdcial.id_sjto_impsto,
           c_crtra_jdcial.id_sjto_rspnsble,
           c_crtra_jdcial.vgncia,
           c_crtra_jdcial.id_prdo,
           c_crtra_jdcial.prdo,
           c_crtra_jdcial.vlor_cptal,
           c_crtra_jdcial.vlor_intres,
           c_crtra_jdcial.vlor_dscto,
           c_crtra_jdcial.vlor_ttal,
           v_vlor_ttal_ttlo,
           c_crtra_jdcial.id_orgen,
           c_crtra_jdcial.vlor_ttal_aplcar,
           c_crtra_jdcial.vlor_ttal_aplccion,
           c_crtra_jdcial.vlor_dscnto_aplccion,
           c_crtra_jdcial.tpo_dcmnto,
           c_crtra_jdcial.cdgo_mvmnto_orgn,
           p_fcha_pryccion);
      exception
        when others then
          o_cdgo_rspsta  := 2;
          o_mnsje_rspsta := o_cdgo_rspsta ||
                            ' - problemas insertar las vigencias' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
      --end loop;
    end loop;
    --end loop;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := '!Vigencias registradas al Titulo Judicial Exitosamente!';
      commit;
    end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'o_mnsje_rspsta: ' || o_mnsje_rspsta,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo: ' || systimestamp,
                          6);
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'Saliendo: ' || systimestamp,
                            6);
  end prc_rg_titulo_vigencias_temp;

  procedure prc_rg_titulo_vigencias_fnal(p_cdgo_clnte   in number,
                                         p_json_ttlos   in clob,
                                         p_id_usrio     in number,
                                         o_cdgo_rspsta  out number,
                                         o_mnsje_rspsta out varchar2) as
  
    v_json             clob;
    v_fcha_pryccion    date;
    v_id_instncia_fljo number;
    v_error            exception;
    v_nl               number;
    v_nmbre_up         varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulo_vigencias_fnal';
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    begin
      select max(id_instncia_fljo)
        into v_id_instncia_fljo
        from json_table(p_json_ttlos,
                        '$[*]' columns(id_instncia_fljo varchar2 path
                                '$.ID_INSTNCIA_FLJO'));
    exception
      when no_data_found then
        null;
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := o_cdgo_rspsta ||
                          ' - Problemas al consultar el valor del titulo ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    begin
      select json_arrayagg(json_object('ID_INSTNCIA_FLJO' value
                                       a.id_instncia_fljo,
                                       'ID_IMPSTO' value a.id_impsto,
                                       'ID_IMPSTO_SBMPSTO' value
                                       a.id_impsto_sbmpsto,
                                       'ID_SJTO_IMPSTO' value
                                       a.id_sjto_impsto,
                                       'ID_SJTO_RSPNSBLE' value
                                       a.id_sjto_rspnsble,
                                       'VGNCIA' value a.vgncia,
                                       'ID_PRDO' value a.id_prdo,
                                       'PRDO' value a.prdo,
                                       'VLOR_SLDO_CPTAL' value a.vlor_cptal,
                                       'VLOR_SLDO_INTRES' value
                                       a.vlor_intres,
                                       'VLOR_DSCNTO' value a.vlor_dscto,
                                       'VLOR_TTAL' value a.vlor_ttal,
                                       'ID_ORGEN' value a.id_orgen,
                                       'VLOR_TTAL_APLCAR' value
                                       a.vlor_ttal_aplcar,
                                       'VLOR_TTAL_APLCCION' value
                                       a.vlor_ttal_aplccion,
                                       'VLOR_DSCNTO_APLCCION' value
                                       a.vlor_dscnto_aplccion,
                                       'TPO_DCMNTO' value a.tpo_dcmnto,
                                       'CDGO_MVMNTO_ORGN' value
                                       a.cdgo_mvmnto_orgn,
                                       'FCHA_PRYCCION' value a.fcha_pryccion
                                       returning clob) returning clob)
        into v_json
        from (select * from gf_g_titulos_jdcial_vgncia_temp) a
       where a.id_instncia_fljo = v_id_instncia_fljo;
    exception
      when no_data_found then
        null;
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := o_cdgo_rspsta ||
                          ' - Problemas al construir el json de cartera temporal ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    begin
      select max(fcha_pryccion)
        into v_fcha_pryccion
        from gf_g_titulos_jdcial_vgncia_temp
       where id_instncia_fljo = v_id_instncia_fljo;
    exception
      when no_data_found then
        null;
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := o_cdgo_rspsta ||
                          ' - No encontro la fecha de proyeccion ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    pkg_gf_titulos_judicial.prc_rg_titulo_vigencias(p_cdgo_clnte    => p_cdgo_clnte,
                                                    p_json_ttlos    => p_json_ttlos,
                                                    p_json_crtra    => v_json,
                                                    p_id_usrio      => p_id_usrio,
                                                    p_fcha_pryccion => v_fcha_pryccion,
                                                    o_cdgo_rspsta   => o_cdgo_rspsta,
                                                    o_mnsje_rspsta  => o_mnsje_rspsta);
    if o_cdgo_rspsta = 0 then
      begin
        delete gf_g_titulos_jdcial_vgncia_temp
         where id_instncia_fljo = v_id_instncia_fljo;
        commit;
      exception
        when others then
          rollback;
      end;
    end if;
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  end prc_rg_titulo_vigencias_fnal;

  procedure prc_gn_sgte_trnscion(p_cdgo_clnte     in number,
                                 p_id_ttlo_jdcial in number,
                                 p_json_ttlos     in clob,
                                 p_id_usrio       in number,
                                 o_cdgo_rspsta    out number,
                                 o_mnsje_rspsta   out varchar2) as
  
    v_error exception;
    v_nl    number;
    --v_id_acto_tpo               number;
    --v_cdgo_acto_tpo             gn_d_actos_tipo.cdgo_acto_tpo%type;
    v_fljo_trea            number;
    v_nmbre_up             varchar2(100) := 'pkg_gf_titulos_judicial.prc_gn_sgte_trnscion';
    v_id_instncia_fljo_hjo number;
    v_id_fljo_trea_orgen   number;
    v_type_rspsta          varchar2(1);
    v_error_msg            number;
    --v_nmro_ttlo_jdcial          gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    --v_cdgo_ttlo_jdcial_estdo    varchar2(5);
    --v_obsrvcion                 varchar2(100);
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'titulo: ' ||
                          JSON_VALUE(p_json_ttlos, '$.ID_TTLO_JDCIAL'),
                          6);
    if p_json_ttlos is null then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'json vacio',
                            6);
    else
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            'json lleno' || p_json_ttlos,
                            6);
    end if;
  
    --1. se consulta el flujo y la tarea para cambio de etapa
    begin
    
      select a.id_instncia_fljo, b.id_fljo_trea_orgen
        into v_id_instncia_fljo_hjo, v_id_fljo_trea_orgen
        from gf_g_titulos_judicial a
        join wf_g_instancias_transicion b
          on a.id_instncia_fljo = b.id_instncia_fljo
         and b.id_estdo_trnscion in (1, 2)
       where a.id_ttlo_jdcial =
             nvl(JSON_VALUE(p_json_ttlos, '$.ID_TTLO_JDCIAL'),
                 p_id_ttlo_jdcial);
      --and rownum = 1;
    
      pkg_pl_workflow_1_0.prc_rg_instancias_transicion(p_id_instncia_fljo => v_id_instncia_fljo_hjo,
                                                       p_id_fljo_trea     => v_id_fljo_trea_orgen,
                                                       p_json             => '[]',
                                                       o_type             => v_type_rspsta,
                                                       o_mnsje            => o_mnsje_rspsta,
                                                       o_id_fljo_trea     => v_fljo_trea,
                                                       o_error            => v_error_msg);
      if v_type_rspsta = 'S' then
        o_cdgo_rspsta  := 7;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al transitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
    exception
      when too_many_rows then
        o_cdgo_rspsta  := 5;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' registros duplicados del flujo y tarea para transitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      when no_data_found then
        o_cdgo_rspsta  := 6;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' problemas al encontrar el flujo y tarea para transitar a la etapa siguiente' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    if o_cdgo_rspsta = 0 then
      o_mnsje_rspsta := 'Siguiente tarea ejecutada con exito';
    elsif o_cdgo_rspsta is null then
      o_mnsje_rspsta := 'Problemas al transitar el flujo.';
    end if;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
  
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  end prc_gn_sgte_trnscion;

  procedure prc_ac_estdo_titulo_fnal(p_cdgo_clnte     in number,
                                     p_id_ttlo_jdcial in number,
                                     p_estdo          in varchar2,
                                     --p_json_ttlos            in clob,
                                     p_id_usrio     in number,
                                     o_cdgo_rspsta  out number,
                                     o_mnsje_rspsta out varchar2) as
  
    --------------------------------------------------------------
    --&procedimiento para actualizar la solicitud de devolucion&--
    --------------------------------------------------------------
    v_error                  exception;
    v_nl                     number;
    v_id_acto_tpo            number;
    v_cdgo_acto_tpo          gn_d_actos_tipo.cdgo_acto_tpo%type;
    v_fljo_trea              number;
    v_nmbre_up               varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_estdo_titulo_fnal';
    v_id_instncia_fljo_hjo   number;
    v_id_fljo_trea_orgen     number;
    v_type_rspsta            varchar2(1);
    v_error_msg              number;
    v_nmro_ttlo_jdcial       gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_cdgo_ttlo_jdcial_estdo varchar2(5);
    v_obsrvcion              varchar2(100);
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando:' || systimestamp,
                          6);
  
    --pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, 'JSON:' || p_json_ttlos, 6);
  
    /*for c_ttlos_jdcial in (select id_ttlo_jdcial
            --,cdgo_ttlo_jdcial_estdo
    from json_table(p_json_ttlos, '$[*]' columns (id_ttlo_jdcial         varchar2 path '$.ID_TTLO_JDCIAL'
                                                  /*,cdgo_ttlo_jdcial_estdo varchar2 path '$.ACCION.v'*/
    --))) loop
  
    begin
      select a.cdgo_ttlo_jdcial_estdo
        into v_cdgo_ttlo_jdcial_estdo
        from gf_g_titulos_judicial a
       where id_ttlo_jdcial = p_id_ttlo_jdcial; --c_ttlos_jdcial.id_ttlo_jdcial;
    exception
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al consultar estado del Titulo Judicial';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        raise v_error;
    end;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Actualizando el estado del titulo',
                          6);
  
    if v_cdgo_ttlo_jdcial_estdo = 'CNS' then
    
      --Se actualiza el campo cdgo_ttlo_jdcial_estdo
      begin
        update gf_g_titulos_judicial a
           set a.cdgo_ttlo_jdcial_estdo = p_estdo
         where id_ttlo_jdcial = p_id_ttlo_jdcial; --c_ttlos_jdcial.id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al actualizar el Titulo Judicial';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    elsif v_cdgo_ttlo_jdcial_estdo in ('CDT', 'SDT') then
    
      --Se actualiza el campo cdgo_ttlo_jdcial_estdo
      begin
        update gf_g_titulos_judicial a
           set a.cdgo_ttlo_jdcial_estdo = p_estdo
         where id_ttlo_jdcial = p_id_ttlo_jdcial; --c_ttlos_jdcial.id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al actualizar el Titulo Judicial';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    elsif v_cdgo_ttlo_jdcial_estdo = 'FRC' then
    
      --Se actualiza el campo cdgo_ttlo_jdcial_estdo
      begin
        update gf_g_titulos_judicial a
           set a.cdgo_ttlo_jdcial_estdo = p_estdo
         where id_ttlo_jdcial = p_id_ttlo_jdcial; --c_ttlos_jdcial.id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 1;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al actualizar el Titulo Judicial';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
      end;
    end if;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo con exito de la Actualizacion del estado del titulo',
                          6);
  
    --Se registra la traza de estado de cada uno de los titulos
    begin
      begin
        select a.nmro_ttlo_jdcial, a.cdgo_ttlo_jdcial_estdo
          into v_nmro_ttlo_jdcial, v_cdgo_ttlo_jdcial_estdo
          from gf_g_titulos_judicial a
         where a.cdgo_clnte = p_cdgo_clnte
           and a.id_ttlo_jdcial = p_id_ttlo_jdcial; --c_ttlos_jdcial.id_ttlo_jdcial;
      end;
      if v_cdgo_ttlo_jdcial_estdo = 'ATJ' then
        v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial || ' Aplicado';
      elsif v_cdgo_ttlo_jdcial_estdo = 'DVL' then
        v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial || ' Devuelto';
      elsif v_cdgo_ttlo_jdcial_estdo = 'FRD' then
        v_obsrvcion := 'Titulo No. ' || v_nmro_ttlo_jdcial ||
                       ' Fraccionado';
      end if;
    
      pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                   p_id_ttlo_jdcial         => p_id_ttlo_jdcial, --c_ttlos_jdcial.id_ttlo_jdcial,
                                                   p_cdgo_ttlo_jdcial_estdo => v_cdgo_ttlo_jdcial_estdo,
                                                   p_obsrvcion              => v_obsrvcion,
                                                   p_id_usrio               => p_id_usrio,
                                                   o_cdgo_rspsta            => o_cdgo_rspsta,
                                                   o_mnsje_rspsta           => o_mnsje_rspsta);
    
      if o_cdgo_rspsta > 0 then
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_cdgo_rspsta || '-' || sqlerrm,
                              6);
        raise v_error;
      end if;
    exception
      when others then
        o_cdgo_rspsta  := 22;
        o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                          'Error al llamar el procedimiento prc_rg_titulos_traza';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        raise v_error;
    end;
    --end loop;
  
    --2. Registro de traza de titulos judiciales
    /*begin
    
        begin
            select cdgo_ttlo_jdcial_estdo, nmro_ttlo_jdcial
              into v_cdgo_ttlo_jdcial_estdo, v_nmro_ttlo_jdcial
              from gf_g_titulos_judicial
             where cdgo_clnte = p_cdgo_clnte
               and id_ttlo_jdcial = p_id_ttlo_jdcial;
        end;
        if p_estdo = 'CNS' then
            v_obsrvcion := 'Titulo Consignado';
        elsif p_estdo = 'FRC' then
            v_obsrvcion := 'Titulo Fraccionado';
        elsif p_estdo = 'ASL' then
            v_obsrvcion := 'Titulo Apto para Devolucion';
        end if;
    
        pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte               => p_cdgo_clnte,
                                                     p_id_ttlo_jdcial           => p_id_ttlo_jdcial,
                                                     p_cdgo_ttlo_jdcial_estdo   => v_cdgo_ttlo_jdcial_estdo,
                                                     p_obsrvcion                => v_obsrvcion,
                                                     p_id_usrio                 => p_id_usrio,
                                                     p_indcdor_rqre_aprbccion   => 'N',
                                                     o_cdgo_rspsta              => o_cdgo_rspsta,
                                                     o_mnsje_rspsta             => o_mnsje_rspsta);
    
        if o_cdgo_rspsta != 0 then
            o_cdgo_rspsta := 5;
            o_mnsje_rspsta := o_cdgo_rspsta||' - '||'Error al registrar traza de titulo judicial. '||o_mnsje_rspsta||sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte, null, v_nmbre_up,  v_nl, o_mnsje_rspsta||' , '||sqlerrm, 6);
            raise v_error;
        end if;
    
    end;*/
  
    /*if o_cdgo_rspsta = 0 then
        o_mnsje_rspsta := 'Titulo Judicial N? '||v_nmro_ttlo_jdcial||' cambio de estado satisfactoriamente';
    elsif o_cdgo_rspsta is null then
        o_mnsje_rspsta := 'Problemas para consignar o fraccionar.';
    end if;*/
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo:' || systimestamp,
                          6);
    commit;
  exception
    when v_error then
      raise_application_error(-20000, o_mnsje_rspsta);
  end prc_ac_estdo_titulo_fnal;

  --Funcion que devuelve los titulos
  function fnc_gn_titulos_procesados(p_id_instncia_fljo in number)
    return varchar2 is
  
    v_titulos varchar2(4000);
  
  begin
  
    for titulos in (select a.nmro_ttlo_jdcial || ' por valor de ' ||
                           ltrim(rtrim(pkg_gn_generalidades.fnc_number_to_text(a.vlor,
                                                                               'd'))) ||
                           ' ($ ' ||
                           ltrim(rtrim(to_char(a.vlor, '999,999,999,999'))) || ')' vlor_ttlo
                      from gf_g_titulos_judicial a
                      left join v_mc_g_embargos_resolucion b
                        on b.cnsctvo_embrgo = a.cnsctvo_embrgo
                      left join mc_g_embrgos_crt_prc_jrd c
                        on c.id_embrgos_crtra = b.id_embrgos_crtra
                      left join cb_g_procesos_juridico d
                        on d.id_prcsos_jrdco = c.id_prcsos_jrdco
                      left join mc_g_embargos_cartera e
                        on e.id_embrgos_crtra = b.id_embrgos_crtra
                     where a.id_instncia_fljo = p_id_instncia_fljo
                    /* and a.cdgo_ttlo_jdcial_estdo =
                    p_cdgo_ttlo_jdcial_estdo*/
                     group by a.nmro_ttlo_jdcial, a.vlor) loop
    
      if v_titulos is null then
        v_titulos := titulos.vlor_ttlo;
      else
        v_titulos := v_titulos || ', ' || titulos.vlor_ttlo;
      end if;
    end loop;
    return v_titulos;
  end fnc_gn_titulos_procesados;

  function fnc_co_tabla_cartera_aplicada(p_id_instncia_fljo in number)
    return clob as
  
    v_tabla clob;
  
  begin
  
    v_tabla := '<table align="center" border="1" style="border-collapse:collapse;">' ||
               '<thead>' || '<tr>' ||
               '<th style="text-align: center; border:1px solid black">' ||
               'Referencia Catastral' || '</th>' ||
               '<th style="text-align: center; border:1px solid black">' ||
               'Vigencias' || '</th>' ||
               '<th style="text-align: center; border:1px solid black">' ||
               'Valor Aplicar' || '</th>' ||
               '<th style="text-align: center; border:1px solid black">' ||
               'Tipo De Pago' || '</th>' || '</tr>' || '</thead>' ||
               '<tbody>';
  
    begin
    
      for cartera in (select (select x.idntfccion_sjto
                                from v_si_i_sujetos_impuesto x
                               where x.id_sjto_impsto = n.id_sjto_impsto) idntfccion_sjto,
                             case
                               when a.tpo_dcmnto = 'DNO' then
                                listagg(a.vgncia, ',') within
                                group(order by a.vgncia)
                               when a.tpo_dcmnto = 'DAB' then
                                listagg(a.vgncia, ',') within
                                group(order by a.vgncia)
                             end vgncias,
                             to_char(a.vlor_ttal_aplcar,
                                     'FM$999G999G999G999G999G999G990') vlor_ttal_aplcar,
                             case
                               when a.tpo_dcmnto = 'DNO' then
                                'Pago Total'
                               when a.tpo_dcmnto = 'DAB' then
                                'Abono'
                             end frma_aplccion
                        from gf_g_titulos_jdcial_vgncia a
                        join gf_g_titulos_jdcial_impsto n
                          on n.id_ttlo_jdcial_impsto =
                             a.id_ttlo_jdcial_impsto
                       where a.id_ttlo_jdcial_impsto in
                             (select max(id_ttlo_jdcial_impsto)
                                from gf_g_titulos_jdcial_impsto i
                               where i.id_ttlo_jdcial in
                                     (select t.id_ttlo_jdcial
                                        from gf_g_titulos_judicial t
                                       where t.id_instncia_fljo =
                                             p_id_instncia_fljo
                                         and t.cdgo_ttlo_jdcial_estdo = 'ACN')
                               group by id_sjto_impsto)
                       group by a.tpo_dcmnto,
                                n.id_sjto_impsto,
                                a.vlor_ttal_aplcar
                       order by a.tpo_dcmnto, n.id_sjto_impsto, vgncias) loop
      
        v_tabla := v_tabla || '<tr>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   cartera.idntfccion_sjto || '</td>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   cartera.vgncias || '</td>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   cartera.vlor_ttal_aplcar || '</td>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   cartera.frma_aplccion || '</td>' || '</tr>';
      end loop;
    
      for saf in (select a.idntfccion_sjto,
                         'Vigencias Futuras' as viegencias,
                         to_char(sum(a.vlor_sldo_fvor),
                                 'FM$999G999G999G999G999G999G990') as vlor_ttal_aplcar,
                         'Saldo a Favor' as frma_aplccion
                    from gf_g_titulos_judicial_saldo_favor a
                    join gf_g_titulos_judicial b
                      on b.id_ttlo_jdcial = a.id_ttlo_jdcial
                   where a.id_instncia_fljo = p_id_instncia_fljo
                   group by a.idntfccion_sjto) loop
        v_tabla := v_tabla || '<tr>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   saf.idntfccion_sjto || '</td>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   saf.viegencias || '</td>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   saf.vlor_ttal_aplcar || '</td>' ||
                   '<td style="text-align: center; border:1px solid black">' ||
                   saf.frma_aplccion || '</td>' || '</tr>';
      end loop;
    
    end;
  
    v_tabla := v_tabla || '<tbody></table>';
  
    return v_tabla;
  
  end fnc_co_tabla_cartera_aplicada;

  function fnc_co_tabla_fracciones(p_id_instncia_fljo in number) return clob as
  
    v_tabla clob;
  
  begin
    v_tabla := '<!DOCTYPE html>
             <table border="1" align="center">
                    <thead>
                      <tr>
                         <th style="text-align: center; border: 1px solid black; "><b>Impuesto</b></th>
                         <th style="text-align: center; border: 1px solid black; "><b>Sub Impuesto</b></th>
                         <th style="text-align: center; border: 1px solid black; "><b>Valor Fraccion</b< /th>
                         <th style="text-align: center; border: 1px solid black; "><b>Observaciones</b< /th>
                      </tr>
                    </thead>
                    <tbody>';
  
    for datos in (select c.nmbre_impsto,
                         c.nmbre_impsto_sbmpsto,
                         ltrim(rtrim(to_char(a.vlor,
                                             'FM$999G999G999G999G999G999G990'))) vlor,
                         a.obsrvcn
                    from gf_g_titulos_jdcl_frccnmnto a
                    join gf_g_titulos_judicial b
                      on b.id_ttlo_jdcial = a.id_ttlo_jdcial
                    join v_df_i_impuestos_subimpuesto c
                      on c.id_impsto = a.id_impsto
                     and c.id_impsto_sbmpsto = a.id_impsto_sbmpsto
                   where b.id_instncia_fljo = p_id_instncia_fljo
                   order by a.orden) loop
    
      v_tabla := v_tabla ||
                 '<tr><td style="text-align: center; border:1px solid black">' ||
                 datos.nmbre_impsto ||
                 '</td><td style="text-align: center; border:1px solid black">' ||
                 datos.nmbre_impsto_sbmpsto ||
                 '</td>
                               </td><td style="text-align: center; border:1px solid black">' ||
                 datos.vlor ||
                 '</td>
                               </td><td style="text-align: left; border:1px solid black">' ||
                 datos.obsrvcn || '</td>
                               </tr>';
    end loop;
  
    v_tabla := v_tabla || '<tbody></table></html>';
  
    return v_tabla;
  end;

  procedure prc_ap_recaudos_titulos(p_cdgo_clnte     in number,
                                    p_id_ttlo_jdcial in number,
                                    p_fcha_rcdo      in re_g_recaudos_control.fcha_cntrol%type,
                                    p_id_bnco        in number,
                                    p_id_bnco_cnta   in number,
                                    p_id_usrio       in number,
                                    o_cdgo_rspsta    out number,
                                    o_mnsje_rspsta   out varchar2) as
  
    v_rcdo_cntrol number;
    v_id_rcdo     number;
    --v_id_bnco       number := 19;  --Banco Agrario No tiene codigo, como lo busco??
    --v_id_bnco_cnta  number := 54;  --ojo
  
  begin
  
    o_cdgo_rspsta := 0;
  
    begin
    
      --Se recorren los documentos generado
      for c_documentos in (select c.id_dcmnto,
                                  b.id_impsto,
                                  b.id_impsto_sbmpsto,
                                  c.nmro_dcmnto,
                                  to_char(c.fcha_dcmnto,
                                          'DD/MM/YYYY HH12:MI:SS AM') fcha_dcmnto,
                                  c.vlor_ttal_dcmnto,
                                  to_char(c.fcha_vncmnto, 'DD/MM/YYYY') fcha_vncmnto,
                                  b.id_sjto_impsto,
                                  'DC' cdgo_orgn_tpo --ojo
                             from gf_g_ttls_jdcl_impsto_dcmnt a
                             join gf_g_titulos_jdcial_impsto b
                               on b.id_ttlo_jdcial_impsto =
                                  a.id_ttlo_jdcial_impsto
                              and b.id_ttlo_jdcial = p_id_ttlo_jdcial
                             join v_re_g_documentos c
                               on c.id_dcmnto = a.id_dcmnto
                              and c.indcdor_pgo_aplcdo = 'N') loop
      
        -- Registrar el control
        pkg_re_recaudos.prc_rg_recaudo_control(p_cdgo_clnte        => p_cdgo_clnte,
                                               p_id_impsto         => c_documentos.id_impsto,
                                               p_id_impsto_sbmpsto => c_documentos.id_impsto_sbmpsto,
                                               p_id_bnco           => p_id_bnco,
                                               p_id_bnco_cnta      => p_id_bnco_cnta,
                                               p_fcha_cntrol       => to_char(p_fcha_rcdo,
                                                                              'DD/MM/YYYY'),
                                               p_obsrvcion         => 'Control de pagos Titulos Judiciales.',
                                               p_cdgo_rcdo_orgen   => 'MN', --OJO,
                                               p_id_usrio          => p_id_usrio,
                                               o_id_rcdo_cntrol    => v_rcdo_cntrol,
                                               o_cdgo_rspsta       => o_cdgo_rspsta,
                                               o_mnsje_rspsta      => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
          o_cdgo_rspsta  := 5 || '-' || o_cdgo_rspsta;
          o_mnsje_rspsta := 'No se pudo registrar el recaudo control. ' ||
                            o_mnsje_rspsta;
          rollback;
          continue;
        end if;
      
        -- Registrar el recaudo
        pkg_re_recaudos.prc_rg_recaudo(p_cdgo_clnte         => p_cdgo_clnte,
                                       p_id_rcdo_cntrol     => v_rcdo_cntrol,
                                       p_id_sjto_impsto     => c_documentos.id_sjto_impsto,
                                       p_cdgo_rcdo_orgn_tpo => c_documentos.cdgo_orgn_tpo,
                                       p_id_orgen           => c_documentos.id_dcmnto,
                                       p_vlor               => c_documentos.vlor_ttal_dcmnto,
                                       p_obsrvcion          => 'Control de pagos Titulos Judiciales.',
                                       p_cdgo_frma_pgo      => 'TR', -- Transferencia    ojo
                                       p_cdgo_rcdo_estdo    => 'RG', -- Se coloca RG para que se pueda aplicar.
                                       o_id_rcdo            => v_id_rcdo,
                                       o_cdgo_rspsta        => o_cdgo_rspsta,
                                       o_mnsje_rspsta       => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
          o_cdgo_rspsta  := 10 || '-' || o_cdgo_rspsta;
          o_mnsje_rspsta := 'No se pudo registrar el recaudo ' ||
                            o_mnsje_rspsta;
          rollback;
          continue;
        end if;
      
        -- Aplicar el pago
        pkg_re_recaudos.prc_ap_recaudo(p_id_usrio     => p_id_usrio,
                                       p_cdgo_clnte   => p_cdgo_clnte,
                                       p_id_rcdo      => v_id_rcdo,
                                       o_cdgo_rspsta  => o_cdgo_rspsta,
                                       o_mnsje_rspsta => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
          o_cdgo_rspsta  := 15 || '-' || o_cdgo_rspsta;
          o_mnsje_rspsta := 'No se pudo aplicar el recaudo ' ||
                            o_mnsje_rspsta;
          rollback;
          continue;
        end if;
      end loop;
    
    end;
  end prc_ap_recaudos_titulos;

  procedure prc_rg_documentos_titulos(p_cdgo_clnte     in number,
                                      p_id_ttlo_jdcial in number,
                                      p_json_ttlos     in clob,
                                      p_id_usrio       in number,
                                      o_cdgo_rspsta    out number,
                                      o_mnsje_rspsta   out varchar2) as
  
    v_nl        number;
    v_nmbre_up  varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_documentos_titulos';
    v_id_dcmnto number;
    v_error     exception;
  
  begin
  
    o_cdgo_rspsta := 0;
    v_nl          := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte,
                                                 null,
                                                 v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ' con: ' ||
                          p_cdgo_clnte || ',' || p_id_ttlo_jdcial || ',' ||
                          p_json_ttlos || ',' || p_id_usrio,
                          6);
  
    begin
      for c_ttlos_jdcial in (select id_ttlo_jdcial, ttlo_jdcial_estdo
                               from json_table(p_json_ttlos,
                                               '$[*]'
                                               columns(id_ttlo_jdcial
                                                       varchar2 path
                                                       '$.ID_TTLO_JDCIAL',
                                                       ttlo_jdcial_estdo
                                                       varchar2 path
                                                       '$.TTLO_JDCIAL_ESTDO'))
                              where ttlo_jdcial_estdo = 'ACN') loop
        --Se borrar los documentos si existen
        delete gf_g_ttls_jdcl_impsto_dcmnt
         where id_ttlo_jdcial = c_ttlos_jdcial.id_ttlo_jdcial; --p_id_ttlo_jdcial;
      end loop;
      --Se recorre la cartera para generar los documentos
      for c_cartera in (select a.id_impsto,
                               a.id_impsto_sbmpsto,
                               a.id_sjto_impsto,
                               sum(b.vlor_ttal_aplcar) vlor_ttla_aplcar,
                               b.tpo_dcmnto,
                               b.cdgo_mvmnto_orgn,
                               trunc(b.fcha_pryccion) fcha_pryccion,
                               json_object('VGNCIA_PRDO' value
                                           JSON_ARRAYAGG(json_object('vgncia'
                                                                     value
                                                                     vgncia,
                                                                     'prdo'
                                                                     value prdo,
                                                                     'id_orgen'
                                                                     value
                                                                     id_orgen))) vgncias_prdo,
                               a.id_ttlo_jdcial_impsto
                          from gf_g_titulos_jdcial_impsto a
                          join gf_g_titulos_jdcial_vgncia b
                            on a.id_ttlo_jdcial_impsto =
                               b.id_ttlo_jdcial_impsto
                         where a.id_ttlo_jdcial = p_id_ttlo_jdcial
                         group by a.id_impsto,
                                  a.id_impsto_sbmpsto,
                                  a.id_sjto_impsto,
                                  b.tpo_dcmnto,
                                  b.cdgo_mvmnto_orgn,
                                  trunc(b.fcha_pryccion),
                                  a.id_ttlo_jdcial_impsto) loop
      
        v_id_dcmnto := pkg_re_documentos.fnc_gn_documento(p_cdgo_clnte          => p_cdgo_clnte,
                                                          p_id_impsto           => c_cartera.id_impsto,
                                                          p_id_impsto_sbmpsto   => c_cartera.id_impsto_sbmpsto,
                                                          p_cdna_vgncia_prdo    => c_cartera.vgncias_prdo,
                                                          p_cdna_vgncia_prdo_ps => null,
                                                          p_id_dcmnto_lte       => null,
                                                          p_id_sjto_impsto      => c_cartera.id_sjto_impsto,
                                                          p_fcha_vncmnto        => c_cartera.fcha_pryccion,
                                                          p_cdgo_dcmnto_tpo     => c_cartera.tpo_dcmnto,
                                                          p_nmro_dcmnto         => null,
                                                          p_vlor_ttal_dcmnto    => c_cartera.vlor_ttla_aplcar,
                                                          p_indcdor_entrno      => 'PRVDO');
      
        if v_id_dcmnto is null then
          o_cdgo_rspsta  := 5;
          o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                            'Error al generar el documento.';
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || ' , ' || sqlerrm,
                                6);
          raise v_error;
        else
          for c_ttlos_jdcial in (select max(id_ttlo_jdcial) id_ttlo_jdcial,
                                        max(ttlo_jdcial_estdo) ttlo_jdcial_estdo
                                   from json_table(p_json_ttlos,
                                                   '$[*]'
                                                   columns(id_ttlo_jdcial
                                                           varchar2 path
                                                           '$.ID_TTLO_JDCIAL',
                                                           ttlo_jdcial_estdo
                                                           varchar2 path
                                                           '$.TTLO_JDCIAL_ESTDO'))
                                  where ttlo_jdcial_estdo in ('ACN', 'CNS')) loop
          
            if c_ttlos_jdcial.ttlo_jdcial_estdo in ('ACN', 'CNS') then
              begin
                --Se Registran los documentos generados
                insert into gf_g_ttls_jdcl_impsto_dcmnt
                  (id_ttlo_jdcial_impsto, id_ttlo_jdcial, id_dcmnto)
                values
                  (c_cartera.id_ttlo_jdcial_impsto,
                   c_ttlos_jdcial.id_ttlo_jdcial, --p_id_ttlo_jdcial,
                   v_id_dcmnto);
              exception
                when others then
                  o_cdgo_rspsta  := 10;
                  o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                                    'Error al registrar los documentos de pago. Id_ttlo_jdcial ' ||
                                    c_ttlos_jdcial.id_ttlo_jdcial; --p_id_ttlo_jdcial;
                  pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                        null,
                                        v_nmbre_up,
                                        v_nl,
                                        o_mnsje_rspsta || ' , ' || sqlerrm,
                                        6);
                
                  raise v_error;
              end;
            end if;
          end loop;
        end if;
      
      end loop;
    exception
      when v_error then
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || ' , ' || sqlerrm,
                              6);
        rollback;
    end;
  end prc_rg_documentos_titulos;

  procedure prc_rg_titulo_finaliza_traza(p_cdgo_clnte     in number,
                                         p_id_ttlo_jdcial in number,
                                         p_id_usrio       in number,
                                         p_cdgo_ttlo_nvo  in varchar2,
                                         p_obsrvcion      in varchar2,
                                         p_id_fljo_trea   in number,
                                         o_cdgo_rspsta    out number,
                                         o_mnsje_rspsta   out varchar2) as
  
    -- Procedimiento que registra la traza de la finalizacion de un titulo --
    v_nl                    number;
    v_nmbre_up              varchar2(70) := 'pkg_gf_titulos_judicial.prc_rg_titulo_finaliza_traza';
    t_gf_g_titulos_judicial gf_g_titulos_judicial%rowtype;
  
  begin
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando titulo: ' || p_id_ttlo_jdcial,
                          6);
  
    -- Se consulta la informaci?n del titulo
    begin
      select *
        into t_gf_g_titulos_judicial
        from gf_g_titulos_judicial
       where id_ttlo_jdcial = p_id_ttlo_jdcial;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'No. ' || o_cdgo_rspsta ||
                          ' No se encontro informaci?n del titulo';
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        rollback;
        return;
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'No. ' || o_cdgo_rspsta ||
                          ' Error al consultar el titulo: ' || sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        rollback;
        return;
    end; -- Fin Se consulta la informaci?n del titulo
  
    -- Se inserta la traza de la renta
    o_mnsje_rspsta := 'Parmetros: ' || p_id_ttlo_jdcial || ',' ||
                      t_gf_g_titulos_judicial.cdgo_ttlo_jdcial_estdo || ',' ||
                      p_obsrvcion || ',' || p_id_usrio || ',' || sysdate || ',' ||
                      p_cdgo_ttlo_nvo;
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          o_mnsje_rspsta,
                          6);
  
    begin
      insert into gf_g_titulos_judicial_traza
        (id_ttlo_jdcial,
         cdgo_ttlo_jdcial_estdo,
         OBSRVCION,
         id_usrio,
         FCHA,
         cdgo_ttlo_jdcial_estdo_nvo)
      values
        (p_id_ttlo_jdcial,
         t_gf_g_titulos_judicial.cdgo_ttlo_jdcial_estdo,
         p_obsrvcion,
         p_id_usrio,
         sysdate,
         p_cdgo_ttlo_nvo);
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Error al insertar la traza. ' || sqlerrm ||
                          ' Cdgo: ' || sqlcode;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        rollback;
        return;
    end; -- Fin Se inserta la traza
  
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'Registro de traza exitoso ';
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          o_mnsje_rspsta,
                          6);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo ' || systimestamp,
                          6);
  
  end prc_rg_titulo_finaliza_traza;

  function fnc_co_titulos_cnsgncion_sin_fnlzar(p_cdgo_clnte         in number,
                                               p_id_instncia_fljo   in number,
                                               p_idntfccion_dmndnte in varchar2,
                                               p_id_impsto          in number)
    return varchar2 as
  
    -------------------------------------------------------------------------------
    --Consulta si la identificacion tiene un titulo en consignacion sin finalizar --
    -------------------------------------------------------------------------------
  
    v_exste varchar2(1);
  
  begin
  
    begin
      select 'S'
        into v_exste
        from gf_g_titulos_judicial a
        join gf_g_titulos_jdcial_impsto b
          on b.id_ttlo_jdcial = a.id_ttlo_jdcial
        join gf_g_titulos_jdcial_vgncia c
          on c.id_ttlo_jdcial_impsto = b.id_ttlo_jdcial_impsto
       where a.idntfccion_dmnddo = p_idntfccion_dmndnte
         and a.cdgo_ttlo_jdcial_estdo != 'ATJ' --Consignado
         and a.id_instncia_fljo != p_id_instncia_fljo
         and b.id_impsto = p_id_impsto
         and a.cdgo_clnte = p_cdgo_clnte
       fetch first 1 rows only;
    exception
      when no_data_found then
        v_exste := 'N';
    end;
  
    return v_exste;
  
  end fnc_co_titulos_cnsgncion_sin_fnlzar;

  procedure prc_rg_titulos_judicial_rsgndo(p_cdgo_clnte        in number,
                                           p_json_ttlos        in clob,
                                           p_id_fncnrio_asgndo in number,
                                           p_id_fncnrio_asgna  in number,
                                           p_obsvcions         in varchar2,
                                           o_cdgo_rspsta       out number,
                                           o_mnsje_rspsta      out varchar2) as
  
    v_nl               number;
    v_nmbre_up         varchar2(70) := 'pkg_gf_titulos_judicial.prc_rg_titulos_judicial_rsgndo';
    v_error            exception;
    v_id_ttlo_jdcial   number;
    v_id_fncnrio       number;
    v_nmro_ttlo_jdcial gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_id_instncia_fljo gf_g_titulos_judicial.id_instncia_fljo%type;
    v_id_usurio        sg_g_usuarios.id_usrio%type;
  
  begin
  
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'Re - Asignacin Exitosa.';
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ' - ' ||
                          systimestamp,
                          1);
  
    begin
      select id_ttlo_jdcial, id_fncnrio, id_instncia_fljo
        into v_id_ttlo_jdcial, v_id_fncnrio, v_id_instncia_fljo
        from json_table(p_json_ttlos,
                        '$[*]'
                        columns(id_ttlo_jdcial varchar2 path
                                '$.ID_TTLO_JDCIAL',
                                id_fncnrio varchar2 path '$.ID_FNCNRIO',
                                id_instncia_fljo number path
                                '$.ID_INSTNCIA_FLJO'));
    exception
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' - Al consultar los datos del json. ' || sqlerrm;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || sqlerrm,
                              1);
      
        raise v_error;
    end;
  
    begin
      select a.nmro_ttlo_jdcial
        into v_nmro_ttlo_jdcial
        from gf_g_titulos_judicial a
       where a.id_ttlo_jdcial = v_id_ttlo_jdcial;
    exception
      when others then
        o_cdgo_rspsta  := 11;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' - Ttulo judicial ' || v_nmro_ttlo_jdcial ||
                          ' no existe. Por favor verifique!!! ' || sqlerrm;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta || sqlerrm,
                              1);
      
        raise v_error;
    end;
  
    if ((v_id_ttlo_jdcial is not null) and
       (p_id_fncnrio_asgndo is not null)) then
      begin
        update gf_g_titulos_judicial
           set id_fncnrio = p_id_fncnrio_asgndo
         where id_ttlo_jdcial = v_id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 2;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' - No fue posible re-asignar el ttulo ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || sqlerrm,
                                1);
        
          raise v_error;
      end;
    
      begin
        select id_usrio
          into v_id_usurio
          from v_sg_g_usuarios
         where id_fncnrio = p_id_fncnrio_asgndo;
      exception
        when others then
          o_cdgo_rspsta  := 10;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' no es posible validar el usuario asignado. ' ||
                            sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || sqlerrm,
                                1);
        
          raise v_error;
      end;
    
      begin
        update wf_g_instancias_transicion
           set id_usrio = v_id_usurio
         where id_instncia_fljo = v_id_instncia_fljo;
      exception
        when others then
          o_cdgo_rspsta  := 3;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' - No fue posible actualizar el usuario: ' ||
                            v_id_usurio ||
                            ' en wf_g_instancias_transicion para el ttulo ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || sqlerrm,
                                1);
        
          raise v_error;
      end;
    
      begin
        update wf_g_instancias_participante
           set id_prtcpte = v_id_usurio
         where id_fljo_trnscion = v_id_instncia_fljo;
      exception
        when others then
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' - No fue posible actualizar el usuario: ' ||
                            v_id_usurio ||
                            '  wf_g_instancias_participante, para el ttulo ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || sqlerrm,
                                1);
        
          raise v_error;
      end;
    
      begin
        update wf_g_instancias_flujo
           set id_usrio = v_id_usurio
         where id_instncia_fljo = v_id_instncia_fljo;
      exception
        when others then
          o_cdgo_rspsta  := 5;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' - No fue posible actualizar el usuario: ' ||
                            v_id_usurio ||
                            ' wf_g_instancias_flujo para el ttulo ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || sqlerrm,
                                1);
        
          raise v_error;
      end;
    
      begin
        insert into gf_g_titulos_judicial_rsgndos
          (id_ttlo_jdcial,
           id_fncnrio,
           id_fncnrio_rsgndo,
           id_fncnrio_rsgna,
           obsrvcnes,
           fcha_rsgna)
        values
          (v_id_ttlo_jdcial,
           v_id_fncnrio,
           p_id_fncnrio_asgndo,
           p_id_fncnrio_asgna,
           p_obsvcions,
           systimestamp);
      exception
        when others then
        
          o_cdgo_rspsta  := 4;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' - No fue posible registrar la re-asignacin del ttulo ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta || sqlerrm,
                                1);
        
          raise v_error;
      end;
    end if;
  
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'Ttulo No. ' || v_nmro_ttlo_jdcial ||
                      ' re-asignado con xito';
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            1);
    
  end prc_rg_titulos_judicial_rsgndo;

  procedure prc_rg_titulos_judiciales(p_cdgo_clnte     in number,
                                      p_json_ttlos     in clob,
                                      o_id_ttlo_jdcial out number,
                                      o_cdgo_rspsta    out number,
                                      o_mnsje_rspsta   out varchar2) is
  
    v_nl number;
  
    v_nmbre_up              varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulos_judiciales';
    v_id_ttlo_pdre          number;
    v_id_instncia_fljo_pdre number;
    v_id_bnco_cnsgnnte      varchar2(5);
    v_error                 exception;
    v_id_bnco_rcddr         varchar2(5);
    v_exste                 number;
  
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
  
    for c_ttlos in (select nmro_ttlo,
                           fcha_cnsttcion,
                           vlor,
                           id_ttlo_jdcial_area,
                           cdgo_idntfccion_tpo_dmndo,
                           idntfccion_dmndo,
                           nmbre_dmndo,
                           cnsctvo_embrgo,
                           id_embrgo_rslcion,
                           nmro_ttlo_pdre,
                           id_bnco_cnsgnnte,
                           id_bnco_rcddr,
                           id_fncnrio,
                           id_usrio_rgstro
                      from json_table(p_json_ttlos,
                                      '$[*]'
                                      columns(nmro_ttlo varchar2 path
                                              '$.NMRO_TTLO',
                                              fcha_cnsttcion varchar2 path
                                              '$.FCHA_CNSTTCION',
                                              vlor varchar2 path '$.VLOR',
                                              id_ttlo_jdcial_area number path
                                              '$.ID_TTLO_JDCIAL_AREA',
                                              cdgo_idntfccion_tpo_dmndo
                                              varchar2 path
                                              '$.CDGO_IDNTFCCION_TPO_DMNDO',
                                              idntfccion_dmndo varchar2 path
                                              '$.IDNTFCCION_DMNDO',
                                              nmbre_dmndo varchar2 path
                                              '$.NMBRE_DMNDO',
                                              cnsctvo_embrgo varchar2 path
                                              '$.CNSCTVO_EMBRGO',
                                              id_embrgo_rslcion varchar2 path
                                              '$.ID_EMBRGO_RSLCION',
                                              nmro_ttlo_pdre varchar2 path
                                              '$.NMRO_TTLO_PDRE',
                                              id_bnco_cnsgnnte varchar2 path
                                              '$.ID_BNCO_CNSGNNTE',
                                              id_bnco_rcddr varchar2 path
                                              '$.ID_BNCO_RCDDR',
                                              idntfccion_dmndnte varchar2 path
                                              '$.IDNTFCCION_DMNDNTE',
                                              nmbre_dmndnte varchar2 path
                                              '$.NMBRE_DMNDNTE',
                                              id_fncnrio number path
                                              '$.ID_FNCNRIO',
                                              id_usrio_rgstro number path
                                              '$.ID_USRIO_RGSTRO'))) loop
    
      if c_ttlos.nmro_ttlo is null then
      
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Json de los ttulos incompleto, verifique!!!';
        raise v_error;
      
      else
      
        if (c_ttlos.nmro_ttlo_pdre > 0) then
          begin
            select a.id_ttlo_jdcial, a.id_instncia_fljo
              into v_id_ttlo_pdre, v_id_instncia_fljo_pdre
              from gf_g_titulos_judicial a
             where a.nmro_ttlo_jdcial = c_ttlos.nmro_ttlo_pdre;
          exception
            when no_data_found then
              v_id_ttlo_pdre := null;
            when others then
              o_cdgo_rspsta  := 2;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta || ' - ' ||
                                'Problema al consultar el titulo padre';
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta || ' , ' || sqlerrm,
                                    6);
              raise v_error;
          end;
        end if;
      
        begin
          select a.cdgo_bnco
            into v_id_bnco_cnsgnnte
            from df_c_bancos a
           where a.id_bnco = c_ttlos.id_bnco_cnsgnnte
             and a.cdgo_clnte = p_cdgo_clnte;
        exception
          when no_data_found then
            v_id_bnco_cnsgnnte := null;
          when others then
            o_cdgo_rspsta  := 3;
            o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta || ' - ' ||
                              'Error al consultar el banco consignante';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      
        begin
          select a.cdgo_bnco
            into v_id_bnco_rcddr
            from df_c_bancos a
           where a.id_bnco = c_ttlos.id_bnco_rcddr
             and a.cdgo_clnte = p_cdgo_clnte;
        exception
          when no_data_found then
            v_id_bnco_rcddr := null;
          when others then
            o_cdgo_rspsta  := 4;
            o_mnsje_rspsta := o_cdgo_rspsta || ' - ' ||
                              'Error al consultar el banco recaudador';
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta || ' , ' || sqlerrm,
                                  6);
            raise v_error;
        end;
      
        begin
          select count(*)
            into v_exste
            from gf_g_titulos_judicial
           where nmro_ttlo_jdcial = c_ttlos.nmro_ttlo;
        exception
          when others then
            v_exste := 0;
        end;
      
        if (v_exste > 0) then
          o_cdgo_rspsta  := 100;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta || 'El ttulo ' ||
                            c_ttlos.nmro_ttlo ||
                            ' ya existe. Por favor verifique.!!!';
          raise v_error;
        else
          begin
            insert into gf_g_titulos_judicial
              (cdgo_clnte,
               id_ttlo_jdcial_crgdo,
               nmro_ttlo_jdcial,
               fcha_cnsttcion,
               vlor,
               id_ttlo_jdcial_area,
               cdgo_idntfccion_tpo_dmnddo,
               idntfccion_dmnddo,
               nmbre_dmnddo,
               cdgo_ttlo_jdcial_estdo,
               cnsctvo_embrgo,
               id_embrgo_rslcion,
               nmro_ttlo_pdre,
               id_ttlo_pdre,
               id_instncia_fljo_pdre,
               id_slctud,
               cdgo_entdad_cnsgnnte,
               id_bnco_cnsgnnte,
               cdgo_entdad_rcddr,
               id_bnco_rcddr,
               id_fncnrio,
               id_usrio_rgstro)
            values
              (p_cdgo_clnte,
               null,
               c_ttlos.nmro_ttlo,
               c_ttlos.fcha_cnsttcion,
               c_ttlos.vlor,
               c_ttlos.id_ttlo_jdcial_area,
               c_ttlos.cdgo_idntfccion_tpo_dmndo,
               c_ttlos.idntfccion_dmndo,
               c_ttlos.nmbre_dmndo,
               'RGS',
               c_ttlos.cnsctvo_embrgo,
               c_ttlos.id_embrgo_rslcion,
               c_ttlos.nmro_ttlo_pdre,
               v_id_ttlo_pdre,
               v_id_instncia_fljo_pdre,
               null,
               v_id_bnco_cnsgnnte,
               c_ttlos.id_bnco_cnsgnnte,
               v_id_bnco_rcddr,
               c_ttlos.id_bnco_rcddr,
               c_ttlos.id_fncnrio,
               c_ttlos.id_usrio_rgstro)
            returning id_ttlo_jdcial into o_id_ttlo_jdcial;
          
          exception
            when others then
              o_cdgo_rspsta  := 2;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                ' - Insertando en gf_g_titulos_judicial ' ||
                                sqlerrm;
          end;
        end if;
        if o_id_ttlo_jdcial is not null then
          pkg_gf_titulos_judicial.prc_rg_titulo_finaliza_traza(p_cdgo_clnte     => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial => o_id_ttlo_jdcial,
                                                               p_id_usrio       => c_ttlos.id_usrio_rgstro,
                                                               p_cdgo_ttlo_nvo  => 'RGS',
                                                               p_obsrvcion      => 'Registro inicial de ttulo judicial',
                                                               p_id_fljo_trea   => null,
                                                               o_cdgo_rspsta    => o_cdgo_rspsta,
                                                               o_mnsje_rspsta   => o_mnsje_rspsta);
          if o_cdgo_rspsta > 0 then
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
          end if;
        end if;
      
      end if;
    end loop;
  
  exception
    when v_error then
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
    
  end prc_rg_titulos_judiciales;

  procedure prc_rg_titulos_judicial_saf(p_cdgo_clnte       in number,
                                        p_id_instncia_fljo in number,
                                        p_idntfccion_sjto  in varchar2,
                                        p_vlor_sldo_fvor   in number,
                                        p_obsrvcnes        in varchar2,
                                        p_fcha_rgstro      in date,
                                        p_id_fncnrio       in number,
                                        o_cdgo_rspsta      out number,
                                        o_mnsje_rspsta     out varchar2) as
  
    v_nl number;
  
    v_nmbre_up                 varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_titulos_judicial_saf';
    v_error                    exception;
    v_id_ttlo_jdcial_sldo_fvor number(15);
    v_id_sjto_impsto           number;
    v_id_ttlo_jdcial           number;
  
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
  
    begin
      select id_sjto_impsto
        into v_id_sjto_impsto
        from v_si_i_sujetos_impuesto
       where idntfccion_sjto = p_idntfccion_sjto;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' - No se encontr la id_sjto_impsto para ' ||
                          p_idntfccion_sjto;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      
    end;
  
    begin
      select id_ttlo_jdcial
        into v_id_ttlo_jdcial
        from gf_g_titulos_judicial
       where id_instncia_fljo = p_id_instncia_fljo;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' - No se encontr el id_ttlo_jdcial para en esta instancia de flujo ' ||
                          p_id_instncia_fljo;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      
    end;
  
    begin
      insert into gf_g_titulos_judicial_saldo_favor
        (id_ttlo_jdcial,
         id_instncia_fljo,
         id_sjto_impsto,
         idntfccion_sjto,
         vlor_sldo_fvor,
         obsrvcnes,
         fcha_rgstro,
         id_fncnrio)
      values
        (v_id_ttlo_jdcial,
         p_id_instncia_fljo,
         v_id_sjto_impsto,
         p_idntfccion_sjto,
         p_vlor_sldo_fvor,
         p_obsrvcnes,
         p_fcha_rgstro,
         p_id_fncnrio)
      returning id_ttlo_jdcial_sldo_fvor into v_id_ttlo_jdcial_sldo_fvor;
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' - insertando en gf_g_titulos_judicial_saldo_favor ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
  exception
    when v_error then
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
    
  end prc_rg_titulos_judicial_saf;

  procedure prc_ac_titulos_judicial_embargo(p_cdgo_clnte     in number,
                                            p_json_ttlos     in clob,
                                            p_cnsctvo_embrgo in number,
                                            o_cdgo_rspsta    out number,
                                            o_mnsje_rspsta   out varchar2) as
  
    v_nl       number;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_titulos_judicial_embargo';
    v_error    exception;
  
    v_id_ttlo_jdcial     number;
    v_cnsctvo_embrgo     number;
    v_id_embrgos_rslcion number;
  
  begin
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
    begin
      select id_ttlo_jdcial
        into v_id_ttlo_jdcial
        from json_table(p_json_ttlos,
                        '$[*]' columns(id_ttlo_jdcial number path
                                '$.ID_TTLO_JDCIAL'));
    exception
      when others then
        o_cdgo_rspsta  := 01;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Json de los titulos incompleto o vaco. Por favor verifique!!!. ' ||
                          sqlerrm;
        raise v_error;
    end;
  
    begin
      select id_ttlo_jdcial
        into v_id_ttlo_jdcial
        from gf_g_titulos_judicial
       where id_ttlo_jdcial = v_id_ttlo_jdcial;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No existe el ttulo judicial. Por favor verifique!!!. ' ||
                          sqlerrm;
        raise v_error;
      
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No es posible validar el ttulo judicial. Por favor verifique!!!. ' ||
                          sqlerrm;
        raise v_error;
    end;
  
    begin
      select a.id_embrgos_rslcion
        into v_id_embrgos_rslcion
        from mc_g_embargos_resolucion a
       where a.cnsctvo_embrgo = p_cnsctvo_embrgo;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No existe el Embargo' || p_cnsctvo_embrgo ||
                          '. Por favor verifique!!!. ' || sqlerrm;
        raise v_error;
      
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No es posible validar el Embargo' ||
                          p_cnsctvo_embrgo || ' Por favor verifique!!!. ' ||
                          sqlerrm;
        raise v_error;
    end;
  
    begin
      update gf_g_titulos_judicial
         set cnsctvo_embrgo    = p_cnsctvo_embrgo,
             id_embrgo_rslcion = v_id_embrgos_rslcion
       where id_ttlo_jdcial = v_id_ttlo_jdcial;
    
      o_mnsje_rspsta := 'Embargo asociado corectamente.';
    exception
      when others then
        o_cdgo_rspsta  := 4;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Al actualizar el ttulo judicial. ' || sqlerrm;
        raise v_error;
    end;
  
  exception
    when v_error then
      rollback;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
  end prc_ac_titulos_judicial_embargo;

  procedure prc_rv_titulos_judicial(p_cdgo_clnte     in number,
                                    p_id_ttlo_jdcial in number,
                                    p_id_usrio       in number,
                                    p_obsrvcnes      in varchar2,
                                    o_cdgo_rspsta    out number,
                                    o_mnsje_rspsta   out varchar2) as
  
    v_cdgo_ttlo_jdcial_estdo varchar2(10);
    v_id_ttlo_jdcial_slctud  number;
    v_nmro_ttlo_jdcial       gf_g_titulos_judicial.nmro_ttlo_jdcial%type;
    v_id_ttlo_jdcial_rvrsa   number;
    v_nmbre_tbla             varchar2(100);
    v_id_orgen               number;
    v_fla                    clob;
    v_rcdos                  number;
    v_id_instncia_fljo       number;
    v_actos                  clob;
  
    v_nl       number;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_rv_titulos_judicial';
    v_error    exception;
  
  begin
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'Proceso de reversin del ttulo existoso.';
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
  
    begin
      select cdgo_ttlo_jdcial_estdo, nmro_ttlo_jdcial
        into v_cdgo_ttlo_jdcial_estdo, v_nmro_ttlo_jdcial
        from gf_g_titulos_judicial
       where id_ttlo_jdcial = p_id_ttlo_jdcial;
    exception
      when no_data_found then
        o_cdgo_rspsta  := 61;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No se encontr informacin del ttulo con id. ' ||
                          p_id_ttlo_jdcial || ', ' || sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      
    end;
  
    begin
      insert into gf_g_titulos_judicial_reversa
        (id_ttlo_jdcial, nmro_ttlo_jdcial, id_usrio, fcha_rvrsa, obsrvcnes)
      values
        (p_id_ttlo_jdcial,
         v_nmro_ttlo_jdcial,
         p_id_usrio,
         systimestamp,
         p_obsrvcnes)
      returning id_ttlo_jdcial_rvrsa into v_id_ttlo_jdcial_rvrsa;
    exception
      when others then
        o_cdgo_rspsta  := 62;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Al insertar en gf_g_titulos_judicial_reversa. ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    --inicio reversion devolucion
    if (v_cdgo_ttlo_jdcial_estdo in ('ASL', 'SDT', 'CDT', 'DVL')) then
    
      begin
        select a.id_ttlo_jdcial_slctud
          into v_id_ttlo_jdcial_slctud
          from gf_g_ttlos_jdcl_slctd_dtll a
         where a.id_ttlo_jdcial = p_id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 500;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' No se encontr el id_ttlo_jdcial_slctud. ' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      for fila in (select id_ttlo_jdcial_slctud_dtlle llave,
                          json_object('ID_TTLO_JDCIAL_SLCTUD_DTLLE' VALUE
                                      ID_TTLO_JDCIAL_SLCTUD_DTLLE,
                                      'ID_TTLO_JDCIAL_SLCTUD' VALUE
                                      ID_TTLO_JDCIAL_SLCTUD,
                                      'ID_TTLO_JDCIAL' VALUE ID_TTLO_JDCIAL) texto
                     from gf_g_ttlos_jdcl_slctd_dtll
                    where id_ttlo_jdcial = p_id_ttlo_jdcial) loop
      
        pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                             p_nmbre_tbla           => 'gf_g_ttlos_jdcl_slctd_dtll',
                                                             p_id_orgen             => fila.llave,
                                                             p_fla                  => fila.texto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
        
          o_mnsje_rspsta := o_mnsje_rspsta ||
                            '. No se pudo registrar el log para gf_g_ttlos_jdcl_slctd_dtll ID: ' ||
                            fila.llave;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
        end if;
      end loop;
    
      for fila in (select id_ttlo_jdcial_dcmnto_slctud llave,
                          json_object('id_ttlo_jdcial_dcmnto_slctud' value
                                      id_ttlo_jdcial_dcmnto_slctud,
                                      'id_ttlo_jdcial_dcmnto' value
                                      id_ttlo_jdcial_dcmnto,
                                      'id_ttlo_jdcial_slctud' value
                                      id_ttlo_jdcial_slctud) as texto
                     from gf_g_ttlos_jdcl_dcmnt_slctd
                    where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud) loop
      
        pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                             p_nmbre_tbla           => 'gf_g_ttlos_jdcl_dcmnt_slctd',
                                                             p_id_orgen             => fila.llave,
                                                             p_fla                  => fila.texto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
          o_mnsje_rspsta := o_mnsje_rspsta ||
                            '. No se pudo registrar el log para gf_g_ttlos_jdcl_dcmnt_slctd ID: ' ||
                            fila.llave;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
        end if;
      end loop;
    
      for fila in (select id_ttlo_jdcial_slctud llave,
                          json_object('ID_TTLO_JDCIAL_SLCTUD' value
                                      id_ttlo_jdcial_slctud,
                                      'CDGO_TTLO_JDCIAL_SLCTUD_TPO' value
                                      cdgo_ttlo_jdcial_slctud_tpo,
                                      'FCHA_SLCTUD' value fcha_slctud,
                                      'ID_USRIO' value id_usrio,
                                      'INDCDOR_SLCTUD_APRBDA' value
                                      indcdor_slctud_aprbda,
                                      'FCHA_RSPSTA' value fcha_rspsta,
                                      'INDCDOR_SLCTUD_CNFRMCION' value
                                      indcdor_slctud_cnfrmcion) as texto
                     from gf_g_titulos_jdcial_slctud) loop
      
        pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                             p_nmbre_tbla           => 'gf_g_titulos_jdcial_slctud',
                                                             p_id_orgen             => fila.llave,
                                                             p_fla                  => fila.texto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
          o_mnsje_rspsta := o_mnsje_rspsta ||
                            '. No se pudo registrar el log para gf_g_titulos_jdcial_slctud ID: ' ||
                            fila.llave;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
        end if;
      end loop;
    
      for dcmntos in (select a.id_ttlo_jdcial_dcmnto_asccn,
                             b.id_ttlo_jdcial_dcmnto,
                             c.id_acto,
                             c.id_dcmnto
                        from gf_g_ttls_jdcl_dcmnt_asccn a
                        join gf_g_titulos_jdcial_dcmnto b
                          on a.id_ttlo_jdcial_dcmnto =
                             b.id_ttlo_jdcial_dcmnto
                        join gn_g_actos c
                          on b.id_acto = c.id_acto
                         and c.cdgo_acto_orgen = 'TJP'
                         and a.id_ttlo_jdcial = c.id_orgen
                       where a.id_ttlo_jdcial = p_id_ttlo_jdcial) loop
      
        for fila in (select id_dcmnto_mtdta as llave,
                            json_object('id_dcmnto_mtdta' value
                                        id_dcmnto_mtdta,
                                        'id_dcmnto' value id_dcmnto,
                                        'id_dcmnto_tpo_mtdta' value
                                        id_dcmnto_tpo_mtdta,
                                        'vlor' value vlor) as texto
                       from gd_g_documentos_metadata
                      where id_dcmnto = dcmntos.id_dcmnto) loop
        
          pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                               p_nmbre_tbla           => 'gd_g_documentos_metadata',
                                                               p_id_orgen             => fila.llave,
                                                               p_fla                  => fila.texto,
                                                               o_cdgo_rspsta          => o_cdgo_rspsta,
                                                               o_mnsje_rspsta         => o_mnsje_rspsta);
        
          if o_cdgo_rspsta <> 0 then
            o_mnsje_rspsta := o_mnsje_rspsta ||
                              '. No se pudo registrar el log para gd_g_documentos_metadata ID: ' ||
                              fila.llave;
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                  p_id_impsto  => null,
                                  p_nmbre_up   => v_nmbre_up,
                                  p_nvel_log   => v_nl,
                                  p_txto_log   => o_mnsje_rspsta,
                                  p_nvel_txto  => 6);
            rollback;
            raise v_error;
          end if;
        end loop;
      
        for fila in (select d.id_dcmnto as llave,
                            d.file_blob,
                            d.file_bfile,
                            d.file_blob_nvo,
                            json_object('id_dcmnto' value id_dcmnto,
                                        'id_trd_srie_dcmnto_tpo' value
                                        id_trd_srie_dcmnto_tpo,
                                        'id_dcmnto_tpo' value id_dcmnto_tpo,
                                        'nmro_dcmnto' value nmro_dcmnto,
                                        'file_name' value file_name,
                                        'file_mimetype' value file_mimetype,
                                        'id_usrio' value id_usrio,
                                        'fcha' value fcha) as texto
                       from gd_g_documentos d
                      where d.id_dcmnto = dcmntos.id_dcmnto) loop
        
          pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                               p_nmbre_tbla           => 'gd_g_documentos',
                                                               p_id_orgen             => fila.llave,
                                                               p_fla                  => fila.texto,
                                                               p_blob                 => fila.file_blob,
                                                               p_bfile                => fila.file_bfile,
                                                               p_blob_nvo             => fila.file_blob_nvo,
                                                               o_cdgo_rspsta          => o_cdgo_rspsta,
                                                               o_mnsje_rspsta         => o_mnsje_rspsta);
        
          if o_cdgo_rspsta <> 0 then
            o_mnsje_rspsta := o_mnsje_rspsta ||
                              '. No se pudo registrar el log para gd_g_documentos ID: ' ||
                              fila.llave;
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                  p_id_impsto  => null,
                                  p_nmbre_up   => v_nmbre_up,
                                  p_nvel_log   => v_nl,
                                  p_txto_log   => o_mnsje_rspsta,
                                  p_nvel_txto  => 6);
            rollback;
            raise v_error;
          end if;
        end loop;
      
        for fila in (select id_ttlo_jdcial_dcmnto_asccn as llave,
                            json_object('id_ttlo_jdcial_dcmnto_asccn' value
                                        id_ttlo_jdcial_dcmnto_asccn,
                                        'id_ttlo_jdcial_dcmnto' value
                                        id_ttlo_jdcial_dcmnto,
                                        'id_ttlo_jdcial' value id_ttlo_jdcial) as texto
                       from gf_g_ttls_jdcl_dcmnt_asccn
                      where id_ttlo_jdcial_dcmnto_asccn =
                            dcmntos.id_ttlo_jdcial_dcmnto_asccn) loop
        
          pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                               p_nmbre_tbla           => 'gf_g_ttls_jdcl_dcmnt_asccn',
                                                               p_id_orgen             => fila.llave,
                                                               p_fla                  => fila.texto,
                                                               o_cdgo_rspsta          => o_cdgo_rspsta,
                                                               o_mnsje_rspsta         => o_mnsje_rspsta);
        
          if o_cdgo_rspsta <> 0 then
            o_mnsje_rspsta := o_mnsje_rspsta ||
                              '. No se pudo registrar el log para id_ttlo_jdcial_dcmnto_asccn ID: ' ||
                              fila.llave;
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                  p_id_impsto  => null,
                                  p_nmbre_up   => v_nmbre_up,
                                  p_nvel_log   => v_nl,
                                  p_txto_log   => o_mnsje_rspsta,
                                  p_nvel_txto  => 6);
            rollback;
            raise v_error;
          end if;
        end loop;
      
        for fila in (select id_ttlo_jdcial_dcmnto as llave,
                            json_object('id_ttlo_jdcial_dcmnto' value
                                        id_ttlo_jdcial_dcmnto,
                                        'id_acto_tpo' value id_acto_tpo,
                                        'id_plntlla' value id_plntlla,
                                        'id_rprte' value id_rprte,
                                        'id_acto' value id_acto,
                                        'indcdor_acto_cnfrmcion' value
                                        indcdor_acto_cnfrmcion) as texto
                       from gf_g_titulos_jdcial_dcmnto
                      where id_ttlo_jdcial_dcmnto =
                            dcmntos.id_ttlo_jdcial_dcmnto) loop
        
          pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                               p_nmbre_tbla           => 'gf_g_titulos_jdcial_dcmnto',
                                                               p_id_orgen             => fila.llave,
                                                               p_fla                  => fila.texto,
                                                               o_cdgo_rspsta          => o_cdgo_rspsta,
                                                               o_mnsje_rspsta         => o_mnsje_rspsta);
        
          if o_cdgo_rspsta <> 0 then
            o_mnsje_rspsta := o_mnsje_rspsta ||
                              '. No se pudo registrar el log para gf_g_titulos_jdcial_dcmnto ID: ' ||
                              fila.llave;
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                  p_id_impsto  => null,
                                  p_nmbre_up   => v_nmbre_up,
                                  p_nvel_log   => v_nl,
                                  p_txto_log   => o_mnsje_rspsta,
                                  p_nvel_txto  => 6);
            rollback;
            raise v_error;
          end if;
        end loop;
      
        pkg_gf_titulos_judicial.prc_ac_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                             p_id_orgen             => dcmntos.id_ttlo_jdcial_dcmnto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
        for fila in (select id_acto as llave,
                            json_object('id_acto' value id_acto,
                                        'cdgo_clnte' value cdgo_clnte,
                                        'cdgo_acto_orgen' value
                                        cdgo_acto_orgen,
                                        'id_orgen' value id_orgen,
                                        'id_undad_prdctra' value
                                        id_undad_prdctra,
                                        'id_acto_tpo' value id_acto_tpo,
                                        'nmro_acto' value nmro_acto,
                                        'anio' value anio,
                                        'nmro_acto_dsplay' value
                                        nmro_acto_dsplay,
                                        'fcha' value fcha,
                                        'id_usrio' value id_usrio,
                                        'id_rprte' value id_rprte,
                                        'fcha_incio_ntfccion' value
                                        fcha_incio_ntfccion,
                                        'id_acto_rqrdo_ntfccion' value
                                        id_acto_rqrdo_ntfccion,
                                        'fcha_ntfccion' value fcha_ntfccion,
                                        'id_fncnrio_frma' value
                                        id_fncnrio_frma,
                                        'indcdor_ntfccion' value
                                        indcdor_ntfccion,
                                        'vlor' value vlor,
                                        'id_dcmnto' value id_dcmnto,
                                        'fcha_pblccion' value fcha_pblccion,
                                        'ntfcdo_pag_web' value ntfcdo_pag_web) as texto
                       from gn_g_actos
                      where id_acto = dcmntos.id_acto) loop
        
          pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                               p_nmbre_tbla           => 'gn_g_actos',
                                                               p_id_orgen             => fila.llave,
                                                               p_fla                  => fila.texto,
                                                               o_cdgo_rspsta          => o_cdgo_rspsta,
                                                               o_mnsje_rspsta         => o_mnsje_rspsta);
        
          if o_cdgo_rspsta <> 0 then
            o_mnsje_rspsta := o_mnsje_rspsta ||
                              '. No se pudo registrar el log para gn_g_actos ID: ' ||
                              fila.llave;
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                  p_id_impsto  => null,
                                  p_nmbre_up   => v_nmbre_up,
                                  p_nvel_log   => v_nl,
                                  p_txto_log   => o_mnsje_rspsta,
                                  p_nvel_txto  => 6);
            rollback;
            raise v_error;
          end if;
        end loop;
      
        if o_cdgo_rspsta = 0 then
          begin
            delete gf_g_ttlos_jdcl_slctd_dtll
             where id_ttlo_jdcial = p_id_ttlo_jdcial;
          
            delete gf_g_ttlos_jdcl_dcmnt_slctd
             where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud;
          
            delete gf_g_titulos_jdcial_slctud
             where id_ttlo_jdcial_slctud = v_id_ttlo_jdcial_slctud;
          
            delete gd_g_documentos_metadata
             where id_dcmnto = dcmntos.id_dcmnto;
          
            delete gd_g_documentos where id_dcmnto = dcmntos.id_dcmnto;
          
            delete gf_g_ttls_jdcl_dcmnt_asccn
             where id_ttlo_jdcial_dcmnto = dcmntos.id_ttlo_jdcial_dcmnto;
          
            delete gf_g_titulos_jdcial_dcmnto
             where id_ttlo_jdcial_dcmnto = dcmntos.id_ttlo_jdcial_dcmnto;
          
            delete gn_g_actos where id_acto = dcmntos.id_acto;
          exception
            when others then
              rollback;
              o_cdgo_rspsta  := 509;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                ' No se puede reversar la devolucin del ttulo. ' ||
                                v_nmro_ttlo_jdcial || '. ' || sqlerrm;
              pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                    null,
                                    v_nmbre_up,
                                    v_nl,
                                    o_mnsje_rspsta,
                                    6);
              raise v_error;
          end;
        else
          o_mnsje_rspsta := o_mnsje_rspsta ||
                            ' Error al reversar la devolucin del ttulo. ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
        end if;
      
      end loop;
    
    end if;
    --fin reversion devolucion
  
    --Inicio reversion fraccionamiento
    if (v_cdgo_ttlo_jdcial_estdo in ('FRC', 'FRD')) then
    
      for dcmntos in (select a.id_ttlo_jdcial_dcmnto_asccn,
                             b.id_ttlo_jdcial_dcmnto,
                             c.id_acto,
                             c.id_dcmnto
                        from gf_g_ttls_jdcl_dcmnt_asccn a
                        join gf_g_titulos_jdcial_dcmnto b
                          on a.id_ttlo_jdcial_dcmnto =
                             b.id_ttlo_jdcial_dcmnto
                        join gn_g_actos c
                          on b.id_acto = c.id_acto
                         and c.cdgo_acto_orgen = 'TJP'
                         and a.id_ttlo_jdcial = c.id_orgen
                       where a.id_ttlo_jdcial = p_id_ttlo_jdcial) loop
      
        for fila in (select id_dcmnto_mtdta as llave,
                            json_object('id_dcmnto_mtdta' value
                                        id_dcmnto_mtdta,
                                        'id_dcmnto' value id_dcmnto,
                                        'id_dcmnto_tpo_mtdta' value
                                        id_dcmnto_tpo_mtdta,
                                        'vlor' value vlor) as texto
                       from gd_g_documentos_metadata
                      where id_dcmnto = dcmntos.id_dcmnto) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gd_g_documentos_metadata',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 80;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gd_g_documentos_metadata ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
        for fila in (select d.id_dcmnto as llave,
                            d.file_blob,
                            d.file_bfile,
                            d.file_blob_nvo,
                            json_object('id_dcmnto' value id_dcmnto,
                                        'id_trd_srie_dcmnto_tpo' value
                                        id_trd_srie_dcmnto_tpo,
                                        'id_dcmnto_tpo' value id_dcmnto_tpo,
                                        'nmro_dcmnto' value nmro_dcmnto,
                                        'file_name' value file_name,
                                        'file_mimetype' value file_mimetype,
                                        'id_usrio' value id_usrio,
                                        'fcha' value fcha) as texto
                       from gd_g_documentos d
                      where d.id_dcmnto = dcmntos.id_dcmnto) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gd_g_documentos',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 p_blob                 => fila.file_blob,
                                                                 p_bfile                => fila.file_bfile,
                                                                 p_blob_nvo             => fila.file_blob_nvo,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 81;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gd_g_documentos ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
        for fila in (select id_ttlo_jdcial_dcmnto_asccn as llave,
                            json_object('id_ttlo_jdcial_dcmnto_asccn' value
                                        id_ttlo_jdcial_dcmnto_asccn,
                                        'id_ttlo_jdcial_dcmnto' value
                                        id_ttlo_jdcial_dcmnto,
                                        'id_ttlo_jdcial' value id_ttlo_jdcial) as texto
                       from gf_g_ttls_jdcl_dcmnt_asccn
                      where id_ttlo_jdcial_dcmnto =
                            dcmntos.id_ttlo_jdcial_dcmnto) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_ttls_jdcl_dcmnt_asccn',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 82;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para id_ttlo_jdcial_dcmnto_asccn ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
        for fila in (select id_ttlo_jdcial_dcmnto as llave,
                            json_object('id_ttlo_jdcial_dcmnto' value
                                        id_ttlo_jdcial_dcmnto,
                                        'id_acto_tpo' value id_acto_tpo,
                                        'id_plntlla' value id_plntlla,
                                        'id_rprte' value id_rprte,
                                        'id_acto' value id_acto,
                                        'indcdor_acto_cnfrmcion' value
                                        indcdor_acto_cnfrmcion) as texto
                       from gf_g_titulos_jdcial_dcmnto
                      where id_ttlo_jdcial_dcmnto =
                            dcmntos.id_ttlo_jdcial_dcmnto) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_titulos_jdcial_dcmnto',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 83;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gf_g_titulos_jdcial_dcmnto ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
        pkg_gf_titulos_judicial.prc_ac_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                             p_id_orgen             => dcmntos.id_ttlo_jdcial_dcmnto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
        for fila in (select id_acto as llave,
                            json_object('id_acto' value id_acto,
                                        'cdgo_clnte' value cdgo_clnte,
                                        'cdgo_acto_orgen' value
                                        cdgo_acto_orgen,
                                        'id_orgen' value id_orgen,
                                        'id_undad_prdctra' value
                                        id_undad_prdctra,
                                        'id_acto_tpo' value id_acto_tpo,
                                        'nmro_acto' value nmro_acto,
                                        'anio' value anio,
                                        'nmro_acto_dsplay' value
                                        nmro_acto_dsplay,
                                        'fcha' value fcha,
                                        'id_usrio' value id_usrio,
                                        'id_rprte' value id_rprte,
                                        'fcha_incio_ntfccion' value
                                        fcha_incio_ntfccion,
                                        'id_acto_rqrdo_ntfccion' value
                                        id_acto_rqrdo_ntfccion,
                                        'fcha_ntfccion' value fcha_ntfccion,
                                        'id_fncnrio_frma' value
                                        id_fncnrio_frma,
                                        'indcdor_ntfccion' value
                                        indcdor_ntfccion,
                                        'vlor' value vlor,
                                        'id_dcmnto' value id_dcmnto,
                                        'fcha_pblccion' value fcha_pblccion,
                                        'ntfcdo_pag_web' value ntfcdo_pag_web) as texto
                       from gn_g_actos
                      where id_acto = dcmntos.id_acto) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gn_g_actos',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 84;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gn_g_actos ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      end loop;
    
      for fila in (select id_ttlo_jdcial_frccn as llave,
                          json_object('id_ttlo_jdcial_frccn' value
                                      id_ttlo_jdcial_frccn,
                                      'id_ttlo_jdcial' value id_ttlo_jdcial,
                                      'id_impsto' value id_impsto,
                                      'id_impsto_sbmpsto' value
                                      id_impsto_sbmpsto,
                                      'orden' value orden,
                                      'vlor' value vlor,
                                      'obsrvcn' value obsrvcn,
                                      'indcdor_frccn_rgstrda' value
                                      indcdor_frccn_rgstrda,
                                      'id_ttlo_jdcial_rgstrdo' value
                                      id_ttlo_jdcial_rgstrdo) as texto
                     from gf_g_titulos_jdcl_frccnmnto
                    where id_ttlo_jdcial = p_id_ttlo_jdcial) loop
      
        begin
          pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                               p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                               p_nmbre_tbla           => 'gf_g_titulos_jdcl_frccnmnto',
                                                               p_id_orgen             => fila.llave,
                                                               p_fla                  => fila.texto,
                                                               o_cdgo_rspsta          => o_cdgo_rspsta,
                                                               o_mnsje_rspsta         => o_mnsje_rspsta);
        
        exception
          when others then
            o_cdgo_rspsta  := 85;
            o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                              '. No se pudo registrar el log para gf_g_titulos_jdcl_frccnmnto ID: ' ||
                              fila.llave || ' Error: ' || o_mnsje_rspsta;
          
            pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                  p_id_impsto  => null,
                                  p_nmbre_up   => v_nmbre_up,
                                  p_nvel_log   => v_nl,
                                  p_txto_log   => o_mnsje_rspsta,
                                  p_nvel_txto  => 6);
            rollback;
            raise v_error;
        end;
      end loop;
    
      for frccnes in (select a.id_ttlo_jdcial_dcmnto_asccn,
                             b.id_ttlo_jdcial_dcmnto,
                             c.id_acto,
                             c.id_dcmnto
                        from gf_g_ttls_jdcl_dcmnt_asccn a
                        join gf_g_titulos_jdcial_dcmnto b
                          on a.id_ttlo_jdcial_dcmnto =
                             b.id_ttlo_jdcial_dcmnto
                        join gn_g_actos c
                          on b.id_acto = c.id_acto
                         and c.cdgo_acto_orgen = 'TJP'
                         and a.id_ttlo_jdcial = c.id_orgen
                       where a.id_ttlo_jdcial = p_id_ttlo_jdcial) loop
      
        begin
        
          delete gd_g_documentos_metadata
           where id_dcmnto = frccnes.id_dcmnto;
        
          delete gd_g_documentos where id_dcmnto = frccnes.id_dcmnto;
        
          delete gf_g_ttls_jdcl_dcmnt_asccn a
           where id_ttlo_jdcial_dcmnto = frccnes.id_ttlo_jdcial_dcmnto;
        
          delete gf_g_titulos_jdcial_dcmnto
           where id_ttlo_jdcial_dcmnto = frccnes.id_ttlo_jdcial_dcmnto;
        
          delete gn_g_actos where id_acto = frccnes.id_acto;
        
          delete gf_g_titulos_jdcl_frccnmnto
           where id_ttlo_jdcial = p_id_ttlo_jdcial;
        
        exception
          when others then
            rollback;
            o_cdgo_rspsta  := 86;
            o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                              ' No se puede reversar el fraccionamiento del ttulo. ' ||
                              v_nmro_ttlo_jdcial || '. ' || sqlerrm;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
        end;
      end loop;
    end if;
    --Fin reversion fraccionamiento
  
    --Inicio reversion Aplicacion/consignacion
    if (v_cdgo_ttlo_jdcial_estdo in ('ACN', 'CNS', 'ATJ')) then
      -- validamos que los documento de cobro no esten aplicados
      begin
        select count(*)
          into v_rcdos
          from re_g_recaudos r
         where r.nmro_dcmnto in
               (select d.nmro_dcmnto
                  from gf_g_ttls_jdcl_impsto_dcmnt a
                  join re_g_documentos d
                    on a.id_dcmnto = d.id_dcmnto
                 where a.id_ttlo_jdcial = p_id_ttlo_jdcial)
           and r.cdgo_rcdo_estdo = 'AP';
      exception
        when others then
          v_rcdos := 0;
      end;
    
      if (v_rcdos > 0) then
        o_cdgo_rspsta  := 128;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No se puede reversar el ttulo. Ya existen recaudos aplicados. ' ||
                          sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
      end if;
    
      for dcmntos in (select a.id_ttlo_jdcial_dcmnto_asccn,
                             b.id_ttlo_jdcial_dcmnto,
                             c.id_acto,
                             c.id_dcmnto
                        from gf_g_ttls_jdcl_dcmnt_asccn a
                        join gf_g_titulos_jdcial_dcmnto b
                          on a.id_ttlo_jdcial_dcmnto =
                             b.id_ttlo_jdcial_dcmnto
                        join gn_g_actos c
                          on b.id_acto = c.id_acto
                         and c.cdgo_acto_orgen = 'TJP'
                         and a.id_ttlo_jdcial = c.id_orgen
                       where a.id_ttlo_jdcial = p_id_ttlo_jdcial) loop
        begin
          for fila in (select id_dcmnto_mtdta as llave,
                              json_object('id_dcmnto_mtdta' value
                                          id_dcmnto_mtdta,
                                          'id_dcmnto' value id_dcmnto,
                                          'id_dcmnto_tpo_mtdta' value
                                          id_dcmnto_tpo_mtdta,
                                          'vlor' value vlor) as texto
                         from gd_g_documentos_metadata
                        where id_dcmnto = dcmntos.id_dcmnto) loop
            begin
              pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                   p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                   p_nmbre_tbla           => 'gd_g_documentos_metadata',
                                                                   p_id_orgen             => fila.llave,
                                                                   p_fla                  => fila.texto,
                                                                   o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                   o_mnsje_rspsta         => o_mnsje_rspsta);
            
            exception
              when others then
                o_cdgo_rspsta  := 129;
                o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                  '. No se pudo registrar el log para gd_g_documentos_metadata ID: ' ||
                                  fila.llave || ' Error: ' ||
                                  o_mnsje_rspsta;
              
                pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                      p_id_impsto  => null,
                                      p_nmbre_up   => v_nmbre_up,
                                      p_nvel_log   => v_nl,
                                      p_txto_log   => o_mnsje_rspsta,
                                      p_nvel_txto  => 6);
                rollback;
                raise v_error;
            end;
          end loop;
        end;
      
        begin
          for fila in (select d.id_dcmnto as llave,
                              d.file_blob,
                              d.file_bfile,
                              d.file_blob_nvo,
                              json_object('id_dcmnto' value id_dcmnto,
                                          'id_trd_srie_dcmnto_tpo' value
                                          id_trd_srie_dcmnto_tpo,
                                          'id_dcmnto_tpo' value id_dcmnto_tpo,
                                          'nmro_dcmnto' value nmro_dcmnto,
                                          'file_name' value file_name,
                                          'file_mimetype' value file_mimetype,
                                          'id_usrio' value id_usrio,
                                          'fcha' value fcha) as texto
                         from gd_g_documentos d
                        where d.id_dcmnto = dcmntos.id_dcmnto) loop
            begin
              pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                   p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                   p_nmbre_tbla           => 'gd_g_documentos',
                                                                   p_id_orgen             => fila.llave,
                                                                   p_fla                  => fila.texto,
                                                                   p_blob                 => fila.file_blob,
                                                                   p_bfile                => fila.file_bfile,
                                                                   p_blob_nvo             => fila.file_blob_nvo,
                                                                   o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                   o_mnsje_rspsta         => o_mnsje_rspsta);
            
            exception
              when others then
                o_cdgo_rspsta  := 131;
                o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                  '. No se pudo registrar el log para gd_g_documentos ID: ' ||
                                  fila.llave || ' Error: ' ||
                                  o_mnsje_rspsta;
              
                pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                      p_id_impsto  => null,
                                      p_nmbre_up   => v_nmbre_up,
                                      p_nvel_log   => v_nl,
                                      p_txto_log   => o_mnsje_rspsta,
                                      p_nvel_txto  => 6);
                rollback;
                raise v_error;
            end;
          end loop;
        end;
      
        begin
          for fila in (select id_ttlo_jdcial_dcmnto_asccn as llave,
                              json_object('id_ttlo_jdcial_dcmnto_asccn'
                                          value id_ttlo_jdcial_dcmnto_asccn,
                                          'id_ttlo_jdcial_dcmnto' value
                                          id_ttlo_jdcial_dcmnto,
                                          'id_ttlo_jdcial' value
                                          id_ttlo_jdcial) as texto
                         from gf_g_ttls_jdcl_dcmnt_asccn
                        where id_ttlo_jdcial_dcmnto =
                              dcmntos.id_ttlo_jdcial_dcmnto) loop
            begin
              pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                   p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                   p_nmbre_tbla           => 'gf_g_ttls_jdcl_dcmnt_asccn',
                                                                   p_id_orgen             => fila.llave,
                                                                   p_fla                  => fila.texto,
                                                                   o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                   o_mnsje_rspsta         => o_mnsje_rspsta);
            
            exception
              when others then
                o_cdgo_rspsta  := 135;
                o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                  '. No se pudo registrar el log para id_ttlo_jdcial_dcmnto_asccn ID: ' ||
                                  fila.llave || ' Error: ' ||
                                  o_mnsje_rspsta;
              
                pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                      p_id_impsto  => null,
                                      p_nmbre_up   => v_nmbre_up,
                                      p_nvel_log   => v_nl,
                                      p_txto_log   => o_mnsje_rspsta,
                                      p_nvel_txto  => 6);
                rollback;
                raise v_error;
            end;
          end loop;
        
        end;
      
        for fila in (select id_ttlo_jdcial_dcmnto as llave,
                            json_object('id_ttlo_jdcial_dcmnto' value
                                        id_ttlo_jdcial_dcmnto,
                                        'id_acto_tpo' value id_acto_tpo,
                                        'id_plntlla' value id_plntlla,
                                        'id_rprte' value id_rprte,
                                        'id_acto' value id_acto,
                                        'indcdor_acto_cnfrmcion' value
                                        indcdor_acto_cnfrmcion) as texto
                       from gf_g_titulos_jdcial_dcmnto
                      where id_ttlo_jdcial_dcmnto =
                            dcmntos.id_ttlo_jdcial_dcmnto) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_titulos_jdcial_dcmnto',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 137;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gf_g_titulos_jdcial_dcmnto ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
        pkg_gf_titulos_judicial.prc_ac_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                             p_id_orgen             => dcmntos.id_ttlo_jdcial_dcmnto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
        if o_cdgo_rspsta <> 0 then
          raise v_error;
        end if;
      
        begin
          for fila in (select id_acto as llave,
                              json_object('id_acto' value id_acto,
                                          'cdgo_clnte' value cdgo_clnte,
                                          'cdgo_acto_orgen' value
                                          cdgo_acto_orgen,
                                          'id_orgen' value id_orgen,
                                          'id_undad_prdctra' value
                                          id_undad_prdctra,
                                          'id_acto_tpo' value id_acto_tpo,
                                          'nmro_acto' value nmro_acto,
                                          'anio' value anio,
                                          'nmro_acto_dsplay' value
                                          nmro_acto_dsplay,
                                          'fcha' value fcha,
                                          'id_usrio' value id_usrio,
                                          'id_rprte' value id_rprte,
                                          'fcha_incio_ntfccion' value
                                          fcha_incio_ntfccion,
                                          'id_acto_rqrdo_ntfccion' value
                                          id_acto_rqrdo_ntfccion,
                                          'fcha_ntfccion' value fcha_ntfccion,
                                          'id_fncnrio_frma' value
                                          id_fncnrio_frma,
                                          'indcdor_ntfccion' value
                                          indcdor_ntfccion,
                                          'vlor' value vlor,
                                          'id_dcmnto' value id_dcmnto,
                                          'fcha_pblccion' value fcha_pblccion,
                                          'ntfcdo_pag_web' value
                                          ntfcdo_pag_web) as texto
                         from gn_g_actos
                        where id_acto = dcmntos.id_acto) loop
            begin
              pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                   p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                   p_nmbre_tbla           => 'gn_g_actos',
                                                                   p_id_orgen             => fila.llave,
                                                                   p_fla                  => fila.texto,
                                                                   o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                   o_mnsje_rspsta         => o_mnsje_rspsta);
            
            exception
              when others then
                o_cdgo_rspsta  := 133;
                o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                  '. No se pudo registrar el log para gn_g_actos ID: ' ||
                                  fila.llave || ' Error: ' ||
                                  o_mnsje_rspsta;
              
                pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                      p_id_impsto  => null,
                                      p_nmbre_up   => v_nmbre_up,
                                      p_nvel_log   => v_nl,
                                      p_txto_log   => o_mnsje_rspsta,
                                      p_nvel_txto  => 6);
                rollback;
                raise v_error;
            end;
          end loop;
        end;
        -- *************************--
        begin
          delete gd_g_documentos_metadata
           where id_dcmnto = dcmntos.id_dcmnto;
        
          delete gd_g_documentos where id_dcmnto = dcmntos.id_dcmnto;
        
          delete gf_g_ttls_jdcl_dcmnt_asccn
           where id_ttlo_jdcial_dcmnto = dcmntos.id_ttlo_jdcial_dcmnto;
        
          delete gf_g_titulos_jdcial_dcmnto
           where id_ttlo_jdcial_dcmnto = dcmntos.id_ttlo_jdcial_dcmnto;
        
          delete gn_g_actos where id_acto = dcmntos.id_acto;
        
        exception
          when others then
            rollback;
            o_cdgo_rspsta  := 300;
            o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                              ' Error en la reversion del ttulo. ' ||
                              v_nmro_ttlo_jdcial || ' ' || sqlerrm || '. ' ||
                              sqlcode;
            pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                  null,
                                  v_nmbre_up,
                                  v_nl,
                                  o_mnsje_rspsta,
                                  6);
            raise v_error;
          
        end;
        --************************--
      end loop;
    
      /* begin
        delete gd_g_documentos_metadata
         where id_dcmnto in
               (select c.id_dcmnto
                  from gf_g_ttls_jdcl_dcmnt_asccn a
                  join gf_g_titulos_jdcial_dcmnto b
                    on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
                  join gn_g_actos c
                    on b.id_acto = c.id_acto
                   and c.cdgo_acto_orgen = 'TJP'
                   and a.id_ttlo_jdcial = c.id_orgen
                 where a.id_ttlo_jdcial = p_id_ttlo_jdcial);
      
        delete gd_g_documentos
         where id_dcmnto in
               (select c.id_dcmnto
                  from gf_g_ttls_jdcl_dcmnt_asccn a
                  join gf_g_titulos_jdcial_dcmnto b
                    on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
                  join gn_g_actos c
                    on b.id_acto = c.id_acto
                   and c.cdgo_acto_orgen = 'TJP'
                   and a.id_ttlo_jdcial = c.id_orgen
                 where a.id_ttlo_jdcial = p_id_ttlo_jdcial);
      
      
        delete gf_g_ttls_jdcl_dcmnt_asccn
         where id_ttlo_jdcial_dcmnto in
               (select b.id_ttlo_jdcial_dcmnto
                  from gf_g_ttls_jdcl_dcmnt_asccn a
                  join gf_g_titulos_jdcial_dcmnto b
                    on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
                  join gn_g_actos c
                    on b.id_acto = c.id_acto
                   and c.cdgo_acto_orgen = 'TJP'
                   and a.id_ttlo_jdcial = c.id_orgen
                 where a.id_ttlo_jdcial = p_id_ttlo_jdcial);
      
        delete gf_g_titulos_jdcial_dcmnto
         where id_ttlo_jdcial_dcmnto in
               (select b.id_ttlo_jdcial_dcmnto
                  from gf_g_ttls_jdcl_dcmnt_asccn a
                  join gf_g_titulos_jdcial_dcmnto b
                    on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
                  join gn_g_actos c
                    on b.id_acto = c.id_acto
                   and c.cdgo_acto_orgen = 'TJP'
                   and a.id_ttlo_jdcial = c.id_orgen
                 where a.id_ttlo_jdcial = p_id_ttlo_jdcial);
      
        delete gn_g_actos
         where id_acto in
               (select c.id_acto
                  from gf_g_ttls_jdcl_dcmnt_asccn a
                  join gf_g_titulos_jdcial_dcmnto b
                    on a.id_ttlo_jdcial_dcmnto = b.id_ttlo_jdcial_dcmnto
                  join gn_g_actos c
                    on b.id_acto = c.id_acto
                   and c.cdgo_acto_orgen = 'TJP'
                   and a.id_ttlo_jdcial = c.id_orgen
                 where a.id_ttlo_jdcial = p_id_ttlo_jdcial);
      exception
        when others then
          rollback;
          o_cdgo_rspsta  := 300;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' Error en la reversion del ttulo. ' ||
                            v_nmro_ttlo_jdcial || ' ' || sqlerrm || '. ' ||
                            sqlcode;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;*/
    
      begin
        for fila in (select id_ttlo_jdcial_sldo_fvor as llave,
                            json_object('id_ttlo_jdcial_sldo_fvor' value
                                        id_ttlo_jdcial_sldo_fvor,
                                        'id_ttlo_jdcial' value id_ttlo_jdcial,
                                        'id_instncia_fljo' value
                                        id_instncia_fljo,
                                        'id_sjto_impsto' value id_sjto_impsto,
                                        'idntfccion_sjto' value
                                        idntfccion_sjto,
                                        'vlor_sldo_fvor' value vlor_sldo_fvor,
                                        'obsrvcnes' value obsrvcnes,
                                        'fcha_rgstro' value fcha_rgstro,
                                        'id_fncnrio' value id_fncnrio) as texto
                       from gf_g_titulos_judicial_saldo_favor
                      where id_ttlo_jdcial = p_id_ttlo_jdcial) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_titulos_judicial_saldo_favor',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 139;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gf_g_titulos_judicial_saldo_favor ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
        delete gf_g_titulos_judicial_saldo_favor
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 140;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' No se puede reversar el gf_g_titulos_judicial_saldo_favor. ' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      for vgncias in (select v.id_ttlo_jdcial_vgncia
                        from gf_g_titulos_jdcial_vgncia v
                        join gf_g_titulos_jdcial_impsto i
                          on v.id_ttlo_jdcial_impsto =
                             i.id_ttlo_jdcial_impsto
                       where i.id_ttlo_jdcial = p_id_ttlo_jdcial) loop
        begin
          for fila in (select v.id_ttlo_jdcial_vgncia as llave,
                              json_object('id_ttlo_jdcial_vgncia' value
                                          v.id_ttlo_jdcial_vgncia,
                                          'id_ttlo_jdcial_impsto' value
                                          v.id_ttlo_jdcial_impsto,
                                          'vgncia' value v.vgncia,
                                          'id_prdo' value v.id_prdo,
                                          'prdo' value v.prdo,
                                          'vlor_cptal' value v.vlor_cptal,
                                          'vlor_intres' value v.vlor_intres,
                                          'vlor_dscto' value v.vlor_dscto,
                                          'vlor_ttal' value v.vlor_ttal,
                                          'vlor_ttal_ttlo' value
                                          v.vlor_ttal_ttlo,
                                          'id_orgen' value v.id_orgen,
                                          'vlor_ttal_aplcar' value
                                          v.vlor_ttal_aplcar,
                                          'vlor_ttal_aplccion' value
                                          v.vlor_ttal_aplccion,
                                          'vlor_dscnto_aplccion' value
                                          v.vlor_dscnto_aplccion,
                                          'tpo_dcmnto' value v.tpo_dcmnto,
                                          'cdgo_mvmnto_orgn' value
                                          v.cdgo_mvmnto_orgn,
                                          'fcha_pryccion' value
                                          v.fcha_pryccion) as texto
                         from gf_g_titulos_jdcial_vgncia v
                        where v.id_ttlo_jdcial_vgncia =
                              vgncias.id_ttlo_jdcial_vgncia) loop
            begin
              pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                   p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                   p_nmbre_tbla           => 'gf_g_titulos_jdcial_vgncia',
                                                                   p_id_orgen             => fila.llave,
                                                                   p_fla                  => fila.texto,
                                                                   o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                   o_mnsje_rspsta         => o_mnsje_rspsta);
            
            exception
              when others then
                o_cdgo_rspsta  := 141;
                o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                  '. No se pudo registrar el log para gf_g_titulos_jdcial_vgncia ID: ' ||
                                  fila.llave || ' Error: ' ||
                                  o_mnsje_rspsta;
              
                pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                      p_id_impsto  => null,
                                      p_nmbre_up   => v_nmbre_up,
                                      p_nvel_log   => v_nl,
                                      p_txto_log   => o_mnsje_rspsta,
                                      p_nvel_txto  => 6);
                rollback;
                raise v_error;
            end;
          end loop;
        
        end;
      end loop;
    
      begin
        for fila in (select id_ttl_jdcl_impst_dcmnt as llave,
                            json_object('id_ttl_jdcl_impst_dcmnt' value
                                        id_ttl_jdcl_impst_dcmnt,
                                        'id_ttlo_jdcial_impsto' value
                                        id_ttlo_jdcial_impsto,
                                        'id_ttlo_jdcial' value id_ttlo_jdcial,
                                        'id_dcmnto' value id_dcmnto,
                                        'user_dgta' value user_dgta,
                                        'fcha_dgta' value fcha_dgta,
                                        'user_mdfca' value user_mdfca,
                                        'fcha_mdfca' value fcha_mdfca) as texto
                       from gf_g_ttls_jdcl_impsto_dcmnt
                      where id_ttlo_jdcial = p_id_ttlo_jdcial) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_ttls_jdcl_impsto_dcmnt',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 143;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gf_g_ttls_jdcl_impsto_dcmnt ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
      end;
    
      begin
        for fila in (select id_ttlo_jdcial_impsto as llave,
                            json_object('id_ttlo_jdcial_impsto' value
                                        id_ttlo_jdcial_impsto,
                                        'id_ttlo_jdcial' value id_ttlo_jdcial,
                                        'id_impsto' value id_impsto,
                                        'id_impsto_sbmpsto' value
                                        id_impsto_sbmpsto,
                                        'id_sjto_impsto' value id_sjto_impsto,
                                        'id_sjto_rspnsble' value
                                        id_sjto_rspnsble,
                                        'id_dcmnto' value id_dcmnto) as texto
                       from gf_g_titulos_jdcial_impsto
                      where id_ttlo_jdcial = p_id_ttlo_jdcial) loop
        
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_titulos_jdcial_impsto',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
          exception
            when others then
              o_cdgo_rspsta  := 145;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gf_g_titulos_jdcial_impsto ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
      end;
    
      begin
        delete gf_g_titulos_jdcial_vgncia
         where id_ttlo_jdcial_impsto in
               (select id_ttlo_jdcial_impsto
                  from gf_g_titulos_jdcial_impsto
                 where id_ttlo_jdcial = p_id_ttlo_jdcial);
      
        delete gf_g_ttls_jdcl_impsto_dcmnt
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      
        delete gf_g_titulos_jdcial_impsto
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 400;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' error al reversar el ttulo. ' ||
                            v_nmro_ttlo_jdcial || '. ' || sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
    end if;
    --Fin reversion Aplicacion/consignacion
  
    begin
      select id_instncia_fljo
        into v_id_instncia_fljo
        from gf_g_titulos_judicial
       where id_ttlo_jdcial = p_id_ttlo_jdcial;
    exception
      when others then
        o_cdgo_rspsta  := 10;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' No es posible consultar el id_instncia_fljo para el ttulo ' ||
                          v_nmro_ttlo_jdcial || '. ' || sqlerrm;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    if o_cdgo_rspsta = 0 then
      begin
        for fila in (select id_ttlo_jdcial as llave,
                            json_object('id_ttlo_jdcial' value
                                        id_ttlo_jdcial,
                                        'cdgo_clnte' value cdgo_clnte,
                                        'id_ttlo_jdcial_crgdo' value
                                        id_ttlo_jdcial_crgdo,
                                        'nmro_ttlo_jdcial' value
                                        nmro_ttlo_jdcial,
                                        'fcha_cnsttcion' value fcha_cnsttcion,
                                        'vlor' value vlor,
                                        'id_ttlo_jdcial_area' value
                                        id_ttlo_jdcial_area,
                                        'cdgo_idntfccion_tpo_dmnddo' value
                                        cdgo_idntfccion_tpo_dmnddo,
                                        'idntfccion_dmnddo' value
                                        idntfccion_dmnddo,
                                        'nmbre_dmnddo' value nmbre_dmnddo,
                                        'id_instncia_fljo' value
                                        id_instncia_fljo,
                                        'cdgo_ttlo_jdcial_estdo' value
                                        cdgo_ttlo_jdcial_estdo,
                                        'cnsctvo_embrgo' value cnsctvo_embrgo,
                                        'id_embrgo_rslcion' value
                                        id_embrgo_rslcion,
                                        'nmro_ttlo_pdre' value nmro_ttlo_pdre,
                                        'id_ttlo_pdre' value id_ttlo_pdre,
                                        'id_instncia_fljo_pdre' value
                                        id_instncia_fljo_pdre,
                                        'id_slctud' value id_slctud,
                                        'cdgo_entdad_cnsgnnte' value
                                        cdgo_entdad_cnsgnnte,
                                        'id_bnco_cnsgnnte' value
                                        id_bnco_cnsgnnte,
                                        'cdgo_entdad_rcddr' value
                                        cdgo_entdad_rcddr,
                                        'id_bnco_rcddr' value id_bnco_rcddr,
                                        'id_fncnrio' value id_fncnrio,
                                        'cdgo_ttlo_jdcial_estdo_incial' value
                                        cdgo_ttlo_jdcial_estdo_incial,
                                        'indcdor_mgdo' value indcdor_mgdo,
                                        'id_usrio_rgstro' value
                                        id_usrio_rgstro) as texto
                       from gf_g_titulos_judicial
                      where id_ttlo_jdcial = p_id_ttlo_jdcial) loop
          begin
            pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                                 p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                                 p_nmbre_tbla           => 'gf_g_titulos_judicial',
                                                                 p_id_orgen             => fila.llave,
                                                                 p_fla                  => fila.texto,
                                                                 o_cdgo_rspsta          => o_cdgo_rspsta,
                                                                 o_mnsje_rspsta         => o_mnsje_rspsta);
          
            if o_cdgo_rspsta <> 0 then
              raise v_error;
            end if;
          
          exception
            when others then
              o_cdgo_rspsta  := 147;
              o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                                '. No se pudo registrar el log para gf_g_titulos_judicial ID: ' ||
                                fila.llave || ' Error: ' || o_mnsje_rspsta;
            
              pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                    p_id_impsto  => null,
                                    p_nmbre_up   => v_nmbre_up,
                                    p_nvel_log   => v_nl,
                                    p_txto_log   => o_mnsje_rspsta,
                                    p_nvel_txto  => 6);
              rollback;
              raise v_error;
          end;
        end loop;
      
        update gf_g_titulos_judicial
           set cdgo_ttlo_jdcial_estdo        = 'RGS',
               cdgo_ttlo_jdcial_estdo_incial = 'RGS'
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      exception
        when others then
          o_cdgo_rspsta  := 148;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' Actualizando el estado del ttulo. ' ||
                            sqlerrm;
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    
      pkg_gf_titulos_judicial.prc_rv_titulo_judicial_fuljo(p_cdgo_clnte           => p_cdgo_clnte,
                                                           p_id_ttlo_jdcial_rvrsa => v_id_ttlo_jdcial_rvrsa,
                                                           p_id_instncia_fljo     => v_id_instncia_fljo,
                                                           p_id_ttlo_jdcial       => p_id_ttlo_jdcial,
                                                           o_cdgo_rspsta          => o_cdgo_rspsta,
                                                           o_mnsje_rspsta         => o_mnsje_rspsta);
    
      if o_cdgo_rspsta <> 0 then
        raise v_error;
      end if;
      --registramos la traza
      begin
        pkg_gf_titulos_judicial.prc_rg_titulos_traza(p_cdgo_clnte             => p_cdgo_clnte,
                                                     p_id_ttlo_jdcial         => p_id_ttlo_jdcial,
                                                     p_cdgo_ttlo_jdcial_estdo => 'RGS',
                                                     p_obsrvcion              => p_obsrvcnes,
                                                     p_id_usrio               => p_id_usrio,
                                                     --  p_indcdor_rqre_aprbccion => :p_indcdor_rqre_aprbccion,
                                                     p_cdgo_mvmnto_trza => 'RVT',
                                                     o_cdgo_rspsta      => o_cdgo_rspsta,
                                                     o_mnsje_rspsta     => o_mnsje_rspsta);
        if o_cdgo_rspsta <> 0 then
          raise v_error;
        end if;
      
      exception
        when others then
          o_cdgo_rspsta  := 149;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            ' Al registrar la traza. ' || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                                null,
                                v_nmbre_up,
                                v_nl,
                                o_mnsje_rspsta,
                                6);
          raise v_error;
      end;
    else
      o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                        ' Al reversar el ttulo judicial. ' || sqlerrm;
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
      raise v_error;
    end if;
  
  exception
    when v_error then
      rollback;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
    
  end prc_rv_titulos_judicial;

  procedure prc_rv_titulo_judicial_fuljo(p_cdgo_clnte           in number,
                                         p_id_ttlo_jdcial_rvrsa in number,
                                         p_id_instncia_fljo     in number,
                                         p_id_ttlo_jdcial       in number,
                                         o_cdgo_rspsta          out number,
                                         o_mnsje_rspsta         out varchar2) as
  
    v_nl       number;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_rv_titulo_judicial_fuljo';
    v_error    exception;
  
  begin
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'Flujo reversado con xito.';
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
  
    for fila in (select id_instncia_trnscion as llave,
                        json_object('id_instncia_trnscion' value
                                    id_instncia_trnscion,
                                    'id_instncia_fljo' value id_instncia_fljo,
                                    'id_fljo_trea_orgen' value
                                    id_fljo_trea_orgen,
                                    'fcha_incio' value fcha_incio,
                                    'fcha_fin_plnda' value fcha_fin_plnda,
                                    'fcha_fin_optma' value fcha_fin_optma,
                                    'fcha_fin_real' value fcha_fin_real,
                                    'id_usrio' value id_usrio,
                                    'id_estdo_trnscion' value
                                    id_estdo_trnscion,
                                    'indcdor_mgrdo' value indcdor_mgrdo) as texto
                   from wf_g_instancias_transicion
                  where id_instncia_fljo = p_id_instncia_fljo) loop
      begin
        pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => p_id_ttlo_jdcial_rvrsa,
                                                             p_nmbre_tbla           => 'wf_g_instancias_transicion',
                                                             p_id_orgen             => fila.llave,
                                                             p_fla                  => fila.texto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
      exception
        when others then
          o_cdgo_rspsta  := 10;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            '. No se pudo registrar el log para wf_g_instancias_transicion ID: ' ||
                            fila.llave || ' Error: ' || o_mnsje_rspsta;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
      end;
    end loop;
  
    for fila in (select id_fljo_trnscion as llave,
                        json_object('id_instncia_prtcpnte' value
                                    id_instncia_prtcpnte,
                                    'id_fljo_trnscion' value id_fljo_trnscion,
                                    'id_prtcpte' value id_prtcpte) as texto
                   from wf_g_instancias_participante
                  where id_fljo_trnscion = p_id_instncia_fljo) loop
      begin
        pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => p_id_ttlo_jdcial_rvrsa,
                                                             p_nmbre_tbla           => 'wf_g_instancias_participante',
                                                             p_id_orgen             => fila.llave,
                                                             p_fla                  => fila.texto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
      exception
        when others then
          o_cdgo_rspsta  := 20;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            '. No se pudo registrar el log para wf_g_instancias_participante ID: ' ||
                            fila.llave || ' Error: ' || o_mnsje_rspsta;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
      end;
    end loop;
  
    for fila in (select id_instncia_fljo as llave,
                        json_object('id_instncia_fljo' value
                                    id_instncia_fljo,
                                    'id_fljo' value id_fljo,
                                    'fcha_incio' value fcha_incio,
                                    'fcha_fin_plnda' value fcha_fin_plnda,
                                    'fcha_fin_optma' value fcha_fin_optma,
                                    'fcha_fin_real' value fcha_fin_real,
                                    'id_usrio' value id_usrio,
                                    'estdo_instncia' value estdo_instncia,
                                    'obsrvcion' value obsrvcion,
                                    'indcdor_mgrdo' value indcdor_mgrdo) as texto
                   from wf_g_instancias_flujo
                  where id_instncia_fljo = p_id_instncia_fljo) loop
      begin
        pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log(p_cdgo_clnte           => p_cdgo_clnte,
                                                             p_id_ttlo_jdcial_rvrsa => p_id_ttlo_jdcial_rvrsa,
                                                             p_nmbre_tbla           => 'wf_g_instancias_flujo',
                                                             p_id_orgen             => fila.llave,
                                                             p_fla                  => fila.texto,
                                                             o_cdgo_rspsta          => o_cdgo_rspsta,
                                                             o_mnsje_rspsta         => o_mnsje_rspsta);
      
      exception
        when others then
          o_cdgo_rspsta  := 30;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            '. No se pudo registrar el log para wf_g_instancias_flujo ID: ' ||
                            fila.llave || ' Error: ' || o_mnsje_rspsta;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
      end;
    end loop;
  
    if o_cdgo_rspsta = 0 then
      begin
        update gf_g_titulos_judicial
           set id_instncia_fljo = null
         where id_ttlo_jdcial = p_id_ttlo_jdcial;
      
        delete wf_g_instancias_transicion
         where id_instncia_fljo = p_id_instncia_fljo;
      
        delete wf_g_instancias_participante
         where id_fljo_trnscion = p_id_instncia_fljo;
      
        delete wf_g_instancias_flujo
         where id_instncia_fljo = p_id_instncia_fljo;
      
      exception
        when others then
          o_cdgo_rspsta  := 40;
          o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                            '. No se pude revertir la instancia del flujo ' ||
                            p_id_instncia_fljo || sqlerrm;
        
          pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                                p_id_impsto  => null,
                                p_nmbre_up   => v_nmbre_up,
                                p_nvel_log   => v_nl,
                                p_txto_log   => o_mnsje_rspsta,
                                p_nvel_txto  => 6);
          rollback;
          raise v_error;
      end;
    else
      o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                        '. No se pude revertir la instancia del flujo ' ||
                        p_id_instncia_fljo || sqlerrm;
    
      pkg_sg_log.prc_rg_log(p_cdgo_clnte => p_cdgo_clnte,
                            p_id_impsto  => null,
                            p_nmbre_up   => v_nmbre_up,
                            p_nvel_log   => v_nl,
                            p_txto_log   => o_mnsje_rspsta,
                            p_nvel_txto  => 6);
      raise v_error;
    end if;
  
  exception
    when v_error then
      rollback;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
  end prc_rv_titulo_judicial_fuljo;

  procedure prc_rg_reversion_titulos_log(p_cdgo_clnte           in number,
                                         p_id_ttlo_jdcial_rvrsa in number,
                                         p_nmbre_tbla           in varchar2,
                                         p_id_orgen             in number,
                                         p_fla                  in clob,
                                         p_blob                 in blob default null,
                                         p_bfile                in bfile default null,
                                         p_blob_nvo             in blob default null,
                                         p_file_clob            in clob default null,
                                         o_cdgo_rspsta          out number,
                                         o_mnsje_rspsta         out varchar2) as
  
    v_nl       number;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_rg_reversion_titulos_log';
    v_error    exception;
  
  begin
    o_cdgo_rspsta  := 0;
    o_mnsje_rspsta := 'Log registrado con xito.';
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Parmetros de entrada: ' || p_cdgo_clnte || ',' ||
                          p_id_ttlo_jdcial_rvrsa,
                          6);
  
    begin
      insert into gf_g_titulos_jdcial_rvrsa_dtlle
        (id_ttlo_jdcial_rvrsa,
         nmbre_tbla,
         id_orgen,
         fla,
         file_blob,
         file_bfile,
         file_blob_nvo)
      values
        (p_id_ttlo_jdcial_rvrsa,
         p_nmbre_tbla,
         p_id_orgen,
         p_fla,
         p_blob,
         p_bfile,
         p_blob_nvo);
    exception
      when others then
        o_cdgo_rspsta  := 101;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' Fall el registro del log. ' || sqlerrm;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo de ' || v_nmbre_up || ' ' ||
                          systimestamp,
                          6);
  
  exception
    when v_error then
      rollback;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
    
  end prc_rg_reversion_titulos_log;

  procedure prc_ac_reversion_titulos_log(p_cdgo_clnte           in number,
                                         p_id_ttlo_jdcial_rvrsa in number,
                                         p_id_orgen             in number,
                                         o_cdgo_rspsta          out number,
                                         o_mnsje_rspsta         out varchar2) as
  
    v_clob_orgen clob;
    v_clob_dstno clob;
    v_chunk_size integer := 32767;
    v_buffer     varchar2(32767);
    v_amount     integer;
    v_pos        integer := 1;
  
    v_nl       number;
    v_nmbre_up varchar2(100) := 'pkg_gf_titulos_judicial.prc_ac_reversion_titulos_log';
    v_error    exception;
  begin
  
    o_cdgo_rspsta := 0;
  
    v_nl := pkg_sg_log.fnc_ca_nivel_log(p_cdgo_clnte, null, v_nmbre_up);
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Entrando a ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
  
    begin
      select dcmnto
        into v_clob_orgen
        from gf_g_titulos_jdcial_dcmnto
       where id_ttlo_jdcial_dcmnto = p_id_orgen;
    exception
      when others then
        o_cdgo_rspsta  := 1;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' html no encontrado. ' || sqlerrm || '. ' ||
                          sqlcode;
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    begin
      update gf_g_titulos_jdcial_rvrsa_dtlle
         set file_clob = empty_clob()
       where id_ttlo_jdcial_rvrsa = p_id_ttlo_jdcial_rvrsa
         and id_orgen = p_id_orgen
      returning file_clob into v_clob_dstno;
    exception
      when others then
        o_cdgo_rspsta  := 2;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' al inicializar el clob en gf_g_titulos_jdcial_rvrsa_dtlle. ' ||
                          sqlerrm || '. ' || sqlcode;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    v_amount := dbms_lob.getlength(v_clob_orgen);
  
    begin
      while (v_pos <= v_amount) loop
        dbms_lob.read(v_clob_orgen, v_amount, v_pos, v_buffer);
        dbms_lob.writeappend(v_clob_dstno, v_amount, v_buffer);
        v_pos := v_pos + v_chunk_size;
      end loop;
    exception
      when others then
        o_cdgo_rspsta  := 3;
        o_mnsje_rspsta := 'Error No. ' || o_cdgo_rspsta ||
                          ' copiando el clob en gf_g_titulos_jdcial_rvrsa_dtlle. ' ||
                          sqlerrm || '. ' || sqlcode;
      
        pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                              null,
                              v_nmbre_up,
                              v_nl,
                              o_mnsje_rspsta,
                              6);
        raise v_error;
    end;
  
    pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                          null,
                          v_nmbre_up,
                          v_nl,
                          'Saliendo de ' || v_nmbre_up || ', ' ||
                          systimestamp,
                          6);
  
    commit;
  exception
    when v_error then
      rollback;
      pkg_sg_log.prc_rg_log(p_cdgo_clnte,
                            null,
                            v_nmbre_up,
                            v_nl,
                            o_mnsje_rspsta,
                            6);
    
  end prc_ac_reversion_titulos_log;

  function fnc_ca_nit_cc(p_nmro_idntfccion in varchar2) return varchar2 as
  
    V_NMRO_IDNTFCCION NUMBER;
    V_ERROR           BOOLEAN;
    V_TPO_IDNTFCCION  VARCHAR2(1);
  
  begin
  
    V_ERROR          := FALSE;
    V_TPO_IDNTFCCION := 'X';
  
    BEGIN
      V_NMRO_IDNTFCCION := TO_NUMBER(P_NMRO_IDNTFCCION);
    EXCEPTION
      WHEN OTHERS THEN
        V_ERROR := TRUE;
    END;
  
    IF NOT V_ERROR THEN
      IF V_NMRO_IDNTFCCION >= 800000000 AND V_NMRO_IDNTFCCION <= 999999999 THEN
        V_TPO_IDNTFCCION := 'N';
      ELSIF V_NMRO_IDNTFCCION >= 8000000000 THEN
        V_TPO_IDNTFCCION := 'N';
      ELSE
        V_TPO_IDNTFCCION := 'C';
      END IF;
    END IF;
  
    return(V_TPO_IDNTFCCION);
  end fnc_ca_nit_cc;

end pkg_gf_titulos_judicial;

/
